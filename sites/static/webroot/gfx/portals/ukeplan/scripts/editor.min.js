function save(){var a=null,b=null;order=new Array;var c=0,d=new Object,e=new Object,f=new Object,g=0,h=0;$("div.imageplaceholder").each(function(){a=$(this).find(".cropbox"),a.hasClass("blackAndWhite")?g=1:g=0;if(a.hasClass("rotate")){var b=$(this).find("img").attr("src");h=b.split("/").pop()}else h=0;var d="",f="",i="";imagelayout=="text"&&(d=toptext,f=$("#text-font").val(),i=$("#text-color").val()),order[c]=new Array,e["image"+c]={sorting:c,imagefield_width:$(this).width(),imagefield_height:$(this).height(),width:a.width(),height:a.height(),"margin-left":a.css("left"),"margin-top":a.css("top"),imageid:a.attr("imageid"),blackandwhite:g,rotate:h,toptext:d,toptextfont:f,toptextcolor:i},c++}),c=0,$(".imagetext").each(function(){f["name"+c]={sorting:c,width:$(this).width(),height:$(this).height(),font:$("#text-font").val(),color:$("#text-color").val(),text:$(this).attr("alt")},c++});if($("#notatoption").prop("checked"))var i="true";else var i="false";d.template={prodno:malArray.prodno,malid:malArray.mal_id,mal_width:malArray.mal_width,mal_height:malArray.mal_height,imagefield_height:malArray.imagefield_height,imagefield_width:malArray.imagefield_width,imagefield_x:malArray.imagefield_x,imagefield_y:malArray.imagefield_y,imagefield_space:malArray.imagefield_space,editorcontainer_width:editorcontainer_width,ratio:ratio,gridcolor:$("#color").val(),numberofcolumns:numberofcolumns,background:$("#background").val(),clipart:$("input[name=clipart]:checked").val(),maskit:$("input[name=maskit]:checked").val(),imagelayout:imagelayout,notatoption:i},d.grid={color:$("#color").val(),quantity:numberofdays,gridvalues:gridarray},d.weekdays={font:"Century_Gothic",color:$("#day-color").val(),background:$("#day-color-background").val()},d.product={productid:$("#productid").val(),productoptionid:$("#productoptionid").val(),quantity:$("#quantity").val()},d.images=e,d.names=f;if(portal=="UP-DK")var j="/kurv/ugeplan/accessories";else var j="/cart/ukeplan/accessories/";return $.ajax({type:"post",cache:!1,url:"/api/1.0/editor/ukeplan",data:d,success:function(a){return document.location.href=j,!1},complete:function(a){return!1},error:function(a){alert("error")}}),!1}function parseIntUkeplan(a){var b=Math.round(a*Math.pow(10,0))/Math.pow(10,0);return b}function setupgrid(){$(".textplaceholder").append('<table class="texttable"></table>'),$(gridarray).each(function(a,b){$(".textplaceholder table").append('<tr><td><img class="day" alt="'+b+'" src="" /></td></tr>')})}function setupText(){var a=$("#day-color").val().replace("#",""),b=parseIntUkeplan($(".grid").height()/numberofdays)-2,c=parseIntUkeplan(malArray.imagefield_x/ratio)-2;$(".notat").css("color",$("#day-color").val()),$("img.day").each(function(){$(this).attr("src","/api/1.0/gift/text_ukeplan/?id=0&quality=1&png=1&font=arial&gravity=West&color="+a+"&background="+encodeURIComponent(backgroundcolor)+"&text="+$(this).attr("alt")+"&width="+b+"&height="+c+"&rotate="+rotate)})}function updateTopText(a){a=encodeURIComponent(a);var b=$(".imageplaceholder").height(),c=$(".imageplaceholder").width(),d=encodeURIComponent($("#text-color").val()),e=encodeURIComponent(backgroundcolor),f=$("#text-font").val(),g="/api/1.0/gift/toptext?text="+a+"&width="+c+"&height="+b+"&color="+d+"&background="+e+"&font="+f;$(".imageplaceholder").html('<img id="cropbox1" class="cropbox" src="'+g+'" style="position: relative;" height="'+b+'" imageid="textimage" />')}function setupTemplateColor(){var a=$("#color").val();imagelayout=="text"?$(".imageplaceholder").css({"border-color":backgroundcolor}):$(".imageplaceholder").css({"border-color":a}),$(".grid, .notatfelt").css({"border-color":a}),$("table.grid td").css({"border-color":a})}function setupTemplate(){var a=malArray.imagefield_space/ratio;$(".logo").css({width:malArray.imagefield_width/ratio+"px"}),$(".editorcontainer").css({height:malArray.mal_height/ratio+"px",width:malArray.mal_width/ratio+"px"}),$(".imageandtextplaceholder").css({height:parseIntUkeplan(malArray.imagefield_height/ratio)+"px",width:(malArray.imagefield_x+malArray.imagefield_width)/ratio+"px",left:malArray.imagefield_x/ratio+"px",top:malArray.imagefield_y/ratio+"px"}),$(".imageplaceholder").css({height:parseIntUkeplan(malArray.imagefield_height/ratio)+"px"}),$(".grid").css({height:gridheight+"px"}).height(gridheight),$(".gridplaceholder").css({left:malArray.imagefield_x/ratio+"px",top:(malArray.imagefield_x+malArray.imagefield_height)/ratio+3+"px",width:(malArray.imagefield_x+malArray.imagefield_width)/ratio+"px"}),$(".texttable").attr("height",gridheight),$("div.textplaceholder").css({top:(malArray.imagefield_x+malArray.imagefield_height)/ratio+3+"px",height:gridheight+"px"}),$("#notatoption").prop("checked")&&$(".notatfelt").css({height:1e3/ratio,width:notatwidth+"px",left:malArray.imagefield_x/ratio+2+"px",top:(malArray.imagefield_x+malArray.imagefield_height)/ratio+gridheight+5+"px"}),$("table.grid").css("margin-left","2px")}function setupNames(){$(".namescontainer").css({left:"0px",top:$("div.imageplaceholder").height()-textimageheight+"px"});var a=$("#text-color").val().replace("#",""),b=backgroundcolor.replace("#",""),c=$("#text-font").val(),d=$("table.grid").width()-2;$("img#imagetext").each(function(){var e=$(this).attr("alt");textimageheight=20;var f="/api/1.0/gift/names_ukeplan/?id=0&quality=1&png=1&font="+c+"&gravity=West&color="+a+"&background="+b+"&text="+e+"&width="+d+"&height="+textimageheight+'"';$(this).attr({src:f,alt:e})}),$("img.imagetext").css({width:d+"px","margin-left":"4px"}),imagelayout=="text"&&updateTopText(toptext)}function updateName(a){var b=$("input[name=inputtext]").val(),c=$("#text-color").val().replace("#",""),d=backgroundcolor.replace("#",""),e=$("#text-font").val(),f=$("table.grid").width()-2,g="/api/1.0/gift/names_ukeplan/?id=0&quality=1&png=1&font="+e+"&gravity=West&color="+c+"&background="+d+"&text="+b+"&width="+f+"&height="+textimageheight+'"';return a.parent().parent().find(".imagetext").attr({src:g,alt:b}),$(".edittext").remove(),!1}function loginUser(){var a=$('input[name="username"]').val(),b=$('input[name="password"]').val();$.post("/api/1.0/user/login/",{username:a,password:b},function(a){a.message=="OK"?(imagePickerLoaded=!1,$(".logininfo span:first-child").text(a.result.email),$(".logininfo span:last-child").html('<a href="/logout">Logg ut</a>'),$(".loginbox").remove(),$(".getimagebox").show(),imagePicker(),$("#loginbox").remove()):$("#loginbox").append('<span class="label label-warning">'+a.message+"</span>")},"json")}function imagePicker(){imagePickerLoaded||$.post("/api/1.0/albums/enum_new",{},function(a){a.result&&(imagePickerLoaded=!0,$("#imagePicker .loader").remove(),$(a.albums).each(function(a,b){$("#imagePicker ul.albums").append($("<li/>").append($("<a/>",{href:"#",text:b.title,title:b.title,click:function(){$("#imagePicker ul.albums li a.selected").removeClass("selected"),$(this).addClass("selected"),loadAlbum($(this),b,"#imagePickerImages")}}))),a==0&&($(this).addClass("selected"),loadAlbum($(this),b,"#imagePickerImages"))})),imagePickerLoaded=!0},"json")}function checkquality(a,b){var c=$(a.currentTarget).attr("imageid"),d=originalimage[c],e=malArray.imagefield_height/ratio,f=$(a.currentTarget).height()*ratio/118,g=d.y/f*2.5432;g>=150?$(a.currentTarget).parent().find(".quality").attr("src",staticsite+"gfx/ukeplan/new/top.png"):g<150&&g>=50?$(a.currentTarget).parent().find(".quality").attr("src",staticsite+"gfx/ukeplan/new/avg.png"):g<50&&$(a.currentTarget).parent().find(".quality").attr("src",staticsite+"gfx/ukeplan/new/bad.png")}function pickImage(a){var b=new Image;originalimage[a.id]=a,$(b).load(function(){$("#"+selectedcropbox).attr("imageid")=="noimage"&&$("#"+selectedcropbox).parent().html('<img id="'+selectedcropbox+'" class="cropbox" imageid="" src=""/>');var c=$(".imageplaceholder").width(),d=$(".imageplaceholder").height();$("#"+selectedcropbox).attr("src",a.screensize).attr("imageid",a.id),$("#"+selectedcropbox).cropbox({width:c,height:d}).on("cropbox",checkquality),currentImage=a,previewHeight=b.height,previewWidth=b.width,previewHeight>previewWidth?$("#portrait").click():$("#landscape").click(),$("#"+selectedcropbox).removeClass("blackAndWhite"),$("#"+selectedcropbox).parent().append('<img class="quality" src="" data-toggle="modal" data-target=".qualitytip"/>'),$("#cropbutton").removeAttr("disabled")}),b.src=a.screensize,$("#add-to-cart").removeClass("disabled"),$(".startup").hide(),$("#imageselect").modal("hide")}function loadAlbum(a,b,c){var d=!1;return $.post("/api/1.0/albums/images/enum",{albumid:b.id},function(a){$(c).empty(),$(a.images).each(function(a,b){$(c).append($("<li/>").append($("<a/>",{href:"#",click:function(){return pickImage(b),!1}}).append('<img src="'+b.thumbnail+'" />')))})},"json"),d}function newColumn(a){var b=$(".grid").length,c=$(".imageplaceholder").length,d=malArray.imagefield_space/ratio,e=0;if(clipartcolumn==1)var f=1;else var f=0;if($("#background").val()=="black")var g="#fff";else var g="#000";if(imagelayout=="each")$(".imageplaceholder").each(function(a,d){e++,c-f==a+1&&(b++,$(this).after(' <div class="imageplaceholder center"><div id="cropbox'+b+'" class="btn btn-default cropbox" " style="position: relative; color:#fff" height="150" imageid="noimage">'+velgbilde+"<div></div>").addClass("lastholder")),$(this).find(".cropbox").attr("id","cropbox"+e)}),b==$(".imageplaceholder").length?$(".grid").each(function(a,b){a==0&&$(this).parent().after("<div>"+$(this).parent().html()+"</div>")}):b--,imageholderwidth=(malArray.imagefield_width/ratio-d*(b-1)-b*2)/b;else{b++;var h=malArray.imagefield_width/ratio/1-d;$(".grid").each(function(a,b){a==0&&$(this).parent().after("<div>"+$(this).parent().html()+"</div>")})}if($("input[name=names]:checked").val()=="names"){var i=$(".imagetextplaceholder").length;$(".imagetextplaceholder").each(function(a,b){i-f==a+1&&$(this).after('<div class="imagetextplaceholder"><img id="imagetext" alt="'+skrivnytekst+'" class="imagetext" src="" /></div>')})}setupTemplate(),setupTemplateColor(),imagelayout=="each"?gridholderwidth=imageholderwidth+2:gridholderwidth=malArray.imagefield_width/ratio/b-d+2,imageholderwidth=parseIntUkeplan(imageholderwidth),gridholderwidth=parseIntUkeplan(gridholderwidth);var j=$(".imageplaceholder").height();return imagelayout=="each"?($("div.imageplaceholder").css("width",imageholderwidth),$("table.grid").css("width",gridholderwidth),$("div.imageplaceholder img").each(function(){$(this).cropbox({width:imageholderwidth,height:j})})):($("div.imageplaceholder").css("width",gridholderwidth*b+b+(b-4)),$("table.grid").css("width",gridholderwidth)),$("table.grid").css("margin-left","2px"),setupNames(),!1}function deleteColumn(){$("input[name=clipart]").attr("checked",!1);var a=$(".grid").size(),b=malArray.imagefield_space/ratio,c=a-1;imagelayout=="each"?($(".imageplaceholder").each(function(b,c){b==a-1&&$(this).remove()}),imageholderwidth=(malArray.imagefield_width/ratio-b*(c-1)-c*2)/c):imageholderwidth=malArray.imagefield_width/ratio-b,$(".grid").each(function(b,c){b==a-1&&$(this).parent().remove()}),setupTemplate(),setupTemplateColor(),imagelayout=="each"?gridholderwidth=imageholderwidth+2:gridholderwidth=malArray.imagefield_width/ratio/c-b+2,imageholderwidth=parseIntUkeplan(imageholderwidth),gridholderwidth=parseIntUkeplan(gridholderwidth);var d=$(".imageplaceholder").height();return imagelayout=="each"?($("div.imageplaceholder").css("width",imageholderwidth),$("table.grid").css("width",gridholderwidth),$("div.imageplaceholder img").each(function(){$(this).cropbox({width:imageholderwidth,height:d})})):($("div.imageplaceholder").css("width",gridholderwidth*c+c+(c-4)),$("table.grid").css("width",gridholderwidth)),$("table.grid").css("margin-left","2px"),$("input[name=names]:checked").val()=="names"&&($(".imagetextplaceholder").each(function(b,c){b==a-1&&$(this).remove()}),setupNames()),!1}var notatwidth;$(document).ready(function(){setupgrid(),setupTemplate(),setupText(),$("#notatoption").on("change",function(){$(this).prop("checked")?(notatheight=1e3,notatwidth=($(".grid").width()+2)*$(".grid").size()-4,$(".editorcontainer").append('<div class="notatfelt"><div class="notat">'+notattext+"</div></div>")):(notatheight=0,$(".notatfelt").remove()),gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-bottommargin-notatheight)/ratio,setupTemplate(),setupText()}),$(document).on("mouseover",".imageplaceholder",function(){$(".cropControls").css({opacity:"0",filter:"alpha(opacity=0) }"}),$(this).find(".quality").show(),$(this).find(".cropControls").css({opacity:".95",filter:"alpha(opacity=95) }"})}),$(".editorcontainer").mouseleave(function(){$(".cropControls").css({opacity:"0",filter:"alpha(opacity=0) }"}),$(".quality").hide()}),$("#oriantationmodal .cancel").on("click",function(a){$("#oriantationmodal").modal("hide"),$('select[name="orientation"]').val($(".selectedoption").val())}),$("#oriantationmodal .ok").on("click",function(a){$("#oriantationmodal").modal("hide"),window.location.href=$('select[name="orientation"]').val()}),$('select[name="orientation"]').on("change",function(){$("#oriantationmodal").modal({backdrop:"static",keyboard:!0,show:!0})}),$("#loginbutton").on("click",function(){}),$("#loginform").submit(function(a){return a.preventDefault(),loginUser(),!1}),$("#fileupload").fileupload({dataType:"json",done:function(a,b){$.each(b.result.files,function(a,b){var c=$("<img/>").addClass("uploadedthumb").attr({src:b.thumbnail,id:b.id});$("<span/>").append(c).appendTo("#files"),$("#previewimage").attr("src",b.screensize),pickImage(b)}),$("#progress .progress-bar").css("width","0%")},progressall:function(a,b){var c=parseInt(b.loaded/b.total*100,10);$("#progress .progress-bar").css("width",c+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?undefined:"disabled"),$(document).on("click","img.uploadedthumb",function(){var a=$(this).attr("id");pickImage(originalimage[a])}),$("select#color option:selected").each(function(){$("#color").css("background-color",$(this).css("background-color")),$("#color").css("color",$(this).css("color"))}),$("select#text-color option:selected").each(function(){$("#text-color").css("background-color",$(this).css("background-color")),$("#text-color").css("color",$(this).css("color"))}),$("select#day-color option:selected").each(function(){$("#day-color").css("background-color",$(this).css("background-color")),$("#day-color").css("color",$(this).css("color"))}),$.post("/api/1.0/prices/get",{productoptionid:2870,quantity:1},function(a){$("#maskit-price").text(a.price)},"json"),$(document).on("click",".bw",function(){var a=$(this).parent().parent().find(".cropbox");fullDomain=window.location.host,brokenstring=a.attr("src").split("/");var b=0;$(this).attr("id")=="bw"?($(this).attr("id","color").text("Farger"),b=1,$(a).addClass("blackAndWhite")):$(this).attr("id")=="color"&&($(this).attr("id","bw").text("Sort/hvit"),$(a).removeClass("blackAndWhite")),brokenstring[10]||(brokenstring[10]=0);var c="http://"+fullDomain+"/"+brokenstring[3]+"/"+brokenstring[4]+"/"+brokenstring[5]+"/"+brokenstring[6]+"/"+brokenstring[7]+"/"+brokenstring[8]+"/"+b+"/"+brokenstring[10];a.attr("src",c)}),$("#clipart").click(function(){return $("#"+selectedcropbox).attr({src:middagsbestikk,height:malArray.imagefield_height/ratio+"px",imageid:"dinner"}).css({height:malArray.imagefield_height/ratio+"px",top:"",left:"","margin-left":"","margin-top":"",width:""}),$("#"+selectedcropbox).parent().addClass("dinner"),$("#imageselect").modal("hide"),!1}),$("#color").change(function(){return $("select#color option:selected").each(function(){$("#color").css("background-color",$(this).css("background-color")),$("#color").css("color",$(this).css("color"))}),setupTemplateColor(),setupText(),!1}),$("#day-color").change(function(){return $("select#day-color option:selected").each(function(){$("#day-color").css("background-color",$(this).css("background-color")),$("#day-color").css("color",$(this).css("color"))}),setupText(),!1}),$("#text-color").change(function(){return $("select#text-color option:selected").each(function(){$("#text-color").css("background-color",$(this).css("background-color")),$("#text-color").css("color",$(this).css("color"))}),setupNames(),!1}),$("#text-font").change(function(){setupNames()}),$(".imageplaceholder").html('<div id="cropbox1" class="btn btn-default cropbox" style="position: relative; color: #fff" height="150"  imageid="noimage" >'+velgbilde+"</div>"),$(document).on("click",".openimagebox",function(){selectedcropbox=$(this).parent().parent().find(".cropbox").attr("id"),$("#imageselect").modal()}),$(document).on("click",".cropbox",function(){if(imagelayout=="text"){var a=decodeURIComponent(toptext);a=$.trim(a),a=="Legg til tekst"&&(a="");var b=$(".imageplaceholder").width();$(this).parent().parent().parent().append('<div class="center edittoptext" " style="width: '+b+'px">'+skrivnytekst+'<br/>                                                        <textarea id="toptext" style="width:300px; height:30px;text-align:center;" wrap="off" placeholder="'+textplaceholder+'">'+a+'</textarea><br/>                                                        <button id="toptext-confirm">'+oppdater+"</button></div>"),$("#toptext").focus()}else $(this).attr("imageid")=="noimage"&&(selectedcropbox=$(this).attr("id"),$("#imageselect").modal())}),$(document).on("click",".imagetext",function(){$(".edittext").remove();var a=$(".grid").width()-22,b=$(this).attr("alt");return b==skrivnytekst&&(b=""),$(this).parent().append('<div class="edittext"><br/>'+skrivnytekst+'<br/><input type="text" name="inputtext" value="'+b+'" style="width: '+a+'px" /><a class="button" id="submittext" href="#" >'+oppdater+"</a></div>"),$(".edittext").css({width:$(".grid").width()-13+"px",height:"98px",top:"-"+(110-textimageheight-1)+"px",left:"5px"}),$("input[name=inputtext]").focus(),!1}),$(document).on("keypress","input[name=inputtext]",function(a){a.keyCode==13&&updateName($(this))}),$(document).on("click","#submittext",function(){return updateName($(this)),!1}),$("a#openLoginDialog").click(function(){return loginDialog(),!1}),$(".container").on("hover",".imageandtextplaceholder",function(a){$(".imageplaceholder").css("cursor","pointer")}),$("#new_column").click(function(){return newColumn(),!1}),$("#remove_column").click(function(){return deleteColumn(),!1}),$(document).on("click","#getimagebutton",function(){imagePicker()}),$(document).on("submit","#order_ukeplan",function(){return $(".confirmtip").modal(),!1}),$("#confirmproject").on("click",save),$("input[name=names]").change(function(){$(".edittext").remove(),$("input[name=names]:checked").val()=="names"?($(".textchoices").show(),$("table.grid").each(function(){$(".namescontainer").prepend('<div class="imagetextplaceholder"><img id="imagetext" alt="'+skrivnytekst+'" class="imagetext" src="" /></div>')}),setupNames()):(imagelayout!="text"&&$(".textchoices").hide(),$(".imagetext").remove())}),$("input[name=imagelayout]").change(function(){var a=malArray.imagefield_space/ratio;imagelayout=$(this).val(),$("#imagefield_height").attr("disabled","true"),$("#textfield_height").attr("disabled","true");var b="noimage";clipartcolumn=!1,$(".grid").removeClass("dinner"),$("input[name=clipart]").removeAttr("checked");if($("#background").val()=="black")var c="#fff";else var c="#000";if(imagelayout=="one"){$("#imagefield_height").removeAttr("disabled"),$(".textchoices").hide(),$(".imageplaceholder").html('<div id="cropbox1" class="btn btn-default cropbox" " style="position: relative; color: #fff;  height="150" imageid="noimage">'+velgbilde+"<div></div>"),malArray.imagefield_height=imagefield_one,gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-bottommargin)/ratio,setupTemplateColor(),setupTemplate(),setupText(),columnlength=1;var d=0;$(".imageplaceholder").each(function(a,b){a>0&&$(this).remove()}),$(".grid").each(function(){d=$(this).width()+d}),d=$(".grid").size()*2+d-4,$("div.imageplaceholder").css("width",d),$(".imagetext").remove(),$("input[name=names]").attr("checked",!1)}else if(imagelayout=="each"){$("#cropbox1").remove(),$(".imageplaceholder").html('<div id="cropbox1" class="btn btn-default cropbox" style="position: relative;" color: #fff"  imageid="noimage" >'+velgbilde+"</div>"),$(".textchoices").hide();if($("div.imageplaceholder").size()<numberofcolumns){malArray.imagefield_height=imagefield_each,gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-bottommargin)/ratio,setupTemplate(),setupText();var d=0,e=numberofcolumns-1;while(d<=e)newColumn(),d++}$(".imagetext").remove(),$("input[name=names]").attr("checked",!1)}else if(imagelayout=="text"){$(".imageplaceholder").css({"border-color":backgroundcolor}),$("#textfield_height").removeAttr("disabled"),malArray.imagefield_height=imagefield_each,gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-bottommargin)/ratio,setupTemplate(),setupText(),columnlength=1;var d=0;$(".imageplaceholder").each(function(a,b){a>0&&$(this).remove()}),$(".grid").each(function(){d=$(this).width()+d}),d=$(".grid").size()*2+d-4,$("div.imageplaceholder").css("width",d),$("input[name=names]").is(":checked")||$("input[name=names]").click(),updateTopText(toptext)}}),$("input[name=clipart]").change(function(){var a=$(".cropbox").size();if($("input[name=clipart]:checked").val()=="dinner"){src=middagsbestikk;var b="dinner";clipartcolumn=!0,$(".grid").each(function(a,b){if($(".grid").size()-1==a){$(this).addClass("dinner");var c=$("table.dinner td").height();$("table.dinner td").css("background-size",c/3.57+"px "+c+"px")}}),$(".cropbox").each(function(a,c){$(".cropbox").size()-1==a&&imagelayout=="each"&&(console.log("adsda"),selectedcropbox=$(this).attr("id"),$("#"+selectedcropbox).attr("imageid")=="noimage"&&$("#"+selectedcropbox).parent().html('<img id="'+selectedcropbox+'" class="cropbox" height="150" imageid="" src=""/>'),$("#"+selectedcropbox).attr({src:src,height:malArray.imagefield_height/ratio+"px",imageid:b}).css({height:malArray.imagefield_height/ratio+"px",top:"",left:"","margin-left":"","margin-top":"",width:""}).parent().addClass("dinner"))})}else{var b="noimage";clipartcolumn=!1,$(".grid").removeClass("dinner"),$(".cropbox").each(function(a,b){if($(".cropbox").size()-1==a&&imagelayout=="each"){var c=$(this).parent();c.removeClass("dinner"),$(this).remove(),c.html('<div id="cropbox'+(a+1)+'" class="btn btn-default cropbox" style="position: relative; color: #fff" height="150"  imageid="noimage" >'+velgbilde+"</div>")}})}}),$("input[name=clipart]").change(function(){gridheight-=20,setupTemplate()}),$("#columnquantity").change(function(){var a=$(".grid").size(),b=$(this).val();numberofcolumns=b,savedcrop=[];var c=0;if(b<a)while(c<a-b)deleteColumn(),c++;else while(c<b)a<=c&&newColumn(),c++}),$(document).on("click",".rotateRight",function(){var a=$(this).parent().parent().find(".cropbox");fullDomain=window.location.host,brokenstring=a.attr("src").split("/"),brokenstring[10]||(brokenstring[10]=0),brokenstring[9]||(brokenstring[9]=0);var b=parseInt(brokenstring[10])+90;if(b==-90||b==-270)b=360+b;if(b==360||b==-360)b=0;var c="http://"+fullDomain+"/"+brokenstring[3]+"/"+brokenstring[4]+"/"+brokenstring[5]+"/"+brokenstring[6]+"/"+brokenstring[7]+"/"+brokenstring[8]+"/"+brokenstring[9]+"/"+b,d=$(".imageplaceholder").height(),e=$(".imageplaceholder").width();a.attr("src",c),b>0?a.addClass("rotate"):a.removeClass("rotate"),a.cropbox({width:e,height:d})}),$(document).on("click",".rotateLeft",function(){var a=$(this).parent().parent().find(".cropbox");fullDomain=window.location.host,brokenstring=a.attr("src").split("/"),brokenstring[10]||(brokenstring[10]=0),brokenstring[9]||(brokenstring[9]=0);var b=parseInt(brokenstring[10])-90;if(b==-90||b==-270)b=360+b;if(b==360||b==-360)b=0;var c="http://"+fullDomain+"/"+brokenstring[3]+"/"+brokenstring[4]+"/"+brokenstring[5]+"/"+brokenstring[6]+"/"+brokenstring[7]+"/"+brokenstring[8]+"/"+brokenstring[9]+"/"+b,d=$(".imageplaceholder").height(),e=$(".imageplaceholder").width();a.attr("src",c),b>0?a.addClass("rotate"):a.removeClass("rotate"),a.cropbox({width:e,height:d})}),$("#imagefield_height").change(function(){imagefield_one=(malArray.mal_height-malArray.imagefield_x-877)*$(this).val()/100,malArray.imagefield_height=imagefield_one,gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-877)/ratio,setupTemplate(),setupText(),columnlength=1;var a=0;$(".grid").each(function(){a=$(this).width()+a}),a=$(".grid").size()*2+a-4,$("div.imageplaceholder").css("width",a),$(".imagetext").remove(),$("input[name=names]").attr("checked",!1)}),$("#textfield_height").change(function(){imagefield_one=(malArray.mal_height-malArray.imagefield_x-877)*$(this).val()/100,malArray.imagefield_height=imagefield_one,gridheight=(malArray.mal_height-malArray.imagefield_height-malArray.imagefield_x-877)/ratio,setupTemplate(),setupText(),columnlength=1;var a=0;$(".grid").each(function(){a=$(this).width()+a}),a=$(".grid").size()*2+a-4,$("div.imageplaceholder").css("width",a),setupNames(),updateTopText(toptext)}),$(document).on("click","#toptext-confirm",function(){toptext=$("#toptext").val(),updateTopText(toptext),$(".edittoptext").remove()}),$("#background").on("change",function(){$(this).val()=="trans"?(backgroundcolor="#FFFFFF",$("#day-color").val()=="#FFFFFF"&&$("#day-color").val("#010101").css({background:"#000",color:"#fff"}),$("#color").val()=="#FFFFFF"&&($("#color").val("#010101").css({background:"#000",color:"#fff"}),setupTemplateColor()),$("#text-color").val()=="#FFFFFF"&&($("#text-color").val("#010101").css({background:"#000",color:"#fff"}),setupNames()),setupText(),$("div.editorcontainer").addClass("transparent").removeClass("black")):$(this).val()=="white"?(backgroundcolor="#FFFFFF",$("#day-color").val()=="#FFFFFF"&&$("#day-color").val("#010101").css({background:"#000",color:"#fff"}),$("#color").val()=="#FFFFFF"&&($("#color").val("#010101").css({background:"#000",color:"#fff"}),setupTemplateColor()),$("#text-color").val()=="#FFFFFF"&&($("#text-color").val("#010101").css({background:"#000",color:"#fff"}),setupNames()),setupText(),$("div.editorcontainer").removeClass("transparent").removeClass("black")):$(this).val()=="black"&&(backgroundcolor="#000000",$("#day-color").val()=="#010101"&&$("#day-color").val("#FFFFFF").css({background:"#fff",color:"#000"}),$("#color").val()=="#010101"&&($("#color").val("#FFFFFF").css({background:"#fff",color:"#000"}),setupTemplateColor()),$("#text-color").val()=="#010101"&&($("#text-color").val("#FFFFFF").css({background:"#fff",color:"#000"}),setupNames()),$(".editorcontainer").css({opacity:"1"}),setupText(),$("div.editorcontainer").removeClass("transparent").addClass("black"))})}),$(window).load(function(){var a=1;while(a<numberofcolumns)newColumn(),a++;$(".loader").fadeOut()})