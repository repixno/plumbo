// Created 11/6/2013 5:00:31 PM
(function(){var a=function c(){if(2===arguments.length&&"number"===typeof arguments[0]&&"number"===typeof arguments[1])this.x=arguments[0],this.y=arguments[1];else if(1===arguments.length&&arguments[0].type===c.type)this.x=arguments[0].x,this.y=arguments[0].y;else if(0===arguments.length)this.y=this.x=0;else throw"Arguments must be 2 numbers or nothing at all";},d=a.prototype;a.type="Vector2";d.type=a.type;d.set=function(c,b){if(2===arguments.length&&"number"===typeof arguments[0]&&"number"===typeof arguments[1])this.x=
arguments[0],this.y=arguments[1];else if(1===arguments.length&&arguments[0].type===a.type)this.x=arguments[0].x,this.y=arguments[0].y;else throw'Argument must be 2 numbers or 1 "Vector2"';};d.neg=function(){return new a(-this.x,-this.y)};d.vclone=function(){return new a(this.x,this.y)};d.add=function(c){var b=new a(this.x,this.y);if("number"===typeof c)b.x+=c,b.y+=c;else if(c.type&&c.type===a.type)b.x+=c.x,b.y+=c.y;else throw'Argument must be of type "Vector2" or "number"';return b};d.sub=function(c){var b=
new a(this.x,this.y);if("number"===typeof c)b.x-=c,b.y-=c;else if(c.type&&c.type===a.type)b.x-=c.x,b.y-=c.y;else throw'Argument must be of type "Vector2" or "number"';return b};d.mul=function(c){var b=new a(this.x,this.y);if("number"===typeof c)b.x*=c,b.y*=c;else if(c.type&&c.type===a.type)b.x*=c.x,b.y*=c.y;else throw'Argument must be of type "Vector2" or "number"';return b};d.div=function(c){var b=new a(this.x,this.y);if("number"===typeof c)b.x/=c,b.y/=c;else if(c.type&&c.type===a.type)b.x/=c.x,
b.y/=c.y;else throw'Argument must be of type "Vector2" or "number"';return b};d.dot=function(c){if(!c||!c.type||c.type!==a.type)throw'Arguments must be of type "Vector2"';return this.x*c.x+this.y*c.y};d.square=function(){return new a(this.x*this.x,this.y*this.y)};d.vlength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};d.abs=function(){return new a(Math.abs(this.x),Math.abs(this.y))};d.proportions=function(){return this.x/this.y};d.map=function(c){var b=new a;b.x=c(this.x);b.y=c(this.y);
return b};a.dot=function(c,b){if(c.type!==a.type||b.type!==a.type)throw'Arguments must be of type "Vector2"';return c.x*b.x+c.y*b.y};a.crossVV=function(c,b){if(c.type!==a.type||b.type!==a.type)throw'Arguments must be of type "Vector2"';return c.x*b.y-c.y*b.x};a.crossVN=function(c,b){if(c.type!==a.type||"number"!==typeof b)throw'Arguments must be of type "Vector2" and "number"';return new a(b*c.y,-b*c.x)};a.crossNV=function(c,b){if("number"!==typeof c||b.type!==a.type)throw'Arguments must be of type "number" and "Vector2"';
return new a(-c*b.y,c*b.x)};d.clip=function(c,b,d,f){var k=new a;k.x=Math.max(c,Math.min(d,this.x));k.y=Math.max(b,Math.min(f,this.y));return k};d.toString=function(){return"("+this.x+","+this.y+")"};window.Vector2=a;d.applyAsPosition=function(a,b,d){a.style["undefined"===typeof b||b?"left":"right"]=this.x+"px";a.style["undefined"===typeof d||d?"top":"bottom"]=this.y+"px"};d.applyAsSize=function(a){a.style.width=this.x+"px";a.style.height=this.y+"px"};d.applyAsMargin=function(a,b,d){var f=function(a,
c,b,d,f,q){"undefined"===typeof b||null===b?(a.style[c+d]=q+"px",a.style[c+f]=q+"px"):a.style[c+(b?d:f)]=q+"px"};f(a,"margin",b,"Left","Right",this.x);f(a,"margin",d,"Top","Bottom",this.y)};d.stretchToMe=function(c,b){var d=new a;d.x=Math[b?"min":"max"](this.x,c*this.y);d.y=d.x/c;return d};d.getCenterPosition=function(a){return this.sub(a).div(2)}})();var _slow=1;
function initSimpleUtils(){var a=navigator.userAgent.toLowerCase();ANDROID40=window.system.platform.android&&-1!=a.indexOf("4.0.");ANDROID3=3==window.system.device.version&&window.system.platform.android;ANDROID2=2==window.system.device.version&&window.system.platform.android;FORCE_FLAT=ANDROID3;DEV_3D=Modernizr.csstransforms3d;DOUBLE_CLICK_TO_ZOOM=!0;UP_SCALE=1}
var DEBUG_SHOW_FOLD_SHADOW=!1,TUNE_FOLD_SCALE_ENABLE=!0,TUNE_MINIMUM_FOLD_SCALE=0.25,TUNE_FOLD_SHADOW_ALPHA=!0,TUNE_FOLD_SHADOW_KOEFF=0.35,TIMEOUT_TO_DO_PRETRANSFORM=60*_slow,TIMEOUT_TO_SET_TRANSITION=60*_slow,TIMEOUT_TO_DO_POSTTRANSFORM=60*_slow,TIMEOUT_AFTER_ALL=60*_slow,TUNE_ZINDEX_SINGLE_CANVAS=-100,Z_INDEX_ADD=350,LAST_Z=-300,Z_STEP=5,FIRST_Z=-100,_debugNC=!1,getBookLength=function(){return publicationData.pageCount};
function SoftPlainFlipElements(a,d,e,c,b,n,f){function k(M,c){F+=1;var b=function(){this.style.webkitTransitionProperty="";this.style.webkitTransitionDuration="";this.removeEventListener("webkitTransitionEnd",b,!1);var M=this;setTimeout(function(){c&&c(M);_debugNC&&console.log(a+times()+"timeout",F,M.id);(F-=1)||setTimeout(function(){f&&f(u);g=!1},TIMEOUT_AFTER_ALL)},TIMEOUT_TO_DO_POSTTRANSFORM)};M.addEventListener("webkitTransitionEnd",b,!1)}function r(){startTime=(new Date).getTime();_debugNC&&
console.log(a+times()+"applyDestinationListen",F);k(x,function(a){b&&b(u)});B(x,t.flipDiv);k(s);B(s,t.contentObject,l+2);m.backgroundDiv!=t.backgroundDiv&&(k(w),B(w,t.backgroundDiv,l+4));A&&(k(A,function(a){}),B(A,t.nextShadow),A.style.opacity="0");v&&E&&(h(v,"end"),k(v,function(a){h(v,"start")}))}function h(a,c){var b="start"==c,d=b?TUNE_MINIMUM_FOLD_SCALE:1,w=n?0:e-H,A=dev_translate((b?H*d:0)*(n?-1:1),0,8),d=TUNE_FOLD_SCALE_ENABLE?dev_scale(d<TUNE_MINIMUM_FOLD_SCALE?TUNE_MINIMUM_FOLD_SCALE:d):"";
TUNE_FOLD_SHADOW_ALPHA&&(a.style.opacity=b?"0":"1");a.style.left=w+"px";a.style.webkitTransformOrigin=String(n?0:H)+"px 0px";a.style.webkitTransform=d+" "+A}function B(a,c,b){var d=void 0==b?a.zOffset||0:b;void 0!=b&&(a.zOffset=b);a.xOffset=c;translate(a,c,d)}function C(a,b){a.zOffset=b;translate(a,a.xOffset||0,b)}function q(){var a={};n?E?(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=-e,a.nextShadow=-y):(a.flipDiv=0,a.contentObject=e,a.backgroundDiv=-e,a.nextShadow=-e):E&&D?(a.flipDiv=0,a.contentObject=
0,a.backgroundDiv=e,a.nextShadow=e):D?(a.flipDiv=0,a.contentObject=-e,a.backgroundDiv=e,a.nextShadow=e):(a.flipDiv=-e,a.contentObject=0,a.backgroundDiv=-e,a.nextShadow=-2*e);return a}this.id=a;var u=this,E=!0,D=!0,y=0.6*e,m=q(),t,I,g,F=0,l=LAST_Z--,H=e*TUNE_FOLD_SHADOW_KOEFF,x=createDiv("flipd"+a,!0);x.style.webkitTransformStyle=ANDROID3||FORCE_FLAT?"flat":"preserve-3d";d.appendChild(x);sizeDiv(x,e,c);C(x,l);var s=createDiv("div"+a);sizeDiv(s,e,c);var G=createCanvas("cc"+a,e,c);s.appendChild(G);s.contentCanvas=
G;G=createDiv("vd"+a,e,c);s.appendChild(G);s.vectorDiv=G;G=createCanvas("tc"+a,e,c);s.appendChild(G);s.topCanvas=G;x.appendChild(s);B(s,m.contentObject,l+2);var w=createBackgroundDiv("backd"+a);sizeDiv(w,e,c);x.appendChild(w);B(w,m.backgroundDiv,l+4);var A=createShadowOnNextDiv("nextsh"+a,n);A&&(d.appendChild(A),sizeDiv(A,y,c),B(A,m.nextShadow,l));var v=createFoldShadow("foldsh"+a,H,c,n);v&&(x.appendChild(v),h(v,"start"));this.flipDiv=x;this.backgroundDiv=w;var z=function(b,c,d){_debugNC&&console.log(a+
"prepare",b.id,F);b.style.webkitTransitionProperty="-webkit-transform "+(d||"");b.style.webkitTransitionTimingFunction="cubic-bezier(0.9,0.05,0.95,1)";b.style.webkitTransitionDuration=String(c*_slow)+"s"};this.id=a;var K=function(){m=q();var a={};n?E&&D?(a.flipDiv=e,a.contentObject=-e,a.backgroundDiv=0,a.nextShadow=e-y):D&&(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=-e,a.nextShadow=-e):E&&D?(a.flipDiv=-e,a.contentObject=e,a.backgroundDiv=0,a.nextShadow=0):D?(a.flipDiv=0,a.contentObject=0,a.backgroundDiv=
e+1,a.nextShadow=e):(a.flipDiv=0,a.contentObject=-e,a.backgroundDiv=0,a.nextShadow=-e);t=a;B(x,m.flipDiv,l);B(s,m.contentObject,l+2);B(w,m.backgroundDiv,l+4);v&&h(v,"start");A&&(B(A,m.nextShadow,l),A.style.opacity="1")},L=function(a){z(x,a);z(s,a);z(w,a);A&&z(A,a,"opacity");v&&E&&z(v,a,TUNE_FOLD_SHADOW_ALPHA?"opacity":"")};this.startAnimation=function(a,b,c,d){g=!0;I=d;E=b;D=c;K();setTimeout(function(){L(a);setTimeout(function(){r()},TIMEOUT_TO_SET_TRANSITION)},TIMEOUT_TO_DO_PRETRANSFORM)};this.reset=
function(){E=!0;K()};this.getContentObject=function(){return s};this.getFlipDiv=function(){return x};this.getNextFlipper=function(){return I};this.getFadeout=function(){return E};this.getDepth=function(){return l};this.getBGDiv=function(){return w};this.setNextFlipper=function(a){I=a};this.setDepth=function(a,b){l=a;x.style.zIndex=Z_INDEX_ADD+a;s.style.zIndex=Z_INDEX_ADD+a+1;w.style.zIndex=Z_INDEX_ADD+a+3;A&&(A.style.zIndex=Z_INDEX_ADD+a);v&&(v.style.zIndex=Z_INDEX_ADD+a+4);!0!=b&&(C(x,l),C(s,l+2),
C(w,l+4),A&&B(A,m.nextShadow,l))};this.isFree=function(){return!g};this.clearContent=function(){s.contentCanvas.width=e;s.topCanvas.width=0;deleteAllChildren(s.vectorDiv)};var J;this.setBackgroundContent=function(a){J=a;deleteAllChildren(w);w.appendChild(J)};this.getBGCanvas=function(){J||(J=createFECanvas(a+"bgCont",e,c),w.appendChild(J));return J}}function createFECanvas(a,d,e){a=createCanvas(a);if(a.width!=d||a.height!=e)a.width=d,a.height=e;return a}
var createBackgroundDiv=function(a){a=createDiv(a);a.style.backgroundColor="#dddddf";return a},createShadowOnNextDiv=function(a,d){var e=createDiv(a);e.style.backgroundImage="-webkit-gradient(linear,"+(d?"right bottom,left bottom":"left bottom,right bottom")+", color-stop(1.00, rgba(0,0,0,0)),color-stop(0.00, rgba(0,0,0,0.6)) )";return e},createFoldShadow=function(a,d,e,c){a=createCanvas(a);a.width=d;a.height=e;var b=a.getContext("2d");c=c?b.createLinearGradient(d,0,0,0):b.createLinearGradient(0,
0,d,0);c.addColorStop(0,"rgba(0, 0, 0, 0)");c.addColorStop(0.72,"rgba(0, 0, 0, 0.2)");c.addColorStop(0.89,"rgba(0, 0, 0, 0.4)");c.addColorStop(1,"rgba(0, 0, 0, 0)");DEBUG_SHOW_FOLD_SHADOW?(b.lineWidth=16,b.strokeStyle="red",b.strokeRect(16,16,d-32,e-32)):(b.fillStyle=c,b.fillRect(0,0,d,e));return a},times=function(){return" "+((new Date).getTime()-startTime)+" "},sizeDim="px";
function sizeDiv(a,d,e,c){void 0==d&&void 0==e&&(d=window.innerWidth,e=window.innerHeight);a.style.width=c?d+"%":Math.ceil(d)+sizeDim;a.style.height=c?e+"%":Math.ceil(e)+sizeDim}function createDiv(a,d){var e=document.createElement("div");e.setAttribute("id",a);e.style.position="absolute";d&&(e.style.overflow="hidden");return e}function createCanvas(a,d,e){var c=document.createElement("canvas");c.setAttribute("id",a);c.style.position="absolute";void 0!=d&&void 0!=e&&sizeCanvas(c,d,e);return c}
function sizeCanvas(a,d,e){a.width=d;a.height=e}function setElementPosition(a,d){a.style.left=String(d.left).concat("px");a.style.top=String(d.top).concat("px")}function translate(a,d,e){a.style.webkitTransform="translate3d("+String(d)+sizeDim+",0px,"+String(e)+sizeDim+")"}function dev_scale(a,d,e){return prepare_xyz("scale",a,d,e)}function dev_translate(a,d,e){return prepare_xyz("translate",a,d,e)}function dev_translate_percents(a,d,e){return prepare_xyz("translate",a,d,e,"%")}
function dev_rotateXY(a){return"rotate("+a.toString()+"rad)"}function prepare_xyz(a,d,e,c,b){var n="scale"==a,f=n?1:0;b=n?"":b||sizeDim;void 0==d&&(d=f);void 0==e&&(e=f);void 0==c&&(c=f);return a+(DEV_3D?"3d("+d+b+","+e+b+","+c+b+")":"("+d+b+","+e+b+")")}var startTime;function centerRect(a,d,e,c){return{x:(a-e)/2,y:(d-c)/2}}function traceChildren(a){for(var d="",e=0;e<a.length;e++)d+=a[e].id+" ";console.log(d)}function deleteAllChildren(a){for(;a.firstChild;)a.removeChild(a.firstChild)}
function parseVectorizedContentToDiv(a,d,e,c){c="undefined"!=typeof c?c:!0;for(var b=0;4>b;b++);d=d||createDiv();for(var b=[],n=0;n<a.length;n++){var f=a[n],k=0,r=f[k++].toString(),h=f[k++].toString(),B=parseFloat(f[k++]);parseFloat(f[k++]);var C=parseFloat(f[k++]),q=parseFloat(f[k++]),u=parseFloat(f[k++]),E=f[k++].toString(),f=parseFloat(f[k++]),D=Math.round(q*e),k=q=document.createElement("p");k.style.position="absolute";k.style.whiteSpace="nowrap";q.innerText=r;q.style.fontFamily=h;k.style.top=
px(Math.round(C*e));k.style.left=px(D);h=u;C=b[h];u="undefined"==typeof C?Math.floor(u*e):C.size;q.style.fontSize=px(u);q.style.color=E;d.appendChild(k);B*=e;if(c)for(;q.offsetWidth>B&&1<u;)u-=1,q.style.fontSize=px(u);if("undefined"==typeof C)b[h]={size:u,elements:[q]};else if(C.size>=u){if(C.size>u){b[h].size=u;for(var y in C.elements)E=C.elements[y],u=E.offsetWidth,E.style.fontSize=px(b[h].size),E.style.wordSpacing="0px",E.style.wordSpacing=px((u-E.offsetWidth)/(E.innerText.split(" ").length-1))}b[h].elements.push(q)}q.style.webkitTransform=
f?dev_rotateXY(f):"";q.style.webkitTransformOrigin=f?"0 0":"";r=r.split(" ");q.style.wordSpacing="0px";q.style.wordSpacing=px((B-q.offsetWidth)/(r.length-1))}return d}function px(a){return a.toString()+"px"}
function scaleAndPositionPageContent(a,d,e){var c=UP_SCALE*parseFloat(publicationData.getPageProperty(a,"width"));a=UP_SCALE*parseFloat(publicationData.getPageProperty(a,"height"));sizeDiv(d,c,a);void 0!=e&&(d.style.left=px(e.x),d.style.top=px(e.y),e=e.width/c,d.style.webkitTransform=dev_scale(e,e),d.style.webkitTransformOrigin="0 0")}
function getPageContentRect(a,d,e){var c=parseFloat(publicationData.getPageProperty(a,"proportions"));a={};a.width=Math.min(c*e,d);a.height=a.width/c;d=centerRect(d,e,a.width,a.height);a.x=d.x;a.y=d.y;return a}function applyRectToCanvas(a,d){a.width=d.width;a.height=d.height;a.style.left=px(d.x);a.style.top=px(d.y)}function fillCanvas(a,d,e){var c=a.getContext("2d");c.fillStyle=void 0!=d?d:"red";e?c.fillRect(e.x,e.y,e.width,e.height):c.fillRect(0,0,a.width,a.height)}
function getIsPreloader(){return!0==window.preloaderIsShown}function showPreloader(){window.preloaderIsShown||(window.preloaderIsShown=!0,workspace.preloader.add())}var hidePreloaderTimeout=null;function hidePreloader(){window.preloaderIsShown&&(workspace.preloader.del(),window.preloaderIsShown=!1)}function flipPage(a){a?pageMediator.right():pageMediator.left()}function getIsPortrait(){return innerHeight>innerWidth}function getIsAlbum(){return publicationData.type==ALBUM}
function ifParamExist(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return null!=RegExp("[\\?&]"+a).exec(window.location.href)}window.debugSVG=""!=ifParamExist("s");window.debugSVG_IMG=""!=ifParamExist("i");window.debug_forceSaveScale=""!=ifParamExist("fs");var softFlip=!1;
function parseContentItems(a,d,e,c,b){if("undefined"!=typeof d&&d){var n;for(n=0;n<d.length;n++){var f=d[n],k=new Vector2(f.x,f.y),r=new Vector2(f.width,f.height),h=createDiv(a+n),k=k.mul(c),r=r.mul(c);(function(a,b,c,d){a.style.webkitTransformOrigin="0 0";var e=d?Math.sin(d):0;d=d?Math.cos(d):1;a.style.webkitTransform="matrix("+[d,e,-e,d,b.x,b.y].join()+")";sizeDiv(a,c.x,c.y,!1)})(h,k,r,f.angle);"undefined"!=typeof f.zindex&&(h.style.zIndex=f.zindex);if("highlight"==a)h.style.backgroundColor=highlight.getFillStyle(),
e.appendChild(h);else if("link"==a)h.style.backgroundColor=publicationData.linkcolor,h.style.opacity="0.23",(r=f.urls)&&0!=r.length?(f=document.createElement("a"),f.href=r[0],f.target="_blank",f.appendChild(h),e.appendChild(f)):void 0!=f.page&&(function(a){setClickEvents(h,"mdsp",!0);h.addEventListener("touchstart",function(a){a.preventDefault()});h.addEventListener(SINGLE_CLICK,function(b){b.stopPropagation();pageMediator.goToPage(parseInt(a))},!0)}(f.page),e.appendChild(h));else if("video"==a){h.id=
"video."+f.id;if(f.showImage){var B=video.getVideoImageUrl(f.imageUri);(function(a){changeUrlWhenPubl(B,function(b){a.style.backgroundImage="url('"+b+"')";a.style.backgroundSize="100% 100%"})})(h)}r=new Image;k=f.height*c;k=50<k?50:0.8*k;r.src=video.getPlayImage();h.appendChild(r);r.style.position="absolute";r.style.margin="auto";r.style.left="0";r.style.right="0";r.style.top="0";r.style.bottom="0";r.style.height=px(k);(function(a){setClickEvents(h,"mdsp",!0);h.addEventListener("touchstart",function(a){a.preventDefault()});
h.addEventListener(SINGLE_CLICK,function(b){b.stopPropagation();video.play(a.type,a.id,function(){window.resources.MAIN_FRAME.style.visibility="visible"});window.resources.MAIN_FRAME.style.visibility="hidden"},!0)})(f);e.appendChild(h)}else"cartItem"==a&&publicationData.shopInfo&&(cart.getItemQuantity(f.id),function(a,b,c,d){function f(a,b){return a.hasOwnProperty(b)?a[b]:publicationData.shopInfo.cartIconGlobals[b]}cart.getItems(function(h){var m=h[0];h=new CartItemRender(a.id,b,c,d,{orientation:f(a,
"position"),circleColor:f(a,"circleColor"),priceColor:f(a,"priceColor"),priceTagColor:f(a,"priceTagColor"),priceTagOpacity:f(a,"priceTagColorAlpha"),tagVisible:f(a,"tagVisible"),basketColor:f(a,"basketColor"),showTitle:f(a,"showTitle"),cost:m.price,title:m.name},e);(function(a,b){function c(b){b.stopPropagation();(new ProductInfoWindow(a.id)).show()}function d(a){a.stopPropagation();window.location.href=m.url}b.div.style.pointerEvents="auto";setClickEvents(b.div,"mdsp",!0);var e="Window"==f(a,"onClickAction")?
c:d;b.div.addEventListener("touchstart",function(a){a.preventDefault()},!1);b.div.addEventListener(SINGLE_CLICK,e,!0);window.cartRenders.push(b)})(a,h)},function(){throw"productsDB error";},a.id)}(f,k,r,c*b))}}}
function CartItemRender(a,d,e,c,b,n){this.itemID=a||NaN;a=18*c;var f=14*c,k=!1!==b.tagVisible,r=!1!==b.showTitle&&"string"===typeof b.title&&""!=b.title,h=12*c,B=5*c,C=5*c,q=r?0:3*c;e.x=Math.max(e.x,5*a);e.y=Math.max(e.y,3*a);var u=-1!=b.orientation.indexOf("top"),E=-1!=b.orientation.indexOf("left"),D=-1!=b.orientation.indexOf("bottom"),D=!u&&!D;n=el.createElement("div",{id:"cartItem-"+(1E3*Math.random()).toFixed(0),styles:{position:"absolute",cursor:"pointer",borderRadius:px(B),fontFamily:"Arial",
textAlign:"center",color:b.priceColor}},n);d.applyAsPosition(n);d=new Vector2(a,D?q:a);var y=e.sub(new Vector2(d.x,d.y*(D?2:1)));y.applyAsSize(n);d.applyAsMargin(n,E,D?null:u);k&&(n.style.background="rgba("+fbUtils.hexToRGB(b.priceTagColor)+","+b.priceTagOpacity+")",e=el.createElement("p",{styles:{fontWeight:"bold",fontSize:px(f),lineHeight:px(f)}},null,{textContent:fbUtils.formatPrice(b.cost)}),r?(r=new Vector2(y.x-10*c,y.y-f-C),d=el.createElement("p",{styles:{fontSize:px(h),lineHeight:px(h),width:px(r.x)}},
n,{textContent:b.title}),k=d.offsetHeight,C=el.createElement("p",{styles:{fontSize:px(h),lineHeight:px(h),marginLeft:px(5*c),marginRight:px(5*c),marginBottom:px(C)}},n,{textContent:b.title}),k<r.y?(n.removeChild(d),h=(r.y-k)/2):(k=r.y-r.y%h,h=(r.y-k)/2,n.removeChild(d),C.style.maxWidth=px(r.x),C.style.overflow="hidden",C.style.textOverflow="ellipsis",C.style.maxHeight=px(k)),C.style.marginTop=px(h)):(h=(y.y-f)/2,e.style.marginTop=px(h)),e.style.marginBottom=px(h),function(a,b){a.style.maxWidth=px(y.x);
a.style.whiteSpace="nowrap";a.style.overflow="hidden";a.style.textOverflow="ellipsis"}(e,f),n.appendChild(e));c*=3;b=el.createElement("span",{styles:{position:"absolute",background:b.circleColor,borderRadius:px(a),borderWidth:px(c),borderColor:"white",borderStyle:"solid",color:b.basketColor,verticalAlign:"middle"}},n);f=(new Vector2(a,a)).mul(2);f.applyAsSize(b);h=f.x/2;b.style.lineHeight=px(f.x-2*c);b.style.fontSize=px(h);(new Vector2(-a,D?y.y/2-a:-a)).applyAsPosition(b,E,D||u);this.updateQuantity=
function(){var a=cart.getItemQuantity(this.itemID);if("undefined"==typeof this.qty||this.qty!=a)this.qty=a,this.circleSpan.className=(0<a?"fullCartButtonInPage":"cartButtonInPage")+" cartIconShadow"};this.div=n;this.circleSpan=b;this.updateQuantity()}
function OnePage(a,d){function e(){var c;publicationData.shopInfo&&(window.cartRenders=[]);debugSVG||(E?(g.div.parentNode&&g.div.parentNode.removeChild(g.div),C()):deleteAllChildren(g.div));g.loaded?((c=document.getElementById("stubPage"))&&a.contains(c)&&a.removeChild(c),c=q().div(g.publishedSize).x,g.vector&&parseVectorizedContentToDiv(g.vector,g.div,c),debugSVG?(K.style.width=q().x+"px",K.style.height=q().y+"px",g.image.visibility="hidden"):(c=q().div(g.publishedSize).x,sizeDiv(g.div,q().x,q().y),
parseContentItems("link",publicationData.page[v].links,g.div,c),parseContentItems("video",publicationData.page[v].videos,g.div,c),parseContentItems("cartItem",publicationData.page[v].shopItems,g.div,c,publicationData.getPageProperty(v,"contentScale"))),h()):b()&&(c=document.getElementById("stubPage")||createDiv("stubPage"),sizeDiv(c,innerWidth,innerHeight),c.style.backgroundColor=publicationData.getPageProperty(v,"BGColor"),a.contains(c)||a.appendChild(c))}function c(a,c){v!=a&&(v&&b(v)&&!b(a)&&(g.image.style.visibility=
"visible"),v=a,fconsole.update("pos",v),D||showPreloader(),b()?(g.loaded=!1,m||(g.image.style.visibility="hidden"),g.size.set(publicationData.getPageProperty(v,"width"),publicationData.getPageProperty(v,"height")),d(!0),e(),hidePreloader(),c&&c()):function(){g.vector=null;g.publishedSize=new Vector2(publicationData.getPageProperty(v,"width"),publicationData.getPageProperty(v,"height"));deleteAllChildren(g.div);loadManager.addPageToQueue({skipCurrentLoading:!0,image:g.image,quality:!0,position:v,onImageLoadComplete:function(){H=
!0;g.loaded=!0;L=!1;m&&l.createPattern(g.image,"no-repeat");var a=new Vector2(g.image.naturalWidth,g.image.naturalHeight),b=g.size.x!=a.x||g.size.y!=a.y;g.size=a;d(b);debugSVG&&(K=document.createElement("object"),K.setAttribute("type","image/svg+xml"),K.setAttribute("data","content/psout3.svg"),K.style.pointerEvents="none",g.div.appendChild(K),g.div.style.backgroundColor="white")},onPageLoadError:function(){g.loaded=!1},onAllIsComplete:function(a,b){g.vector=b;e();hidePreloader();c&&c()},onJSLoadComplete:function(){}})}())}
function b(a){a=void 0!=a?a:v;return publicationData.getPageProperty(a,"stub")}function n(){var a=v+(z.right?1:-1);z.loaded=!1;z.image=new Image;t&&I.appendChild(z.image);loadManager.addPageToQueue({skipCurrentLoading:!1,image:z.image,quality:!0,position:a,onImageLoadComplete:function(){z.loaded=!0;if(t){var a=new Vector2(z.image.naturalWidth,z.image.naturalHeight),b=q().x,a=(new Vector2(innerWidth,innerHeight)).stretchToMe(a.x/a.y,!0);z.image.style.width=a.x+"px";z.image.style.height=a.y+"px";r(z.image,
z.right?b:-a.x,0,!1)}}})}function f(){function a(b,e,w){var A=Math.round(e.x);e=Math.round(e.y);var f=0<A?0:Math.abs(A/w),v=0<e?0:Math.abs(e/w),f=Math.min(b.width*w,c)/w-f,v=Math.min(b.height*w,d)/w-v;(f||v)&&l.drawImage(b,A,e,b.width*w,b.height*w)}if(g.loaded||b()){var c=F.width,d=F.height;if(!L&&!z.offset&&(z.changed||H||G||w||A)){l.clearRect(0,0,c,d);if(b())l.fillStyle=publicationData.getPageProperty(v,"BGColor"),l.fillRect(0,0,c,d);else{a(g.image,x,s);var e=Math.round(x.x),f=Math.round(x.y);r(g.div,
e,f,!1)}A=w=G=H=!1;z.changed=!1}if(z.offset&&z.changed){var h,k,f=z.offset,e=innerWidth;z.right?(e=0+(e-f),f/=2,h=e+f,k=f):(h=0,k=f/2,e=h+k,f=k);l.clearRect(0,0,c,d);a(g.image,x,s);if(z.loaded){var m=z.image;if(debug_forceSaveScale)N=z.right?h/s:0,O=0,t=k/s,p=d/s;else var p=(new Vector2(c,d)).stretchToMe(m.width/m.height,!1),N=h*m.width/p.x,O=0,t=k*m.width/p.x,p=d*m.width/p.x;l.drawImage(m,N,O,t,p,h,0,k,F.height)}else l.fillStyle="#efefef",l.fillRect(h,0,k,F.height);k=h=0;z.right?k=f:h=f;h=l.createLinearGradient(e+
h,0,e+k,0);h.addColorStop(0,"rgba(0, 0, 0, 0)");h.addColorStop(0.72,"rgba(0, 0, 0, 0.2)");h.addColorStop(0.89,"rgba(0, 0, 0, 0.4)");h.addColorStop(1,"rgba(0, 0, 0, 0)");l.fillStyle="#dddddf";l.fillRect(e,0,f,F.height);l.fillStyle=h;l.fillRect(e,0,f,F.height);z.changed=!1}}}function k(){var a=q();if(w||H||A)g.image.style.width=1!=s?px(a.x):null,g.image.style.height=1!=s?px(a.y):null,a=g.size.map(function(a){return Math.floor((a-1)*s-1)}),sizeDiv(I,a.x,a.y),sizeDiv(g.div,a.x,a.y),H=w=!1;if(G||A){var a=
Math.round(x.x),b=Math.round(x.y);r(I,a,b,!1);A=G=!1}}function r(a,b,c,d){d=d?"%":"px";a.style.left=b.toString()+d;a.style.top=c.toString()+d}function h(){search.active&&search.pages[v]?highlight.getHighlights(v,function(a){B();g.div.appendChild(J);parseContentItems("highlight",a,J,q().div(g.publishedSize).x)}):B()}function B(){deleteAllChildren(J);g.div.contains(J)&&g.div.removeChild(J)}function C(){g.div=createDiv("contentDiv");m?a.appendChild(g.div):(g.div.style.webkitTransform=null,I.appendChild(g.div))}
function q(a){a=a||s;return g.size.map(function(b){return Math.floor(b*a)})}var u=window.system.platform.version,E="safari"==window.system.browser.name&&fbUtils.isArray(u)&&2<=u.length&&"4"==u[0]&&2<=u[1],D="safari"==window.system.browser.name&&fbUtils.isArray(u)&&3==u.length&&"4"==u[0]&&"0"==u[1]&&"4"==u[2],y=ifParamExist("c")?"canvas":"webkit",m="canvas"==y,t="webkit"==y;if(t)var I=createDiv("scrollDiv");var g={};g.bufferImage=new Image;var F=document.createElement("canvas"),l=F.getContext("2d");
g.loaded=!1;var H,x=new Vector2(0,0),s=0.1,G,w,A,v;g.size=new Vector2;g.publishedSize=new Vector2(100,100);this.goToPage=function(a){c(a,function(){customEvents.fireEvent(ANDROID_PAGE_PREPARED,{page:b()?[]:[v]})})};this.resize=function(){e();m?(F.width=innerWidth,F.height=innerHeight):sizeDiv(a,innerWidth,innerHeight)};this.setOffset=function(a,b){x.set(a);b&&t||(G=!0)};var z={};this.setFlipOffset=function(a,b){!z.offset&&a&&n();z.offset=a;z.right=b;z.changed=!0};this.setScale=function(a,b){s=a;b&&
t||(w=!0)};this.startPinchMode=function(){g.div.style.visibility="hidden";debugSVG||m||(this.pinchRedrawInterval=setInterval(function(){A=!0},1E3))};this.stopPinchMode=function(){e();this.pinchRedrawInterval&&(clearInterval(this.pinchRedrawInterval),this.pinchRedrawInterval=null);g.div.style.visibility="visible";t&&(w=G=!0)};this.updateTopContent=function(){e()};var K,L=!1;this.setFinished=function(){L=!0;t&&a.removeChild(z.image)};var J=createDiv("highlightContainer");this.setHighlight=function(a){a?
h():(search.active=!1,B())};this.set=function(b,d){fconsole.update("mode",y);m?(a.style.overflow="visible",a.appendChild(F)):(a.style.position="absolute",I.style.webkitTransform=null,a.style.webkitTransform=null,a.style.overflow="hidden",a.appendChild(I));g.image=new Image;m||(g.image.style.webkitTransform=null,g.image.style.position="absolute",I.appendChild(g.image),g.image.style.border="1px solid #333333");C();c(b,d)};this.getScaledSize=q;this.getImageLoaded=function(){return g.loaded};this.isStub=
function(){return b()};this.getContentSize=function(){return g.size};this.drawFrame=m?f:k;this.canFlip=function(a){return a?v<getBookLength():1<v}}
function SimpleViewer(a){function d(){(new Date).getTime();window.requestAnimFrame=window.requestAnimFrame||function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();(function A(){t.drawFrame(G);requestAnimFrame(A)})()}function e(a,b){a!=y&&(y=a,fconsole.update("scale",y),t.setScale(y,b),b||B())}function c(a,b){a.sub(D).vlength()&&(D=
a,t.setOffset(D,b))}function b(a,b){var c=new n(b);return a.clip(c.xmin,c.ymin,c.xmax,c.ymax)}function n(a){var b=t.getScaledSize(a).x;a=t.getScaledSize(a).y;var c=a>innerHeight;b>innerWidth?(this.xmax=0,this.xmin=innerWidth-b):this.xmax=this.xmin=innerWidth/2-b/2;c?(this.ymax=0,this.ymin=innerHeight-a):this.ymax=this.ymin=innerHeight/2-a/2}function f(a,d,f){var g=y;a=d&&h(m.map,y)>=m.map.length-1?m.defaultPos:h(m.map,y*(d?2:1))+(d?0:a?1:-1);a=Math.min(Math.max(a,0),m.map.length-1);a=m.map[a];f=f?
f:u?new Vector2(innerWidth/2,innerHeight/2):new Vector2(publicationData.rtlMode?innerWidth:0,0);g=D.sub(f.sub(D).mul(a/g-1));g=b(g,a);e(a);c(g);t.updateTopContent()}function k(a,d){var f,g=t.getContentSize();f="change"==a;var k="resize"==a,n=f&&!d&&E,q=m,s=f&&d||k;if(s){var l=(new Vector2(innerWidth,innerHeight)).stretchToMe(g.x/g.y,!0).x/g.x,q=innerWidth/g.x,g=q/0.8,x;u?(l=[l],x=1.5):(l=[q],x=Math.sqrt(g/q),l=l.concat([q*x,g]));for(;2.15>l[l.length-1]*x;)l[l.length]=l[l.length-1]*x;r(l,0.25,x);r(l,
0.5,x);r(l,0.75,x);r(l,1,x);q={defaultPos:0,map:l,textVisibleMaxPos:4}}fconsole.log(f,d,k,s||u||!window.debug_forceSaveScale&&h(m.map,y)>m.textVisibleMaxPos);k=s||u||!window.debug_forceSaveScale&&h(m.map,y)>m.textVisibleMaxPos?q.map[q.defaultPos]:y;s=t.getScaledSize(k).x;g=t.getScaledSize(k).y;l=D.vclone();n||(l.x=u?(innerWidth-s)/2:publicationData.rtlMode?innerWidth-s:0);f&&(l.y=u?(innerHeight-g)/2:0);f=b(l,k);m=q;c(f);e(k)}function r(a,b,c){for(var d=Math.abs(a[0]-b),e=1,f=0;e<a.length;){var g=
Math.abs(a[e]-b);g<d&&(d=g,f=e);e++}(b+d)/(b-d)<c&&0!=f&&(a[f]=b)}function h(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(0==c){if(b<=d||1==a.length)return 0}else{if(c==a.length-1)return a.length-1;if(b<a[c])return b<=(a[c-1]+a[c])/2?c-1:c;if(b<=(a[c]+a[c+1])/2)return c}}throw"determineScale abnormal return";}function B(){customEvents.fireEvent(ZOOM_LEVEL_CHANGED_FOR_WORKSPACE,{isSmallest:0==h(m.map,y),isLargest:h(m.map,y)==m.map.length-1})}function C(a,d,e){function f(a){g.active=!1;a.ctrlKey&&
(d.sendPinch&&(d.startPinch&&d.startPinch(new Vector2(a.pageX,a.pageY)),d.sendPinch(y,new Vector2(0,0),new Vector2(a.pageX,a.pageY)),d.endPinch&&d.endPinch()),a.stopImmediatePropagation());a.altKey&&d.sendPinch&&(d.startPinch&&d.startPinch(new Vector2(a.pageX,a.pageY)),d.sendPinch(B,new Vector2(0,0),new Vector2(a.pageX,a.pageY)),d.endPinch&&d.endPinch());a.shiftKey&&d.handleDoubleClick(a);var b=a.currentTarget;if(Modernizr.touch){if(1<a.touches.length){k(a);return}b.addEventListener(DOWN_EVENT,k,
!1)}b.removeEventListener(DOWN_EVENT,f,!1);b.addEventListener(MOVE_EVENT,h,!1);b.addEventListener(UP_EVENT,n,!1);b.addEventListener("touchcancel",n,!1);b.addEventListener("mouseout",n,!1);a=a.touches?a.touches[0]:a;b.pos=new Vector2(a.pageX,a.pageY);G.disabledThisTime=!1;u()}function h(a){a.preventDefault();var d=a.touches?a.touches[0]:a,d=new Vector2(d.pageX,d.pageY),f=a.currentTarget.pos;a.currentTarget.pos=d;a=d.sub(f);p.dv0x=p.dv0x||a.x;if(p.timeStamp){d=(new Date).getTime();f=d-p.timeStamp;p.vDiff=
p.vDiff.add(a);p.moveTime+=f;p.timeStamp=d;p.trackLength+=Math.abs(a.x);p.movePath.push({dv:a,time:f});d=t.getScaledSize(void 0).x<=innerWidth||t.isStub();e&&(f=p.vDiff.y?Math.abs(p.vDiff.x)/Math.abs(p.vDiff.y):1E10,Math.abs(p.vDiff.x)>C/1.5*(1.5-f)?p.horizontalAllowed=!0:!p.vDiff.y||1.5<f||p.horizontalAllowed||(a.x=0));if(1E3<p.moveTime||p.dv0x&&a.x&&p.dv0x/Math.abs(p.dv0x)!=a.x/Math.abs(a.x))p.slideDisabledThisTime=!0;!p.slideDisabledThisTime&&p.vDiff.x&&0.5>Math.abs(p.vDiff.y)/Math.abs(p.vDiff.x)&&
(a.y=0);if(d=d&&!p.slideDisabledThisTime&&4<p.trackLength&&75<p.moveTime){for(var g=p.movePath,d=t.getScaledSize(void 0).y>innerHeight,w,k,l,m=l=k=f=w=0;m<g.length;m++){var n=g[m];w+=n.dv.x;f+=n.dv.y;k+=Math.abs(n.dv.x);l+=n.time}g=Math.abs(w);k=Math.abs(k-g);w=0>w;14>k&&7<g&&(!d&&1>=Math.abs(f)/g||d&&g>7+200*Math.abs(f)/g&&g>0.2*l)?(flipPage(w),d=!0):d=!1}d&&(p.slideDisabledThisTime=!0)}if(a.x||a.y)c(b(D.add(a))),0!=x&&(s={dv:a,time:(new Date).getTime()-x}),x=(new Date).getTime()}function k(a){if(1<
a.touches.length){var b=a.currentTarget,c=a.touches[0];a=a.touches[1];b.pos=new Vector2((c.pageX+a.pageX)/2,(c.pageY+a.pageY)/2);b.startDist=q(c,a);b.removeEventListener(UP_EVENT,n,!1);b.removeEventListener("touchcancel",n,!1);b.removeEventListener(MOVE_EVENT,h,!1);b.removeEventListener(DOWN_EVENT,k,!1);b.addEventListener(MOVE_EVENT,l,!1);b.addEventListener(UP_EVENT,m,!1);b.addEventListener("touchcancel",m,!1);d.startPinch&&d.startPinch(b.pos)}}function l(a){a.preventDefault();if(1<a.touches.length){var b=
a.currentTarget,c=a.touches[0],e=a.touches[1];a=q(c,e);var c=new Vector2((c.pageX+e.pageX)/2,(c.pageY+e.pageY)/2),e=a/b.startDist,f=c.sub(b.pos);d.sendPinch(e,f,c);b.startDist=a;b.pos=c}}function m(a){var b=a.currentTarget,c=a.touches.length;if(0<c){b.removeEventListener(MOVE_EVENT,l,!1);b.removeEventListener(UP_EVENT,m,!1);b.removeEventListener("touchcancel",m,!1);b.addEventListener(MOVE_EVENT,h,!1);b.addEventListener(UP_EVENT,n,!1);b.addEventListener("touchcancel",n,!1);var e=a.touches?a.touches[0]:
a;b.pos=new Vector2(e.pageX,e.pageY);u()}d.endPinch&&d.endPinch();0==c&&n(a)}function r(a){p.timeoutID||(p.timeoutID=setTimeout(function(){p.horizontalAllowed=!1;p.timeoutID=null},a))}function n(a){var b=a.currentTarget;Modernizr.touch&&a.touches&&0!=a.touches.length||(b.removeEventListener(MOVE_EVENT,h,!1),b.removeEventListener(UP_EVENT,n,!1),b.removeEventListener("touchcancel",n,!1),b.removeEventListener("mouseout",n,!1),b.addEventListener(DOWN_EVENT,f,!1));p.xDiff=0;p.yDiff=0;r(E);G.active?G.finishing||
G.stop():(s&&100>(new Date).getTime()-x&&(s.dv.x&&t.getScaledSize(void 0).x>innerWidth||s.dv.y&&t.getScaledSize(void 0).y>innerHeight)&&g.startKinematics(s.dv,s.time),s=null,x=0)}function u(){p.timeStamp=(new Date).getTime();p.moveTime=0;p.movePath=[];p.trackLength=0;p.slideDisabledThisTime=!1;p.dv0x=0;p.vDiff.set(0,0)}var y=1.15,B=0.8,C=innerWidth/4,E=1250;a.addEventListener(DOWN_EVENT,f,!1);var p={};p.vDiff=new Vector2(0,0)}function q(a,b){var c=a.pageX-b.pageX,d=a.pageY-b.pageY;return Math.sqrt(c*
c+d*d)}var u=publicationData.type==PT_PHOTOALBUM,E=publicationData.type==PT_BOOK,D=new Vector2(0,0),y=0.1,m,t=new OnePage(a,function(a){k("change",a)});this.goToPage=function(a){t.goToPage(a)};var I=this;setInterval(function(){I.width==innerWidth&&I.height==innerHeight||I.resize()},1E3);this.resize=function(){this.width=innerWidth;this.height=innerHeight;t.getImageLoaded()&&k("resize");t.resize()};var g={startKinematics:function(a,b){},active:!1,iterate:function(a){this.time+=a;this.time=Math.min(this.time,
this.duration);a=this.time/this.duration-1;this.time==this.duration&&(this.active=!1);return g.startPoint.add(g.endPoint.sub(g.startPoint).mul(a*a*a+1))}},F,l=function(){var a=document.createElement("p");a.style.opacity="0.7";a.style.backgroundColor="#e0efee";a.style.color="#11111f";a.style.fontSize="18px";a.style.zIndex=1E3;a.style.position="absolute";this.element=a};l.prototype.setText=function(a){this.element.innerText=a};l.prototype.positionMe=function(a){this.element.style.left=px(a.x-this.element.offsetWidth/
2);this.element.style.top=px(a.y-this.element.offsetHeight/2)};var H=new l;this.sendMove=function(a){};var x=0,s;this.stopDrag=function(){};this.startPinch=function(b){g.active=!1;a.appendChild(H.element);H.positionMe(b);F?(clearTimeout(F),F=null):t.startPinchMode()};this.endPinch=function(){a.removeChild(H.element);F=setTimeout(function(){t.stopPinchMode();F=null;B()},t.isStub()||debugSVG?0:500)};this.sendPinch=function(a,d,f){y*a<m.map[0]?a=m.map[0]/y:y*a>m.map[m.map.length-1]&&(a=m.map[m.map.length-
1]/y);d=d.add(f.sub(D).mul(1-a));d=D.add(d);a*=y;d=b(d,a);e(a,!0);c(d,!0);H.setText(window.LOCALS.ZOOM+" "+(100*y).toFixed(0)+"%");H.positionMe(f)};this.incZoom=function(){f(!0)};this.decZoom=function(){f(!1)};this.setHighlight=function(a){t.setHighlight(a)};this.set=function(b,c){setElementPosition(a,{left:0,top:0});t.set(b,c);this.resize();d();C(a,this,publicationData.type!=PT_PHOTOALBUM)};this.clear=function(){};this.handleDoubleClick=function(a){a=a.touches?a.touches[0]:a;a=new Vector2(a.pageX,
a.pageY);f(!0,!0,a)};var G={active:!1,handleFlipFinished:function(){t.setFinished();flipPage(this.right)},start:function(a,b){this.drag=0;this.userDrag=a;this.right=b;this.active=!0;this.setChanged()},stop:function(){this.active=this.finishing=!1;this.setChanged()},updateDrag:function(a){this.userDrag=a},setChanged:function(){this.changed=!0;t.setFlipOffset(this.active?this.drag:0,this.right)},iterate:function(a){this.finishing?(this.drag+=(2*innerWidth-this.drag)/2,1>Math.abs(this.drag-2*innerWidth)&&
(this.handleFlipFinished(),this.stop())):this.drag+=(this.userDrag-this.drag)/5;this.setChanged()},finish:function(){this.finishing=!0;this.setChanged()}}};
