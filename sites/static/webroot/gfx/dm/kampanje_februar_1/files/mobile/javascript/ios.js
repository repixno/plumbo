// Created 11/6/2013 5:00:34 PM
function IOSBook(r,c){this.type=c||orientationObserver.getType();r=r||1;this.onePage=new OnePagePublication(r);this.twoPage=new TwoPagePublication(r);this.zoomBook=new ZoomIOSPublication(1);this.onePage.initSizes();this.twoPage.initSizes();this.touchTrigg=0;1==this.type?this.onePage.drawBook():2==this.type?this.twoPage.drawBook():3==this.type&&(this.zoomBook.initSizes(3.3),this.zoomBook.drawBook());this.goToPage=function(a){1==this.type?this.onePage.goToPage(a):2==this.type?this.twoPage.goToPage(a):
3==this.type&&this.zoomBook.goToPage(a)};var d=this,n=function(a){1==d.type&&d.onePage.goToZoom(a);if(2==d.type){var b=a.target.id.match(/\d+/i);d.twoPage.goToZoom(b)}3==d.type&&(2===orientationObserver.getType()?d.zoomBook.goToTwoPage(a):d.zoomBook.goToOnePage(a))};el.id("mainFrame").addEventListener("dblclick",n);el.id("mainFrame").addEventListener("touchend",function(){0===d.touchTrigg?(d.touchTrigg++,setTimeout(function(){d.touchTrigg=0},250)):d.twoPage.gesture||d.onePage.gesture||d.zoomBook.gesture||
n(event)});customEvents.addListener(ROTATE_DEVICE,function(a){2===a.data&&1===d.type?(d.type=2,d.onePage.destroyBook(),setTimeout(function(){d.twoPage.initSizes();var a=pageTable.getUserIDFromFileID(pageMediator.page);d.twoPage.drawBook(a)},10)):1===a.data&&1===d.type?(d.type=1,d.onePage.destroyBook(),setTimeout(function(){d.onePage.initSizes();d.onePage.drawBook(pageMediator.page)},10)):1===a.data&&2===d.type?(d.type=1,d.twoPage.destroyBook(),setTimeout(function(){d.onePage.initSizes();d.onePage.drawBook(pageMediator.page)},
10)):2===a.data&&2===d.type&&(d.type=2,d.twoPage.destroyBook(),setTimeout(function(){d.twoPage.initSizes();d.twoPage.drawBook(pageMediator.page)},10))});customEvents.addListener(ZOOM_ANIMATION_START,function(){});customEvents.addListener(ZOOM_ANIMATION_END,function(a){d.type=3;customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:3});d.zoomBook.initSizes(a.data.zoomFactor,a.data.page);d.zoomBook.drawBook(a.data.page);if(GAEnable){var b=window.location.pathname.split("/");_trackEvent(b[b.length-4]+"","Zooming",
"page"+a.data.page)}});customEvents.addListener(ZOOM_ANIMATION_END_TO_ONE,function(a){d.type=1;customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:1});d.onePage.initSizes();d.onePage.drawBook(a.data.page);if(GAEnable){var b=window.location.pathname.split("/");_trackEvent(b[b.length-4]+"","Zooming out","page"+a.data.page)}});customEvents.addListener(ZOOM_ANIMATION_END_TO_TWO,function(a){customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:2});d.type=2;d.twoPage.initSizes();d.twoPage.drawBook(a.data.page);if(GAEnable){var b=
window.location.pathname.split("/");_trackEvent(b[b.length-4]+"","Zooming out","page"+a.data.page)}});customEvents.addListener(ZOOM_ZOOM_ANIMATION_END,function(a){customEvents.fireEvent(CHANGE_BOOK_TYPE,{type:3});d.type=3;d.zoomBook.initSizes(a.data.zoomFactor,a.data.page);d.zoomBook.drawBook(a.data.page,a.data.startPos)});el.id("mainFrame").addEventListener("gesturestart",function(){ZOOM_LOCK||(1===d.type?d.onePage.gesturestart(event):2===d.type?d.twoPage.gesture||d.twoPage.gesturestart(event):3===
d.type&&d.zoomBook.gesturestart(event))},!0);el.id("mainFrame").addEventListener("gesturechange",function(){ZOOM_LOCK||(1===d.type?d.onePage.gesturechange(event):2===d.type?d.twoPage.gesturechange(event):3===d.type&&d.zoomBook.gesturechange(event))},!0);el.id("mainFrame").addEventListener("gestureend",function(){ZOOM_LOCK||(1===d.type?d.onePage.gestureend(event):2===d.type?d.twoPage.gestureend(event):3===d.type&&d.zoomBook.gestureend(event))},!0);customEvents.addListener(START_ZOOM_PRELOADER,function(a){ZOOM_LOCK=
!0;a=void 0!=a.data?a.data.shift:0;var b=el.add("div");b.id="preloaderZOOM";b.style.position="absolute";b.style.left=window.innerWidth/2+a+"px";b.style.top=window.innerHeight/2+"px";b.style.width="10em";b.style.height="10em";b.style.margin="-3em 0 0 -5em";b.style.zIndex=1E7;b.style.webkitTransform="translateZ(150px)";workspace.preloader.add(b);el.id("mainFrame").appendChild(b);page=null});customEvents.addListener(STOP_ZOOM_PRELOADER,function(){el.del("preloaderZOOM");setTimeout(function(){ZOOM_LOCK=
!1},300)});var a=function(){1===d.type?d.onePage.touch(event):2===d.type?d.twoPage.touch(event):3===d.type&&d.zoomBook.touch(event);system.device.iphone&&window.scrollTo(0,1)},b=function(){1===d.type?d.onePage.endmove(event):2===d.type?d.twoPage.endmove(event):3===d.type&&d.zoomBook.endmove(event)};Modernizr.touch?(el.id("mainFrame").addEventListener("touchstart",a,!0),el.id("mainFrame").addEventListener("touchend",b,!0)):(el.id("mainFrame").addEventListener("mousedown",a,!0),el.id("mainFrame").addEventListener("mouseup",
b,!0))}iosContent={};
function OnePagePublication(r){this.HORIZONTAL_MARGIN=this.VERTICAL_MARGIN=10;this.bookLeft=this.bookTop=this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.active=this.block=!1;this.currentPage=r||1;this.pageBuff=1;this.flipSpeed=500;this.gesture=!1;this.loadBuffers={};this.initSizes=function(){var a=publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>a?(this.bookHeight=window.innerHeight-2*this.VERTICAL_MARGIN,this.bookWidth=this.bookHeight*
a,this.bookLeft=(window.innerWidth-this.bookWidth)/2,this.bookTop=this.VERTICAL_MARGIN):(this.bookWidth=window.innerWidth-2*this.HORIZONTAL_MARGIN,this.bookHeight=this.bookWidth/a,this.bookLeft=this.HORIZONTAL_MARGIN,this.bookTop=(window.innerHeight-this.bookHeight)/2);this.pageHeight=this.bookHeight;this.pageWidth=this.bookWidth;this.translateX=2*this.bookLeft+this.pageWidth};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active){highlight.show(a.currentPage);
for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.show(b)}});customEvents.addListener(CANCEL_SEARCH,function(){if(a.active){highlight.hide(a.currentPage);for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.hide(b)}});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});customEvents.addListener(IOS_LOAD_PAGE_START,function(a){var f=
a.data.page;1!==a.data.type||publicationData.page[f].stub||(a=el.add("div"),a.id="preloader"+f,a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.width="10em",a.style.height="10em",a.style.margin="-3em 0 0 -5em",workspace.preloader.add(a),publicationData.page[f].wide?el.id("widePage"+f).appendChild(a):el.id("divPage"+f).appendChild(a))});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){var f=a.data.page;1!==a.data.type||publicationData.page[f].stub||el.del("preloader"+
f)});customEvents.addListener(IOS_LOAD_VECTOR_END,function(a){})};this.drawBook=function(a){this.active=!0;a=a||-10;-10!=a&&(this.currentPage=a);this.init();el.id("publicationDiv")?el.id("publicationDiv"):(a=el.add("div"),a.id="publicationDiv",a.style.width=this.bookWidth+"px",a.style.height=this.bookHeight+"px",a.style.top=this.bookTop+"px",a.style.left=this.bookLeft+"px",a.style.position="absolute",a.style.textAlign="center",a.style.opacity="1",el.id("mainFrame").appendChild(a));this.drawPage(this.currentPage);
for(a=this.currentPage-this.pageBuff;a<=1*this.currentPage+this.pageBuff;a++)a!==this.currentPage&&this.drawPage(a)};this.drawPage=function(a){if(publicationData.page[a]&&!el.id("divPage"+a)){var b=publicationData.page[a].wide;if(b){var f=el.add("div");f.id="divPage"+a;f.className="oneBook";f.style.width=this.pageWidth+"px";f.style.height=this.pageHeight+"px";f.style.position="absolute";f.style.backgroundColor="rgba(0,0,0,0)";f.style.color="black";f.style.left=publicationData.rtlMode?a>this.currentPage?
-window.innerWidth+"px":a<this.currentPage?window.innerWidth+"px":"":a<this.currentPage?-window.innerWidth+"px":a>this.currentPage?window.innerWidth+"px":"";var c=publicationData.rtlMode?publicationData.pageCount+a:publicationData.pageCount-a;f.style.zIndex=c+"";c=null;el.id("publicationDiv").appendChild(f)}var e=el.add("div");e.id=b?"widePage"+a:"divPage"+a;e.className="oneBook";e.style.width=this.pageWidth+"px";e.style.height=b?this.pageHeight/2+"px":this.pageHeight+"px";e.style.position="absolute";
"photo_album"==publicationData.type||"document"==publicationData.type?e.style.backgroundColor="rgba(0,0,0,0)":(e.style.backgroundColor=publicationData.page[a].BGColor||publicationData.page.defaults.BGColor,HTML5lib.boxShadow(e,"0px 0px 3px #000"));e.style.color="black";b&&(e.style.top=this.pageHeight/4+"px");publicationData.rtlMode?!b&&a>this.currentPage?e.style.left=-window.innerWidth+"px":!b&&a<this.currentPage?e.style.left=window.innerWidth+"px":b||(e.style.left=""):!b&&a<this.currentPage?e.style.left=
-window.innerWidth+"px":!b&&a>this.currentPage?e.style.left=window.innerWidth+"px":b||(e.style.left="");c=publicationData.rtlMode?publicationData.pageCount+a:publicationData.pageCount-a;e.style.zIndex=c+"";c=null;c=this.injectCanvas(e,a);b?f.appendChild(e):el.id("publicationDiv").appendChild(e);publicationData.page[a].stub?(customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:a,type:1}),customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:a,type:1}),ZOOM_LOCK&&el.id("exPage"+a)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),
setTimeout(function(){el.del("exPage"+a)},50))):(customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:a,type:1}),this.loadImage(c,a))}};this.injectCanvas=function(a,b){var f=publicationData.page[b].wide?this.pageHeight/2:this.pageHeight,c=publicationData.page[b].width||publicationData.page.defaults.width,e=publicationData.page[b].height||publicationData.page.defaults.height,g=c/e;if(this.pageWidth/f>g)var h=f,k=h*g,g=(this.pageWidth-k)/2,f=0;else k=this.pageWidth,h=k/g,g=0,f=(f-h)/2;var d=el.add("canvas");
d.id="substraitCanvas"+b;d.width=k;d.height=h;d.style.position="absolute";d.style.left=g+"px";d.style.top=f+"px";a.appendChild(d);var p=k/(2*c);"photo_album"!=publicationData.type&&"document"!=publicationData.type||HTML5lib.boxShadow(d,"0px 0px 3px #000");var l=publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===l||"js+png"===l)l=el.add("div"),l.id="contentDiv"+b,l.style.width=2*c+"px",l.style.height=2*e+"px",l.style.position="absolute",l.style.left=g+"px",l.style.top=
f+"px",l.style.webkitTransformOrigin="0% 0%",l.style.webkitTransform="scale("+p+")",a.appendChild(l);c=el.add("canvas");c.id="highlightCanvas"+b;c.width=k;c.height=h;c.style.position="absolute";c.style.left=g+"px";c.style.top=f+"px";c.style.opacity=0;a.appendChild(c);(function(a,f){var c=function(){new LinksLayer(a,b);highlight.show(b,a,f);a.style.opacity=1;customEvents.removeListener(IOS_LOAD_BITMAP_END,c)};customEvents.addListener(IOS_LOAD_BITMAP_END,c)})(c,d);return d};this.destroyPage=function(a){el.id("divPage"+
a)&&el.del("divPage"+a)};this.destroyBook=function(){el.del("publicationDiv");this.active=!1};this.goToPage=function(a){var b=this;if(a==this.currentPage+1)a=this.currentPage-this.pageBuff,b.destroyPage(a),publicationData.rtlMode?this.shiftRight():this.shiftLeft(),this.currentPage++,this.drawPage(this.currentPage+this.pageBuff);else if(a==this.currentPage-1)a=this.currentPage+this.pageBuff,b.destroyPage(a),publicationData.rtlMode?this.shiftLeft():this.shiftRight(),this.currentPage--,this.drawPage(this.currentPage-
this.pageBuff);else if(a!=this.currentPage){if(1*a>1*this.currentPage){var f=1*this.currentPage+1;this.clearContent(f);publicationData.rtlMode?this.shiftRight():this.shiftLeft()}else f=this.currentPage-1,this.clearContent(f),publicationData.rtlMode?this.shiftLeft():this.shiftRight();this.currentPage=a;var c=function(){b.destroyBook();b.drawBook(b.currentPage);delete c};window.setTimeout(c,b.flipSpeed);pageMediator.changePage(a)}};this.clearContent=function(a){el.id("divPage"+a)&&(el.id("divPage"+
a).style.backgroundColor="white",el.id("substraitCanvas"+a)&&el.del("substraitCanvas"+a),el.id("videoDiv"+a)&&el.del("videoDiv"+a),el.id("contentDiv"+a)&&el.del("contentDiv"+a),el.id("highlightCanvas"+a)&&el.del("highlightCanvas"+a))};this.shiftLeft=function(){for(var a=this.currentPage-this.pageBuff;a<=this.currentPage+this.pageBuff;a++)if(el.id("divPage"+a)){var b=el.id("divPage"+a);HTML5lib.duration(b,this.flipSpeed);0==1*HTML5lib.getParseTranslate(b).x?(customEvents.fireEvent(BOOK_FLIPPING_START),
HTML5lib.translate(b,-this.translateX,0,0)):1*HTML5lib.getParseTranslate(b).x==-this.translateX?HTML5lib.translate(b,2*-this.translateX,0,0):1*HTML5lib.getParseTranslate(b).x==2*this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,this.translateX,0,0)):(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,0,0,0))}var f=this;setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:f.currentPage})},this.flipSpeed)};this.shiftRight=function(){for(var a=
this.currentPage-this.pageBuff;a<=this.currentPage+this.pageBuff;a++)if(el.id("divPage"+a)){var b=el.id("divPage"+a);HTML5lib.duration(b,this.flipSpeed);0==1*HTML5lib.getParseTranslate(b).x?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,this.translateX,0,0)):1*HTML5lib.getParseTranslate(b).x==this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,2*this.translateX,0,0)):1*HTML5lib.getParseTranslate(b).x==2*-this.translateX?(customEvents.fireEvent(BOOK_FLIPPING_START),
HTML5lib.translate(b,-this.translateX,0,0)):(customEvents.fireEvent(BOOK_FLIPPING_START),HTML5lib.translate(b,0,0,0))}var f=this;setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:f.currentPage})},this.flipSpeed)};this.loadImage=function(a,b){var f=a.getContext("2d");f.fillStyle="rgb(255,255,255)";var c=publicationData.page[b].proportions||publicationData.page.defaults.proportions,e=publicationData.size.proportions,g=a.width,h=a.height,d=new Image,m=publicationData.page[b].format||
publicationData.page.defaults.format,p=publicationData.page[b].zoomFormat||publicationData.page.defaults.zoomFormat||publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===m){var l=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".jpg";this.loadContent(b,g)}else"js+png"===m?(l=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png",this.loadContent(b,g)):"jpg"===p?l=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.jpg":"png"===p&&(l=ASSETS_FOLDER+"/pages/page"+
this.getName(b)+"_i2.png");changeUrlWhenPubl(l,function(a){d.src=a});if(c>=e)var s=g,q=(s/c+0.5).toFixed(0),w=0,n=(h-q)/2;else q=h,s=(q*c+0.5).toFixed(0),w=(g-s)/2,n=0;d.onload=function(){ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+b)},50));f.drawImage(d,w,n,s,q);customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:b,type:1})}};this.addContentDiv=function(){};this.loadContent=function(a,b){var f=ASSETS_FOLDER+"/pages/ios/page"+this.getName(a)+
".js",c=document.getElementsByTagName("head")[0],e=document.createElement("script");e.id="formPrinter";e.type="text/javascript";changeUrlWhenPubl(f,function(a){e.src=a});c.appendChild(e);window.fakeLoadComplete=function(a){window.loadBuffers[a]=window.loadBuffer;for(i in window.loadBuffers[a]){var b=el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*
window.loadBuffers[a][i][4]+"px";b.style.left=2*window.loadBuffers[a][i][5]+"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var f=document.createTextNode(window.loadBuffers[a][i][0]);b.appendChild(f);el.id("contentDiv"+a).appendChild(b);customEvents.fireEvent(IOS_LOAD_VECTOR_END,{page:a,type:1})}}};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};var c=this,d=-1,n=-1;this.touch=function(){c.block||c.gesture||
ZOOM_LOCK||(d=Modernizr.touch?event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){if(!c.block&&!c.gesture&&!ZOOM_LOCK&&(n=Modernizr.touch?event.changedTouches[0].pageX:event.pageX,-1!=d&&-1!=n)){var a=d-n;70<a?pageMediator.right():-70>a&&pageMediator.left();n=d=-1}};this.gesturestart=function(a){c.gesture=!0;a=c.currentPage;c.gestureDiv=el.id("divPage"+a);customEvents.fireEvent(ZOOM_ANIMATION_START);c.maxZoom=fbUtils.getMaxZoom(c.pageWidth,c.pageHeight);c.gestureDiv.style.top=c.bookTop+
"px";c.gestureDiv.style.left=c.bookLeft+"px";c.gestureDiv.id="exPage"+c.currentPage;HTML5lib.boxShadow(c.gestureDiv,"");HTML5lib.duration(c.gestureDiv,0);c.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px)";el.id("mainFrame").appendChild(c.gestureDiv);el.id("videoDiv"+a)&&(el.id("videoDiv"+a).style.opacity=0);c.destroyBook()};this.gesturechange=function(a){1<a.scale&&c.maxZoom>=a.scale&&(c.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+a.scale+","+a.scale+","+a.scale+
")")};this.gestureend=function(a){var b=c.currentPage;setTimeout(function(){c.gesture=!1},150);var f=c.maxZoom>a.scale?a.scale:c.maxZoom;a=function(){var a=c.pageWidth;publicationData.page[b].wide&&(a/=2);a=a*f/(publicationData.page[b].width||publicationData.page.defaults.width);customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:a,page:b})};1.2>f?(setTimeout(function(){HTML5lib.duration(c.gestureDiv,200);c.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d(1.2,1.2,1.2)"},
10),setTimeout(a,210),f=1.2):(c.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+f+","+f+","+f+")",a())};this.goToZoom=function(a){if(!this.block&&!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);el.id("videoDiv"+c)&&(el.id("videoDiv"+c).style.opacity=0);var b=fbUtils.getMaxZoom(this.pageWidth,this.pageHeight),f=this,c=this.currentPage,e=publicationData.page[c].wide,g=el.id("divPage"+this.currentPage);g.style.top=this.bookTop+"px";g.style.left=this.bookLeft+"px";g.style.webkitTransform=
"";g.id="exPage"+c;el.id("videoDiv"+c)&&(el.id("videoDiv"+c).style.opacity=0);el.id("mainFrame").appendChild(g);a=1.5*window.innerWidth/this.pageWidth;a=a>b?b:a;setTimeout(function(){HTML5lib.duration(g,300);HTML5lib.changeOnlyScale(g,a,a,a)},10);var b=publicationData.page[c].width||publicationData.page.defaults.width,h=f.pageWidth;e&&(h/=2);var d=h*a/b;setTimeout(function(){f.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:d,page:c})},
360)}}}
function TwoPagePublication(r){r=pageTable.getUserIDFromFileID(r||1);this.HORIZONTAL_MARGIN=this.VERTICAL_MARGIN=30;this.bookLeft=this.bookTop=this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.pageBuff=3;this.currentPage={left:0,right:0};this.flipSpeed=1E3;this.loadBuffers={};this.active=this.gesture=this.block=!1;var c=this;this.doubleClick=0;this.currentPage.minus=function(){this.left-=2;this.right-=2};this.currentPage.plus=function(){this.left=1*this.left+2;this.right=1*this.right+
2};this.initSizes=function(){var a=2*publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>a?(this.bookHeight=window.innerHeight-2*this.VERTICAL_MARGIN,this.bookWidth=this.bookHeight*a,this.bookLeft=(window.innerWidth-this.bookWidth)/2,this.bookTop=this.VERTICAL_MARGIN):(this.bookWidth=window.innerWidth-2*this.HORIZONTAL_MARGIN,this.bookHeight=this.bookWidth/a,this.bookLeft=this.HORIZONTAL_MARGIN,this.bookTop=(window.innerHeight-this.bookHeight)/2);this.pageHeight=
this.bookHeight;this.pageWidth=this.bookWidth/2};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active)if(publicationData.rtlMode)for(var b=a.currentPage.right-a.pageBuff;b<=1*a.currentPage.left+a.pageBuff;b++)highlight.show(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b));else for(b=a.currentPage.left-a.pageBuff;b<=1*a.currentPage.right+a.pageBuff;b++)highlight.show(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b))});customEvents.addListener(CANCEL_SEARCH,
function(){if(a.active)if(publicationData.rtlMode)for(var b=a.currentPage.right-a.pageBuff;b<=1*a.currentPage.left+a.pageBuff;b++)highlight.hide(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b));else for(b=a.currentPage.left-a.pageBuff;b<=1*a.currentPage.right+a.pageBuff;b++)highlight.hide(pageTable.getFileIDFromUserID(b),el.id("highlightCanvas"+b))});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});
customEvents.addListener(IOS_LOAD_PAGE_START,function(a){if(2===a.data.type){a=a.data.page;var f=el.add("div");f.id="preloader"+a;f.style.position="absolute";f.style.left="50%";f.style.top="50%";f.style.width="10em";f.style.height="10em";f.style.margin="-3em 0 0 -5em";workspace.preloader.add(f);el.id("pageDiv"+a).appendChild(f)}});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){2===a.data.type&&el.del("preloader"+a.data.page)});customEvents.addListener(IOS_LOAD_VECTOR_END,function(a){})};
this.drawBook=function(a){this.active=!0;a=a||-10;-10!=a&&this.pageConverter(a);this.initSizes();this.init();a=document.createElement("div");a.id="publicationDiv";a.style.webkitPerspective="3000";a.style.width=this.bookWidth+"px";a.style.height=this.bookHeight+"px";a.style.top=this.bookTop+"px";a.style.left=this.bookLeft+"px";a.style.textAlign="center";a.style.position="absolute";a.style.opacity="1";a.style.zIndex="1000";el.id("mainFrame").appendChild(a);if(publicationData.rtlMode)for(a=this.currentPage.right-
this.pageBuff;a<=1*this.currentPage.left+this.pageBuff;a++)this.drawPage(a);else for(a=this.currentPage.left-this.pageBuff;a<=1*this.currentPage.right+this.pageBuff;a++)this.drawPage(a);1==this.currentPage.right||1==this.currentPage.left?this.drawBookShadow("first"):this.currentPage.left!=publicationData.pageUserCount||publicationData.rtlMode?this.currentPage.right==publicationData.pageUserCount&&publicationData.rtlMode?this.drawBookShadow("last"):this.drawBookShadow("std"):this.drawBookShadow("last")};
this.drawPage=function(a){if(0<a&&a<=publicationData.pageUserCount){var b=0!=a%2?a+"x"+(1*a+1):a-1+"x"+a;if(el.id(b))f=el.id(b);else{var f=el.add("div");f.id=b;f.style.width=this.pageWidth+"px";f.style.height=this.pageHeight+"px";f.style.position="absolute";f.style.webkitTransformStyle="preserve-3d";f.style.webkitTransition="-webkit-transform "+this.flipSpeed+"ms";publicationData.rtlMode?a>=this.currentPage.left?(f.style.left=0,f.style.zIndex=publicationData.pageCount-a,f.style.webkitTransform="rotate3d(0, 1, 0, 0deg)",
f.style.webkitTransformOrigin="100% 100%"):a<=this.currentPage.right&&(f.style.left=this.pageWidth+"px",f.style.zIndex=a,f.style.webkitTransform="rotate3d(0, -1, 0, 0deg)",f.style.webkitTransformOrigin="0% 0%"):a<=this.currentPage.left?(f.style.left=0,f.style.zIndex=a,f.style.webkitTransform="rotate3d(0, 1, 0, 0deg)",f.style.webkitTransformOrigin="100% 100%"):a>=this.currentPage.right&&(f.style.left=this.pageWidth+"px",f.style.zIndex=publicationData.pageCount-a,f.style.webkitTransform="rotate3d(0, -1, 0, 0deg)",
f.style.webkitTransformOrigin="0% 0%")}b=el.add("div");b.id="pageDiv"+a;b.style.position="absolute";b.style.width=this.pageWidth+"px";b.style.height=this.pageHeight+"px";b.style.overflow="hidden";b.className="page";b.style.webkitBackfaceVisibility="hidden";b.style.backgroundColor=publicationData.page[pageTable.getFileIDFromUserID(a)].BGColor||publicationData.page.defaults.BGColor;if(publicationData.rtlMode)if(a>=this.currentPage.left&&0==a%2){b.style.zIndex="-1";var c=-1;b.style.webkitTransform="rotateY(180deg)"}else a>=
this.currentPage.left&&0!=a%2?(b.style.zIndex="1",c=1):a<=this.currentPage.right&&0==a%2?(b.style.zIndex="1",c=1):a<=this.currentPage.right&&0!=a%2&&(b.style.zIndex="-1",c=-1,b.style.webkitTransform="rotateY(180deg)");else a<=this.currentPage.left&&0==a%2?(b.style.zIndex="1",c=1):a<=this.currentPage.left&&0!=a%2?(b.style.zIndex="-1",b.style.webkitTransform="rotateY(180deg)",c=-1):a>=this.currentPage.right&&0==a%2?(b.style.zIndex="-1",b.style.webkitTransform="rotateY(180deg)",c=-1):a>=this.currentPage.right&&
0!=a%2&&(b.style.zIndex="1",c=1);f.appendChild(b);this.drawPageContent(b,a,c);el.id("publicationDiv").appendChild(f);if(publicationData.page[pageTable.getFileIDFromUserID(a)].stub){var e=pageTable.getFileIDFromUserID(a);ZOOM_LOCK&&el.id("exPage"+e)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+e)},50))}else customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:a,type:2})}};this.drawPageContent=function(a,b,f){var c=pageTable.getFileIDFromUserID(b),e=this.pageHeight,
g=publicationData.page[c].wide?2*this.pageWidth:this.pageWidth,h=publicationData.page[c].width||publicationData.page.defaults.width,d=publicationData.page[c].height||publicationData.page.defaults.height,m=h/d;if(g/e>m)var p=e,l=p*m,g=(g-l)/2,e=0;else l=g,p=l/m,g=0,e=(e-p)/2;g=publicationData.rtlMode?0==b%2&&publicationData.page[c].wide?g-this.pageWidth:g:0!=b%2&&publicationData.page[c].wide?g-this.pageWidth:g;m=el.add("canvas");m.id="substraitCanvas"+b;m.width=l;m.height=p;m.style.position="absolute";
m.style.left=g+"px";m.style.top=e+"px";m.style.zIndex=f;m.style.webkitBackfaceVisibility="hidden";a.appendChild(m);var s=l/(2*h),q=publicationData.page[pageTable.getFileIDFromUserID(b)].format||publicationData.page.defaults.format;if("js+jpg"===q||"js+png"===q)q=el.add("div"),q.id="contentDiv"+b,q.style.width=2*h+"px",q.style.height=2*d+"px",q.style.position="absolute",q.style.left=g+"px",q.style.top=e+"px",q.style.webkitTransformOrigin="0% 0%",q.style.webkitTransform="scale("+s+")",q.style.zIndex=
f,a.appendChild(q);1!=b&&(h=el.add("canvas"),h.id="shadow"+b,h.width=100,h.height=this.pageHeight,h.style.position="absolute",h.style.zIndex=f,0==b%2?0==b%2&&b!=publicationData.pageUserCount&&(publicationData.rtlMode?(h.style.left="0px",this.drawRightShadow(h)):(h.style.left=this.pageWidth-100+"px",this.drawLeftShadow(h))):publicationData.rtlMode?(h.style.left=this.pageWidth-100+"px",this.drawLeftShadow(h)):(h.style.left="0px",this.drawRightShadow(h)),a.appendChild(h));h=el.add("canvas");h.id="highlightCanvas"+
b;h.width=l;h.height=p;h.style.position="absolute";h.style.left=g+"px";h.style.top=e+"px";h.style.zIndex=f;a.appendChild(h);(function(a,f){customEvents.addListener(IOS_LOAD_BITMAP_END,function(){new LinksLayer(a,pageTable.getFileIDFromUserID(b));highlight.show(pageTable.getFileIDFromUserID(b),a,f)})})(h,m);if(publicationData.page[c].stub){customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:b,type:2});var n=pageTable.getFileIDFromUserID(b);ZOOM_LOCK&&el.id("exPage"+n)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),
setTimeout(function(){el.del("exPage"+n)},50),ZOOM_LOCK=!1)}else this.loadImage(m,c,b)};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};this.loadImage=function(a,b,f){var c=a.getContext("2d");c.fillStyle="rgb(255,255,255)";var e=publicationData.page[b].proportions||publicationData.page.defaults.proportions,g=publicationData.size.proportions,h=a.width;a=a.height;var d=new Image,m=publicationData.page[b].format||publicationData.page.defaults.format,p=
publicationData.page[b].zoomFormat||publicationData.page.defaults.zoomFormat||publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===m){var l=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".jpg";this.loadContent(f,h)}else"js+png"===m?(l=COMMON_FOLDER+"/page-substrates/page"+this.getName(b)+".png",this.loadContent(f,h)):"jpg"===p?l=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.jpg":"png"===p&&(l=ASSETS_FOLDER+"/pages/page"+this.getName(b)+"_i2.png");changeUrlWhenPubl(l,
function(a){d.src=a});if(e>=g)var s=h,q=(s/e+0.5).toFixed(0),n=0,r=(a-q)/2;else q=a,s=(q*e+0.5).toFixed(0),n=(h-s)/2,r=0;d.onload=function(){ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+b)},50));fileID=null;c.drawImage(d,n,r,s,q);customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:f,type:2})}};this.loadContent=function(a,b){var c=pageTable.getFileIDFromUserID(a),c=ASSETS_FOLDER+"/pages/ios/page"+this.getName(c)+".js",d=document.getElementsByTagName("head")[0],
e=document.createElement("script");e.id="formPrinter";e.type="text/javascript";changeUrlWhenPubl(c,function(a){e.src=a});d.appendChild(e);window.fakeLoadComplete=function(a){window.loadBuffers[a]=window.loadBuffer;for(i in window.loadBuffers[a]){var b=el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*window.loadBuffers[a][i][4]+"px";b.style.left=2*window.loadBuffers[a][i][5]+
"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var c=document.createTextNode(window.loadBuffers[a][i][0]);b.appendChild(c);c=pageTable.getUserIDFromFileID(a);el.id("contentDiv"+c).appendChild(b)}}};this.destroyPage=function(a){el.del(a)};this.clearPage=function(a){el.id("substraitCanvas"+a)&&el.del("substraitCanvas"+a);el.id("contentDiv"+a)&&el.del("contentDiv"+a);el.id("highlightCanvas"+a)&&el.del("highlightCanvas"+a)};this.goToPage=function(a){a=
pageTable.getUserIDFromFileID(a);if(publicationData.rtlMode)if(a>=this.currentPage.right-2&&a<this.currentPage.right){var b=1*this.currentPage.right+3+"x"+(1*this.currentPage.left+3);el.id(b)&&this.destroyPage(b);this.shiftLeft();this.currentPage.minus();this.drawPage(1*this.currentPage.left-this.pageBuff);this.drawPage(1*this.currentPage.right-this.pageBuff)}else if(a<=1*this.currentPage.left+2&&a>this.currentPage.left)b=1*this.currentPage.right-3+"x"+(1*this.currentPage.left-3),el.id(b)&&this.destroyPage(b),
this.shiftRight(),this.currentPage.plus(),this.drawPage(1*this.currentPage.left+this.pageBuff),this.drawPage(1*this.currentPage.right+this.pageBuff);else{if(a!=this.currentPage.left&&a!=this.currentPage.right){a<this.currentPage.right?(this.clearPage(1*this.currentPage.right-1),this.clearPage(1*this.currentPage.right-2),this.shiftLeft()):(this.clearPage(1*this.currentPage.left+1),this.clearPage(1*this.currentPage.left+2),this.shiftRight());this.pageConverter(a);var c=this;setTimeout(function(){c.destroyBook();
c.drawBook(a)},this.flipSpeed)}}else a<=this.currentPage.right+2&&a>this.currentPage.right?(this.shiftLeft(),b=1*this.currentPage.left-3+"x"+(1*this.currentPage.right-3),this.currentPage.plus(),el.id(b)&&this.destroyPage(b),this.drawPage(1*this.currentPage.left+this.pageBuff),this.drawPage(1*this.currentPage.right+this.pageBuff)):a>=this.currentPage.left-2&&a<this.currentPage.left?(this.shiftRight(),b=1*this.currentPage.left+3+"x"+(1*this.currentPage.right+3),this.currentPage.minus(),el.id(b)&&this.destroyPage(b),
this.drawPage(1*this.currentPage.left-this.pageBuff),this.drawPage(1*this.currentPage.right-this.pageBuff)):a!=this.currentPage.left&&a!=this.currentPage.right&&(a>this.currentPage.right?(this.clearPage(1*this.currentPage.right+1),this.clearPage(1*this.currentPage.right+2),this.shiftLeft()):(this.clearPage(1*this.currentPage.left-1),this.clearPage(1*this.currentPage.left-2),this.shiftRight()),this.pageConverter(a),c=this,setTimeout(function(){c.destroyBook();c.drawBook(a)},this.flipSpeed))};this.shiftLeft=
function(){if(publicationData.rtlMode)var a=1*this.currentPage.right-1+"x"+this.currentPage.right,b=publicationData.pageCount-this.currentPage.right,c=89999+this.currentPage.right;else a=this.currentPage.right+"x"+(1*this.currentPage.right+1),b=this.currentPage.right,c=1E5-this.currentPage.right;var d=el.id(a);customEvents.fireEvent(BOOK_FLIPPING_START);d.style.webkitTransform="rotate3d(0, -1, 0, 0deg)"==d.style.webkitTransform?"rotate3d(0, -1, 0, 179."+c+"deg)":"rotate3d(0, 1, 0, 0deg)";var e=this;
setTimeout(function(){d.style.zIndex=b;for(var a=d.getElementsByTagName("*"),c=0;c<a.length;c++){var f=a[c].style.zIndex;a[c].style.zIndex=1==f?-1:100==f?-100:-100==f?100:1}},this.flipSpeed/3);var e=this,g=e.currentPage.right;publicationData.rtlMode?(2==g&&e.drawBookShadow("first"),e=this,a=function(){g==publicationData.pageUserCount&&e.drawBookShadow("std");if(0<e.currentPage.left&&e.currentPage.right<=publicationData.pageUserCount)var a=[e.currentPage.left,e.currentPage.right];else 0>=e.currentPage.left?
a=[e.currentPage.right]:e.currentPage.right>publicationData.pageUserCount&&(a=[e.currentPage.left]);customEvents.fireEvent(BOOK_FLIPPING_END,{page:a})}):(g==publicationData.pageUserCount-1&&e.drawBookShadow("last"),e=this,a=function(){1==g&&e.drawBookShadow("std");if(0<e.currentPage.left&&e.currentPage.right<=publicationData.pageUserCount)var a=[e.currentPage.left,e.currentPage.right];else 0>=e.currentPage.left?a=[e.currentPage.right]:e.currentPage.right>publicationData.pageUserCount&&(a=[e.currentPage.left]);
customEvents.fireEvent(BOOK_FLIPPING_END,{page:a})});setTimeout(a,this.flipSpeed)};this.shiftRight=function(){var a=this;if(publicationData.rtlMode)var b=this.currentPage.left+"x"+(1*this.currentPage.left+1),c=this.currentPage.left,d=1E5-this.currentPage.left;else b=1*this.currentPage.left-1+"x"+this.currentPage.left,c=publicationData.pageCount-this.currentPage.left,d=89999+this.currentPage.right;var e=el.id(b);customEvents.fireEvent(BOOK_FLIPPING_START);e.style.webkitTransform="rotate3d(0, 1, 0, 0deg)"==
e.style.webkitTransform?"rotate3d(0, 1, 0, 179."+d+"deg)":"rotate3d(0, -1, 0, 0deg)";a=this;setTimeout(function(){for(var a=e.getElementsByTagName("*"),b=0;b<a.length;b++){var d=a[b].style.zIndex;a[b].style.zIndex=1==d?-1:100==d?-100:-100==d?100:1}e.style.zIndex=c},this.flipSpeed/3);var g=a.currentPage.left;publicationData.rtlMode?(g==publicationData.pageUserCount-1&&a.drawBookShadow("last"),a=this,b=function(){1==g&&a.drawBookShadow("std");if(0<a.currentPage.left&&a.currentPage.right<=publicationData.pageUserCount)var b=
[a.currentPage.left,a.currentPage.right];else 0>=a.currentPage.left?b=[a.currentPage.right]:a.currentPage.right>publicationData.pageUserCount&&(b=[a.currentPage.left]);customEvents.fireEvent(BOOK_FLIPPING_END,{page:b})}):(2==g&&a.drawBookShadow("first"),a=this,b=function(){g==publicationData.pageUserCount&&a.drawBookShadow("std");if(0<a.currentPage.left&&a.currentPage.right<=publicationData.pageUserCount)var b=[a.currentPage.left,a.currentPage.right];else 0>=a.currentPage.left?b=[a.currentPage.right]:
a.currentPage.right>publicationData.pageUserCount&&(b=[a.currentPage.left]);customEvents.fireEvent(BOOK_FLIPPING_END,{page:b})});setTimeout(b,this.flipSpeed)};var d=-1,n=-1,c=this;this.touch=function(){c.block||c.gesture||ZOOM_LOCK||(d=Modernizr.touch?event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){if(!c.block&&!c.gesture&&!ZOOM_LOCK&&(n=Modernizr.touch?event.changedTouches[0].pageX:event.pageX,-1!=d&&-1!=n)){var a=d-n;70<a?pageMediator.right():-70>a&&pageMediator.left();n=d=-1}};
this.gesturestart=function(a){c.gestureStartTrigg=!0;customEvents.fireEvent(ZOOM_ANIMATION_START);c.gesture=!0;a=a.target.id.match(/\d+/i);var b=pageTable.getFileIDFromUserID(a);publicationData.page[b].wide&&0!=a%2&&!publicationData.rtlMode&&(a-=1);publicationData.page[b].wide&&0===a%2&&publicationData.rtlMode&&(a=1*a+1);c.gestureDiv=el.id("pageDiv"+a);c.gesturePage=a;c.maxZoom=publicationData.page[b].wide?fbUtils.getMaxZoom(c.bookWidth,c.pageHeight):fbUtils.getMaxZoom(c.pageWidth,c.pageHeight);el.id("mainFrame").appendChild(c.gestureDiv);
el.del("shadow"+a);c.gestureDiv.style.webkitTransform="";c.gestureDiv.style.zIndex=1E5;c.gestureDiv.id="exPage"+b;c.gestureDiv.style.top=c.bookTop+"px";c.gestureDiv.style.webkitTransformOrigin="50% 50%";publicationData.page[b].wide&&(c.gestureDiv.style.width=2*c.pageWidth+"px");publicationData.rtlMode&&0===a%2?c.gestureDiv.style.left=c.bookLeft+c.pageWidth+"px":publicationData.rtlMode||0!==a%2?publicationData.rtlMode||0==a%2?publicationData.rtlMode&&0!=a%2&&(c.gestureDiv.style.left=c.bookLeft+"px"):
c.gestureDiv.style.left=c.bookLeft+c.pageWidth+"px":c.gestureDiv.style.left=c.bookLeft+"px"};this.gesturechange=function(a){1<a.scale&&c.maxZoom>=a.scale&&(c.gestureDiv.style.webkitTransform="translate3d(0px, 0px, 0px) scale3d("+a.scale+","+a.scale+","+a.scale+")")};this.gestureend=function(a){if(c.gestureStartTrigg){c.gestureStartTrigg=!1;var b=1.3;setTimeout(function(){c.gesture=!1},150);var f=pageTable.getFileIDFromUserID(c.gesturePage);pageMediator.changePage(f);var d=c.gesturePage;a=a.scale>
c.maxZoom?c.maxZoom:a.scale;a<b&&(a=b);var e=c.pageWidth*a/(publicationData.page[f].width||publicationData.page.defaults.width);c.destroyBook();c.gestureDiv.style.webkitTransitionDuration="300ms";if(publicationData.rtlMode&&0===d%2)var g=-c.pageWidth/2;else publicationData.rtlMode||0!==d%2?publicationData.rtlMode||0==d%2?publicationData.rtlMode&&0!=d%2&&(g=c.pageWidth/2):g=-c.pageWidth/2:g=c.pageWidth/2;publicationData.page[f].wide&&(g=0);(b=a)?(c.gestureDiv.style.webkitTransitionDuration="300ms",
c.gestureDiv.style.webkitTransform="translate3d("+g+"px, 0px, 0px) scale3d("+a+","+a+","+a+")",setTimeout(function(){customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:e,page:f})},310)):(c.gestureDiv.style.webkitTransform="translate3d("+g+"px, 0px, 0px) scale3d("+a+","+a+","+a+")",customEvents.fireEvent(START_ZOOM_PRELOADER),customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:e,page:f}))}};this.destroyBook=function(){el.del("publicationDiv");this.active=
!1};this.pageConverter=function(a){publicationData.rtlMode?0!=a%2?(this.currentPage.left=a,this.currentPage.right=a-1):(this.currentPage.left=1*a+1,this.currentPage.right=a):0!=a%2?(this.currentPage.left=a-1,this.currentPage.right=a):(this.currentPage.left=a,this.currentPage.right=1*a+1);this.currentPage.left*=1;this.currentPage.right*=1};this.pageConverter(r);this.drawBookShadow=function(a){var b=publicationData.pageUserCount+"x"+publicationData.pageUserCount,c=publicationData.pageUserCount-3+"x"+
(publicationData.pageUserCount-2);"first"==a||2===publicationData.pageUserCount?(el.id("3x4")?HTML5lib.boxShadow(el.id("3x4"),"0px 0px 3px #000"):HTML5lib.boxShadow(el.id("1x2"),"0px 0px 3px #000"),HTML5lib.boxShadow(el.id("publicationDiv"),"0px 0px 0px #000")):"last"==a?(el.id(c)?HTML5lib.boxShadow(el.id(c),"0px 0px 3px #000"):HTML5lib.boxShadow(el.id(b),"0px 0px 3px #000"),HTML5lib.boxShadow(el.id("publicationDiv"),"0px 0px 0px #000")):(HTML5lib.boxShadow(el.id("publicationDiv"),"0px 0px 3px #000"),
el.id(c)?HTML5lib.boxShadow(el.id(c),"0px 0px 0px #000"):el.id(b)?HTML5lib.boxShadow(el.id(b),"0px 0px 0px #000"):el.id("pageDiv3")?HTML5lib.boxShadow(el.id("3x4"),"0px 0px 0px #000"):el.id("pageDiv1")&&HTML5lib.boxShadow(el.id("1x2"),"0px 0px 0px #000"))};this.goToZoom=function(a){if(!this.block&&!ZOOM_LOCK){var b=pageTable.getFileIDFromUserID(a);maxZoom=publicationData.page[b].wide?fbUtils.getMaxZoom(this.bookWidth,this.pageHeight):fbUtils.getMaxZoom(this.pageWidth,this.pageHeight);pageMediator.changePage(b);
customEvents.fireEvent(ZOOM_ANIMATION_START);publicationData.page[b].wide&&0!=a%2&&!publicationData.rtlMode&&(a-=1);publicationData.page[b].wide&&0==a%2&&publicationData.rtlMode&&(a=1*a+1);var c=el.id("pageDiv"+a);el.id("mainFrame").appendChild(c);c.style.webkitTransform="";c.style.zIndex=99999;c.id="exPage"+b;c.style.top=this.bookTop+"px";publicationData.rtlMode&&0===a%2?c.style.left=this.bookLeft+this.pageWidth+"px":publicationData.rtlMode||0!==a%2?publicationData.rtlMode||0==a%2?publicationData.rtlMode&&
0!=a%2&&(c.style.left=this.bookLeft+"px"):c.style.left=this.bookLeft+this.pageWidth+"px":c.style.left=this.bookLeft+"px";el.del("shadow"+a);publicationData.page[b].wide&&(c.style.width=2*this.pageWidth+"px");var d=window.innerWidth/(publicationData.page[b].wide?this.bookWidth:this.pageWidth),d=d>maxZoom?maxZoom:d,e=this,g=function(){c.style.webkitTransitionDuration="300ms";c.style.webkitBackfaceVisibility="";publicationData.page[b].wide||(c.style.left=e.bookLeft+e.pageWidth/2+"px");c.style.webkitTransformOrigin=
"50% 50%";c.style.webkitTransform="translate3d(0px,0px,10px) scale3d("+d+","+d+","+d+")";g=null};setTimeout(g,10);var h=e.pageWidth*d/(publicationData.page[b].width||publicationData.page.defaults.width);setTimeout(function(){e.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END,{zoomFactor:h,page:b})},350)}};this.drawLeftShadow=function(a){ctx=a.getContext("2d");var b=ctx.createLinearGradient(0,0,100,0);b.addColorStop(0,"rgba(0,0,0,0)");b.addColorStop(0.6,
"rgba(0,0,0,0.1)");b.addColorStop(0.95,"rgba(0,0,0,0.2)");b.addColorStop(1,"rgba(0,0,0,0.65)");ctx.fillStyle=b;ctx.fillRect(0,0,a.width,a.height)};this.drawRightShadow=function(a){ctx=a.getContext("2d");var b=ctx.createLinearGradient(this.bookWidth/20,0,0,0);b.addColorStop(0,"rgba(0,0,0,0.0)");b.addColorStop(0.4,"rgba(0,0,0,0.05)");b.addColorStop(0.8,"rgba(0,0,0,0.20)");b.addColorStop(1,"rgba(0,0,0,0.15)");ctx.fillStyle=b;ctx.fillRect(0,0,a.width,a.height)}}
function ZoomIOSPublication(r){this.bookHeight=this.bookWidth=this.pageHeight=this.pageWidth=0;this.pageShift=20;this.active=!1;this.currentPage=r||1;this.pageBuff=0;this.flipSpeed=500;this.loadBuffers={};this.gesture=!1;this.zoomFactor=this.translateScrollY=this.translateScrollX=0;this.zoomIOSpeed=500;this.scrollbars=this.block=this.active=!1;this.scrolls={};this.init=function(){var a=this;customEvents.addListener(SHOW_SEARCH_RESULTS,function(){if(a.active){highlight.show(a.currentPage);for(var b=
a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.show(b)}});customEvents.addListener(CANCEL_SEARCH,function(){if(a.active){highlight.hide(a.currentPage);for(var b=a.currentPage-a.pageBuff;b<=1*a.currentPage+a.pageBuff;b++)b!==a.currentPage&&highlight.hide(b)}});customEvents.addListener(BOOK_FLIPPING_START,function(){a.block=!0});customEvents.addListener(BOOK_FLIPPING_END,function(){a.block=!1});customEvents.addListener(ROTATE_DEVICE,function(){a.active&&a.rotate()});
customEvents.addListener(IOS_LOAD_PAGE_START,function(a){if(3===a.data.type){a=a.data.page;var c=el.add("div");c.id="preloader"+a;c.style.position="absolute";c.style.left=window.innerWidth/2+"px";c.style.top=window.innerHeight/2+"px";c.style.width="10em";c.style.height="10em";c.style.margin="-3em 0 0 -5em";workspace.preloader.add(c);el.id("page"+a).appendChild(c)}});customEvents.addListener(IOS_LOAD_BITMAP_END,function(a){3===a.data.type&&el.del("preloader"+a.data.page)});customEvents.addListener(IOS_LOAD_VECTOR_END,
function(a){})};this.initSizes=function(a,b){this.zoomFactor=a=a||this.zoomFactor;b=b||this.currentPage;var c=publicationData.size.width/publicationData.size.height;this.pageWidth=(publicationData.page[b].width||publicationData.page.defaults.width)*a;this.pageHeight=this.pageWidth/c;this.pageLeft=(window.innerWidth-this.pageWidth)/2;this.pageTop=(window.innerHeight-this.pageHeight)/2;this.widePageWidth=2*this.pageWidth;this.widePageLeft=(window.innerWidth-this.widePageWidth)/2};this.drawBook=function(a,
b){b=b||!1;this.active=!0;this.currentPage=a;this.init();var c=el.add("div");c.id="zoomBook";c.style.width="100%";c.style.height="100%";c.style.position="absolute";el.id("mainFrame").appendChild(c);for(c=this.currentPage-this.pageBuff;c<=1*this.currentPage+this.pageBuff;c++)0<c&&c<=publicationData.pageCount&&this.drawPage(c,b)};this.drawPage=function(a,b){var c=publicationData.page[a].wide;b=c?b||{x:this.widePageLeft,y:this.pageTop}:b||{x:this.pageLeft,y:this.pageTop};var d=el.add("div");d.id="pageMask"+
a;d.style.position="absolute";d.style.width="100%";d.style.height="100%";d.style.webkitTransform="translate3d("+(publicationData.rtlMode?(this.currentPage-a)*window.innerWidth:(a-this.currentPage)*window.innerWidth)+"px,0px,0px)";var e=el.add("div");e.id="page"+a;e.style.position="absolute";e.style.overflow="hidden";e.style.width=c?this.widePageWidth+"px":this.pageWidth+"px";e.style.height=this.pageHeight+"px";HTML5lib.boxShadow(e,"0px 0px 3px #000");"photo_album"!=publicationData.type&&"document"!=
publicationData.type&&(e.style.backgroundColor=publicationData.page[a].BGColor||publicationData.page.defaults.BGColor);0<this.pageTop&&(e.style.top=this.pageTop+"px");c?0<this.widePageLeft&&(e.style.left=this.widePageLeft+"px"):0<this.pageLeft&&(e.style.left=this.pageLeft+"px");d.appendChild(e);el.id("zoomBook").appendChild(d);var g=this.injectCanvas(e,a),e=null;this.scrolls[a]=new iScroll("pageMask"+a,{hScrollbar:this.scrollbars,vScrollbar:this.scrollbars,zoom:!1});b.y=0==b.y?b.y-g:b.y;this.scrolls[a].scrollTo(b.x,
b.y,0);var h=this,k=c?this.widePageWidth:this.pageWidth;this.slideMode=k>window.innerWidth?!0:!1;var m=function(){h.slideMode&&(150<h.scrolls[a].x&&(1!=h.currentPage&&!publicationData.rtlMode||h.currentPage!=publicationData.pageCount&&publicationData.rtlMode)?(pageMediator.left(),Modernizr.touch?el.id("pageMask"+a).removeEventListener("touchmove",m):el.id("pageMask"+a).removeEventListener("mousemove",m),h.scrolls[a].destroy()):h.scrolls[a].x<window.innerWidth-k-150&&(h.currentPage!=publicationData.pageCount&&
!publicationData.rtlMode||1!=h.currentPage&&publicationData.rtlMode)&&(pageMediator.right(),Modernizr.touch?el.id("pageMask"+a).removeEventListener("touchmove",m):el.id("pageMask"+a).removeEventListener("mousemove",m),h.scrolls[a].destroy()))};Modernizr.touch?d.addEventListener("touchmove",m):d.addEventListener("mousemove",m);d=null};this.injectCanvas=function(a,b){var c=publicationData.page[b].wide,d=this.pageHeight,e=publicationData.page[b].width||publicationData.page.defaults.width,g=publicationData.page[b].height||
publicationData.page.defaults.height,h=e/g,k=c?this.widePageWidth:this.pageWidth;if((c?this.widePageWidth/d:this.pageWidth/d)>h)var c=d,m=c*h,h=(k-m)/2,d=0;else m=k,c=m/h,h=0,d=(d-c)/2;var d=d.toFixed(0),p=(c/3).toFixed(0),k=el.add("canvas");k.id="1substraitCanvas"+b;k.width=m;k.height=p;k.style.position="absolute";k.style.left=h+"px";k.style.top=d+"px";k.style.webkitTransform="translate3d(0,0,0)";a.appendChild(k);k=el.add("canvas");k.id="2substraitCanvas"+b;k.width=m;k.height=p;k.style.position=
"absolute";k.style.left=h+"px";k.style.top=1*d+1*p-0.1+"px";k.style.webkitTransform="translate3d(0,0,0)";a.appendChild(k);k=el.add("canvas");k.id="3substraitCanvas"+b;k.width=m;k.height=c-2*p;k.style.position="absolute";k.style.left=h+"px";k.style.top=1*d+2*p-1.1+"px";k.style.webkitTransform="translate3d(0,0,0)";a.appendChild(k);publicationData.page[b].stub?(customEvents.fireEvent(IOS_LOAD_BITMAP_END,{page:b,type:3}),ZOOM_LOCK&&el.id("exPage"+b)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+
b)},150))):(customEvents.fireEvent(IOS_LOAD_PAGE_START,{page:b,type:3}),this.loadImage(c,p,b));var p=m/(2*e),l=publicationData.page[b].format||publicationData.page.defaults.format;if("js+jpg"===l||"js+png"===l)l=el.add("div"),l.id="zContentDiv"+b,l.style.width=2*e+"px",l.style.height=2*g+"px",l.style.position="absolute",l.style.left=h+"px",l.style.top=d+"px",l.style.webkitTransformOrigin="0% 0%",l.style.webkitTransform="scale("+p+")",a.appendChild(l);e=el.add("canvas");e.id="highlightCanvas"+b;e.width=
m;e.height=c;e.style.position="absolute";e.style.left=h+"px";e.style.top=d+"px";e.style.opacity=0;a.appendChild(e);(function(a,c){var f=function(){new LinksLayer(a,b);highlight.show(b,a,c);a.style.opacity=1;customEvents.removeListener(IOS_LOAD_BITMAP_END,f)};customEvents.addListener(IOS_LOAD_BITMAP_END,f)})(e,k);return d};this.loadImage=function(a,b,c){var d=el.id("1substraitCanvas"+c),e=d.getContext("2d");e.fillStyle="rgb(255,255,255)";var d=el.id("2substraitCanvas"+c),g=d.getContext("2d");g.fillStyle=
"rgb(255,255,255)";var d=el.id("3substraitCanvas"+c),h=d.getContext("2d");h.fillStyle="rgb(255,255,255)";var k=publicationData.page[c].proportions||publicationData.page.defaults.proportions,m=publicationData.size.proportions,d=d.width,p=new Image,l=publicationData.page[c].format||publicationData.page.defaults.format,n=publicationData.page[c].zoomFormat||publicationData.page.defaults.zoomFormat||publicationData.page[c].format||publicationData.page.defaults.format;if("js+jpg"===l){var q=COMMON_FOLDER+
"/page-substrates/page"+this.getName(c)+".jpg";this.loadContent(c,d)}else"js+png"===l?(q=COMMON_FOLDER+"/page-substrates/page"+this.getName(c)+".png",this.loadContent(c,d)):"jpg"===n?q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.jpg":"png"===n&&(q=ASSETS_FOLDER+"/pages/page"+this.getName(c)+"_i2.png");changeUrlWhenPubl(q,function(a){p.src=a});if(k>=m)var r=d,k=(r/k).toFixed(0),u=0,k=(a-k)/2;else r=(a*k).toFixed(0),u=(d-r)/2,k=0;var t=k>b?b:k,v=k>2*b?2*b:t-b,t=k,v=t-b,x=t+v-b;p.onload=function(){customEvents.fireEvent(IOS_LOAD_BITMAP_END,
{page:c,type:3});e.drawImage(p,u,t,r,a);g.drawImage(p,u,v,r,a);h.drawImage(p,u,x,r,a);setTimeout(function(){ZOOM_LOCK&&el.id("exPage"+c)&&(customEvents.fireEvent(STOP_ZOOM_PRELOADER),setTimeout(function(){el.del("exPage"+c)},150))},300)}};this.loadContent=function(a,b){var c=ASSETS_FOLDER+"/pages/ios/page"+this.getName(a)+".js",d=document.getElementsByTagName("head")[0],e=document.createElement("script");e.id="formPrinter";e.type="text/javascript";changeUrlWhenPubl(c,function(a){e.src=a});d.appendChild(e);
window.fakeLoadComplete=function(a){window.loadBuffers[a]=window.loadBuffer;for(i in window.loadBuffers[a]){var b=el.add("p");b.style.position="absolute";b.style.fontFamily=window.loadBuffers[a][i][1];b.style.width=2*window.loadBuffers[a][i][2]+"px";b.style.height=2*window.loadBuffers[a][i][3]+"px";b.style.top=2*window.loadBuffers[a][i][4]+"px";b.style.left=2*window.loadBuffers[a][i][5]+"px";b.style.fontSize=2*window.loadBuffers[a][i][6]+"px";b.style.color=window.loadBuffers[a][i][7];var c=document.createTextNode(window.loadBuffers[a][i][0]);
b.appendChild(c);el.id("zContentDiv"+a).appendChild(b);customEvents.fireEvent(IOS_LOAD_VECTOR_END,{page:a,type:3})}}};this.rotate=function(){this.initSizes();0<this.pageLeft?el.id("page"+this.currentPage).style.left=publicationData.page[this.currentPage].wide?this.widePageLeft+"px":this.pageLeft+"px":el.id("page"+this.currentPage).style.left="0px";0<this.pageTop?el.id("page"+this.currentPage).style.top=this.pageTop+"px":el.id("page"+this.currentPage).style.top="0px"};this.slideLeft=function(a){var b=
el.id("pageMask"+this.currentPage);a=el.id("pageMask"+a);b.style.webkitTransitionDuration="300ms";a.style.webkitTransitionDuration="300ms";b.style.webkitTransform="translate3d("+-window.innerWidth+"px,0px,0px)";a.style.webkitTransform="translate3d(0px,0px,0px)";var c=this;setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:c.currentPage})},300)};this.slideRight=function(a){var b=el.id("pageMask"+this.currentPage);a=el.id("pageMask"+a);b.style.webkitTransitionDuration="300ms";a.style.webkitTransitionDuration=
"300ms";b.style.webkitTransform="translate3d("+window.innerWidth+"px,0px,0px)";a.style.webkitTransform="translate3d(0px,0px,0px)";var c=this;setTimeout(function(){customEvents.fireEvent(BOOK_FLIPPING_END,{page:c.currentPage})},300)};this.goToPage=function(a){if(this.currentPage<a){this.drawPage(a,{x:0,y:0});publicationData.rtlMode?this.slideRight(a):this.slideLeft(a);var b=this.currentPage;this.currentPage=a;var c=this;setTimeout(function(){c.destroyPage(b)},300)}else this.currentPage>a&&(this.drawPage(a,
{x:0,y:0}),publicationData.rtlMode?this.slideLeft(a):this.slideRight(a),b=this.currentPage,this.currentPage=a,c=this,setTimeout(function(){c.destroyPage(b)},300))};this.destroyPage=function(a){this.scrolls[a].destroy();delete this.scrolls[a];el.del("page"+a);el.del("pageMask"+a)};this.destroyBook=function(){el.del("zoomBook");this.active=!1};this.goToOnePage=function(){if(!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);el.id("videoDiv"+a)&&(el.id("videoDiv"+a).style.opacity=0);var a=this.currentPage,
b=publicationData.page[a].wide,c=this;this.scrolls[a].destroy();delete this.scrolls[a];var d=publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>d?oneBookHeight=window.innerHeight-20:(oneBookWidth=window.innerWidth-20,oneBookHeight=oneBookWidth/d);b&&(oneBookHeight/=2);var e=oneBookHeight/this.pageHeight,g=el.id("page"+a);g.style.webkitTransformOrigin="50% 50%";el.id("mainFrame").appendChild(g);g.style.webkitTransform="";g.id="exPage"+a;g.style.zIndex="100000";
g.style.webkitBoxShadow="";setTimeout(function(){g.style.webkitTransitionDuration="300ms";g.style.top=c.pageTop+"px";g.style.left=b?c.widePageLeft+"px":c.pageLeft+"px";HTML5lib.changeOnlyScale(g,e,e,e)},20);setTimeout(function(){c.destroyBook();customEvents.fireEvent(START_ZOOM_PRELOADER);customEvents.fireEvent(ZOOM_ANIMATION_END_TO_ONE,{page:a})},320)}};this.goToTwoPage=function(){if(!ZOOM_LOCK){customEvents.fireEvent(ZOOM_ANIMATION_START);el.id("videoDiv"+a)&&(el.id("videoDiv"+a).style.opacity=
0);var a=this.currentPage,b=publicationData.page[a].wide,c=this,d=pageTable.getUserIDFromFileID(a);this.scrolls[a].destroy();this.scrolls[a]=null;var e=2*publicationData.size.width/publicationData.size.height;window.innerWidth/window.innerHeight>e?(twoBookHeight=window.innerHeight-60,twoBookWidth=twoBookHeight*e):(twoBookWidth=window.innerWidth-60,twoBookHeight=twoBookWidth/e);var g=0;publicationData.rtlMode&&0===d%2?g=twoBookWidth/4:publicationData.rtlMode&&0!=d%2?g=-twoBookWidth/4:publicationData.rtlMode||
0!==d%2?publicationData.rtlMode||0==d%2||(g=twoBookWidth/4):g=-twoBookWidth/4;var h=twoBookHeight/this.pageHeight,k=el.id("page"+a);k.style.webkitTransformOrigin="50% 50%";el.id("mainFrame").appendChild(k);k.style.webkitTransform="";k.id="exPage"+a;k.style.zIndex="100000";k.style.webkitBoxShadow="";b&&(g=0);setTimeout(function(){k.style.webkitTransitionDuration="300ms";k.style.top=c.pageTop+"px";k.style.left=b?c.widePageLeft+"px":c.pageLeft+"px";k.style.webkitTransform="translate3d("+g+"px,0,0) scale3d("+
h+","+h+","+h+")";customEvents.fireEvent(START_ZOOM_PRELOADER,{shift:g})},20);setTimeout(function(){c.destroyBook();customEvents.fireEvent(ZOOM_ANIMATION_END_TO_TWO,{page:d})},320)}};this.getName=function(a){var b="000"+a;9<a&&(b="00"+a);99<a&&(b="0"+a);999<a&&(b=""+a);return b};var c=this;this.gesturestart=function(a){customEvents.fireEvent(ZOOM_ANIMATION_START);el.id("videoDiv"+page)&&(el.id("videoDiv"+page).style.opacity=0);c.gesture=!0;c.zoomPage=c.currentPage;c.x=c.scrolls[c.zoomPage].x;c.y=
c.scrolls[c.zoomPage].y;c.scrolls[c.zoomPage].destroy();c.scrolls[c.zoomPage]=null;c.zoomDiv=el.id("page"+c.zoomPage);c.maxZoom=fbUtils.getMaxZoom(publicationData.page[c.zoomPage].wide?2*c.pageWidth:c.pageWidth,c.pageHeight);if(1===orientationObserver.getType()){var b=window.innerWidth/window.innerHeight,d=publicationData.size.width/publicationData.size.height;b>d?oneBookHeight=window.innerHeight-20:(oneBookWidth=window.innerWidth-20,oneBookHeight=oneBookWidth/d);c.minZoom=oneBookHeight/c.pageHeight;
publicationData.page[c.zoomPage].wide&&(c.minZoom=oneBookHeight/2/c.pageHeight)}else b=window.innerWidth/window.innerHeight,d=2*publicationData.size.width/publicationData.size.height,b>d?(twoBookHeight=window.innerHeight-60,c.twoBookWidth=twoBookHeight*d):(c.twoBookWidth=window.innerWidth-60,twoBookHeight=c.twoBookWidth/d),c.minZoom=twoBookHeight/c.pageHeight;for(i in c.zoomDiv.getElementsByTagName("*"))c.zoomDiv.getElementsByTagName("*")[i].id="";el.id("mainFrame").appendChild(c.zoomDiv);c.zoomDiv.id=
"exPage"+c.zoomPage;c.zoomDiv.style.zIndex="100000";0>=c.pageTop?(c.zoomDiv.style.top=c.y+"px",b=(-c.y+a.pageY).toFixed(0)):b=(a.pageY-c.pageTop).toFixed(0);d=publicationData.page[c.zoomPage].wide?c.widePageLeft:c.pageLeft;0>=d?(c.zoomDiv.style.left=c.x+"px",a=(-c.x+a.pageX).toFixed(0)):a=(a.pageX-d).toFixed(0);c.zoomDiv.style.webkitTransformOrigin=a+"px "+b+"px";c.destroyBook()};this.gesturechange=function(a){c.minZoom<=a.scale&&c.maxZoom>=a.scale&&(c.zoomDiv.style.webkitTransform="scale3d("+a.scale+
","+a.scale+","+a.scale+")")};this.gestureend=function(a){setTimeout(function(){c.gesture=!1},150);var b=a.scale>c.maxZoom?c.maxZoom:a.scale<c.minZoom?c.minZoom:a.scale;c.zoomDiv.style.webkitTransform="scale3d("+b+","+b+","+b+")";var d=c.pageHeight*b,n=publicationData.page[c.zoomPage].wide?2*c.pageWidth*b:c.pageWidth*b;a=publicationData.page[c.zoomPage].width||publicationData.page.defaults.width;publicationData.page[c.zoomPage].wide&&(a*=2);var e=n/a,g=0>=c.zoomDiv.getBoundingClientRect().left?c.zoomDiv.getBoundingClientRect().left:
0,h=0>=c.zoomDiv.getBoundingClientRect().top?c.zoomDiv.getBoundingClientRect().top:0,k=c.zoomDiv.getBoundingClientRect().top,m=window.innerHeight-c.zoomDiv.getBoundingClientRect().bottom,p=c.zoomDiv.getBoundingClientRect().left,l=window.innerWidth-c.zoomDiv.getBoundingClientRect().right,r=a=0;c.zoomDiv.style.webkitTransitionDuration="100ms";d<=window.innerHeight?r=(window.innerHeight-d)/2-k:d>window.innerHeight&&0<k?r=-k:d>window.innerHeight&&0<m&&(r=m);n<=window.innerWidth?a=(window.innerWidth-n)/
2-p:n>window.innerWidth&&0<l?a=0:n>window.innerWidth&&0<p&&(a=-p);var q={x:g,y:h},d=0;b<=c.minZoom&&2===orientationObserver.getType()?(n=pageTable.getUserIDFromFileID(c.zoomPage),publicationData.rtlMode||0!==n%2?publicationData.rtlMode||0==n%2?publicationData.rtlMode&&0===n%2?d=-c.twoBookWidth/4:publicationData.rtlMode&&0!=n%2&&(d=c.twoBookWidth/4):d=-c.twoBookWidth/4:d=c.twoBookWidth/4,publicationData.page[c.zoomPage].wide&&(d=0),c.zoomDiv.style.webkitTransform="translate3d("+(a-d)+"px,"+r+"px,0px) scale3d("+
b+","+b+","+b+")"):c.zoomDiv.style.webkitTransform="translate3d("+a+"px,"+r+"px,0px) scale3d("+b+","+b+","+b+")";c.zoomDiv.style.webkitBoxShadow="";customEvents.fireEvent(START_ZOOM_PRELOADER,{shift:-d});setTimeout(function(){b>c.minZoom?customEvents.fireEvent(ZOOM_ZOOM_ANIMATION_END,{zoomFactor:e,page:c.zoomPage,startPos:q}):1===orientationObserver.getType()?customEvents.fireEvent(ZOOM_ANIMATION_END_TO_ONE,{page:c.zoomPage}):customEvents.fireEvent(ZOOM_ANIMATION_END_TO_TWO,{page:pageTable.getUserIDFromFileID(c.zoomPage)})},
180)};var d=-1,n=-1,c=this;this.touch=function(){this.slideMode=(publicationData.page[c.currentPage].wide?this.widePageWidth:this.pageWidth)>window.innerWidth?!0:!1;c.block||c.gesture||ZOOM_LOCK||c.slideMode||(d=Modernizr.touch?event.targetTouches[0].pageX:event.pageX)};this.endmove=function(){this.slideMode=(publicationData.page[c.currentPage].wide?this.widePageWidth:this.pageWidth)>window.innerWidth?!0:!1;if(!(c.block||c.gesture||ZOOM_LOCK||c.slideMode)&&(n=Modernizr.touch?event.changedTouches[0].pageX:
event.pageX,-1!=d&&-1!=n)){var a=d-n;120<a?pageMediator.right():-120>a&&pageMediator.left();n=d=-1}}};
