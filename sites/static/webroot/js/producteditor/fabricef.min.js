fabric.Object.prototype.originX=fabric.Object.prototype.originY="center",fabric.efImage=fabric.util.createClass(fabric.image,{type:"efimage",initialize:function(a,b){b||(b={}),this.callSuper("initialize",a,b),this.set({orgSrc:a.src,cx:0,cy:0,cw:a.width,ch:a.height}),this.img=new Image,this.img.src=this.orgSrc}}),fabric.newImage=fabric.util.createClass(fabric.Object,{type:"newimage",crossOrigin:"",initialize:function(a,b){b||(b={}),this.filters=[],this.callSuper("initialize",b),this._initElement(a,b),this._initConfig(b),b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,b){return this._element=a,this._originalElement=a,this._initConfig(),this.filters.length!==0&&this.applyFilters(b),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save(),this._setStrokeStyles(a),a.beginPath(),a.strokeRect(-this.width/2,-this.height/2,this.width,this.height),a.closePath(),a.restore()},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){return extend(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(a){var b=[],c=-this.width/2,d=-this.height/2;this.group&&this.group.type==="path-group"&&(c=this.left,d=this.top),b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>\n");if(this.stroke||this.strokeDashArray){var e=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a){if(!this._originalElement)return;if(this.filters.length===0){this._element=this._originalElement,a&&a();return}var b=this._originalElement,c=fabric.util.createCanvasElement(),d=fabric.util.createImage(),e=this;return c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0,b.width,b.height),this.filters.forEach(function(a){a&&a.applyTo(c)}),d.width=b.width,d.height=b.height,fabric.isLikelyNode?(d.src=c.toBuffer(undefined,fabric.Image.pngCompression),e._element=d,a&&a()):(d.onload=function(){e._element=d,a&&a(),d.onload=c=b=null},d.src=c.toDataURL("image/png")),this},_render:function(a,b){var c=-(this.width/2),d=-(this.height/2),e=this.width,f=this.height;console.log(c),console.log(d),console.log(e),console.log(f),this._element&&a.drawImage(this._element,-c,-d,e,f),this._renderStroke(a)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Cropzoomimage=fabric.util.createClass(fabric.Image,{type:"cropzoomimage",zoomedXY:!1,initialize:function(a,b){b||(b={}),this.callSuper("initialize",a,b),this.set({orgSrc:a.src,cx:0,cy:0,cw:a.width,ch:a.height}),this.img=new Image,this.img.src=this.orgSrc},zoomBy:function(a,b,c,d){if(a||b)this.zoomedXY=!0;this.cx+=a,this.cy+=b,c&&(this.cw-=c,this.ch-=c/(this.width/this.height)),c&&!this.zoomedXY&&(this.cx=this.width/2-this.cw/2,this.cy=this.height/2-this.ch/2),this.cw>this.width&&(this.cw=this.width),this.ch>this.height&&(this.ch=this.height),this.cw<1&&(this.cw=1),this.ch<1&&(this.ch=1),this.cx<0&&(this.cx=0),this.cy<0&&(this.cy=0),this.cx>this.width-this.cw&&(this.cx=this.width-this.cw),this.cy>this.height-this.ch&&(this.cy=this.height-this.ch),this.rerender(d)},rerender:function(a){var b=new Image,c=this,d=fabric.util.createCanvasElement();d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(this.img,c.cx,c.cy,c.cw,c.ch,0,0,c.width,c.height),b.onload=function(){c.setElement(this),c.set({left:c.left,top:c.top,angle:c.angle}),c.setCoords(),a&&a(c)},b.src=d.toDataURL("image/png")},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{orgSrc:this.orgSrc,cx:this.cx,cy:this.cy,cw:this.cw,ch:this.ch})}})