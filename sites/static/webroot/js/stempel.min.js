function update(){$("img#preview").parent().append('<div id="imageloader" style="width:202px; height:83px"><img src="http://a.static.repix.no/gfx/gui/ajax-loader-gray.gif"/></div>'),disabled=!1,alertmessage="true";var a=encodeURIComponent($('input[name$="font-color"]').val());$('input[name$="imagemode"]').val()=="color"?imagemode="color":imagemode="bw";if(imageselection.selection)var b=imageselection.selection.x1+"-"+imageselection.selection.y1+"-"+imageselection.selection.width+"-"+imageselection.selection.height+"-"+imagemode;var c=encodeURIComponent($('input[name$="line1"]').val()),d=encodeURIComponent($('input[name$="line2"]').val()),e="/api/1.0/merkelapp/preview?projectid="+projectid+"&line1="+c+"&line2="+d+"&font="+$('select[name$="font-type"]').val()+"&gravity="+gravity+"&image="+ownimage+"&clipart="+clipart+"&backgroundfile="+backgroundfile+"&color="+a+"&treshold="+treshhold+"&crop="+b+"&colormode="+"stempel";$("img#preview").each(function(){$(this).attr("src",e)}),$("img#preview").load(function(){$("#imageloader").remove()})}function setcrop(a){$("#ownimage").imgAreaSelect({handles:!0,aspectRatio:"1:1",x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,onInit:function(){ownimage=$('input[name$="image"]').val(),update()},onSelectEnd:function(a,b){imageselection={selection:b,imgx:a.width,imgy:a.height},update()}})}function getClipart(){if(type=="fargelapp")var a="colorclipart";else var a="clipart";$.post("/api/1.0/merkelapp/clipart",{clipart:category,type:type},function(b){$(b.images).each(function(b,c){$("#clipart").append('<img id="clip" title="'+c+'"src="'+staticroot+"gfx/merkelapp/"+a+"/"+category+"/"+c+'" width="38" style="margin-right: 5px;"/>')})},"json")}function getBackgrounds(){$.post("/api/1.0/merkelapp/backgrounds",{backgroundcat:backgroundcat},function(a){$(a.images).each(function(a,b){$("#background").append('<img id="backgroundfile" title="'+b+'"src="'+staticroot+"gfx/merkelapp/backgroundfiles/"+backgroundcat+"/thumbs/"+b+'" width="38" style="margin-right: 5px;"/>')})},"json")}$(document).ready(function(){getClipart(),getBackgrounds(),$(".merkelapp-rotator").merkelappslider(),$("#select_clipart").change(function(){return $("#clipart").html(""),category=$(this).val(),getClipart(),!1}),$("#select_background").change(function(){return $("#background").html(""),backgroundcat=$(this).val(),getBackgrounds(),!1}),$("#cart-price").text(formatPrice(totalprice)),$(".radio").mousedown(function(){$(".radio").css({"background-position-x":"-7px"}),$(this).css({"background-position-x":"-67px"})}).mouseup(function(){$(this).css({"background-position-x":"-37px"}),gravity=$(this).attr("id"),update()}),$("#font-color").change(function(){return $("select#font-color option:selected").each(function(){$("#font-color").css("background-color",$(this).css("background-color")),$("#font-color").css("color",$(this).css("color"))}),!1}),$("#addtocart").click(function(){return alertmessage="false",disabled==1?!1:(document.location.href="/bestilling/addItemByProductOptionId/"+$('input[name$="choose_product"]:checked').val()+"/"+projectid+"/"+type,!1)}),$("#removeimg, #removeclipart").click(function(){return clipart="",ownimage="",update(),!1}),$("#removebackground").click(function(){backgroundfile=null,update()}),$("#removetext").mouseup(function(){return $('input[name$="line1"]').val(""),$('input[name$="line2"]').val(""),$('input[name$="line3"]').val(""),update(),!1}),$("#removetext").click(function(){return!1}),$("#removeall").click(function(){return clipart="",ownimage="",backgroundfile=null,$('input[name$="line1"]').val(""),$('input[name$="line2"]').val(""),$('input[name$="line3"]').val(""),update(),!1}),$("#update").click(function(){return update(),!1}),$('input[name$="choose_product"]').change(function(){var a=$('input[name$="choose_product"]:checked').val();a=="2734"?($("#sticker").show(),$("#iron").show(),$("#not-sticker").hide(),$("#not-iron").hide()):a=="2732"?($("#sticker").show(),$("#iron").hide(),$("#not-sticker").hide(),$("#not-iron").show()):a=="2730"&&($("#sticker").hide(),$("#iron").show(),$("#not-sticker").show(),$("#not-iron").hide())}),$("#edit").change(update),$("#tabs").tabs({select:function(a,b){b.tab.id=="tab-text"||b.tab.id=="tab-clipart"||b.tab.id=="tab-background"?$("#ownimage").imgAreaSelect({remove:!0}):b.tab.id=="tab-image"&&imageselection.selection&&setTimeout(function(){setcrop(imageselection.selection)},200)}});var a=$("#photo").val();$("#imagefile").change(function(){return $(this).upload("/api/1.0/merkelapp/upload",function(a){$("#ownimage").imgAreaSelect({remove:!0}),ownimage=a.filename,$('input[name$="image"]').val(a.filename),$("#ownimage").remove(),$(".preimage").remove(),$(".pastimage").show(),$("#imagecontainer").append('<img  id="ownimage" alt="image" src="/streams/merkelapp/'+a.filename+'" />'),$("#ownimage").load(function(){$("#ownimage").imgAreaSelect({handles:!0,aspectRatio:"1:1",x1:50,y1:50,x2:150,y2:150,onInit:function(a,b){imageselection={selection:b,imgx:a.width,imgy:a.height},update()},onSelectEnd:function(a,b){imageselection={selection:b,imgx:a.width,imgy:a.height},update()}})})},"json"),update(),!1}),$("#clip").live("click",function(){ownimage="",$(".selectedclip").removeClass("selectedclip"),$(this).addClass("selectedclip"),clipart=category+"-"+$(this).attr("title"),update()}),$("#backgroundfile").live("click",function(){$(".selectedbackground").removeClass("selectedbackground"),$(this).addClass("selectedbackground"),backgroundfile=backgroundcat+"-"+$(this).attr("title"),update()}),$("#font-color").change(function(){update()}),$("#clip, #backgroundfile").live("mouseover mouseout mousedown",function(a){a.type=="mouseover"?$(this).css({"background-color":"#ff9999",border:"1px solid #ca0000"}):a.type=="mousedown"?$(this).css({"background-color":"#ff9999",border:"1px solid #ca0000"}):$(this).css({"background-color":"",border:""})}),$("#slider").slider({stop:function(a,b){treshhold=b.value,update()},step:2,value:50,max:100,min:1}),$("#jquery-colour-picker-text select").colourPicker({ico:"http://andreaslagerkvist.com/aFramework/Modules/Base/gfx/jquery.colourPicker.gif",title:!1})})