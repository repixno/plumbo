var me=this,helpertop,helperleft,helpertwidth,helperheight;$(document).ready(function(){$("#font-list").fontmenu(),$(".template").first().show().addClass("selected-template"),$(".select-page").first().addClass("selected-pageselect"),$("#zoom-range").slider({min:.05,max:4,step:.05,slide:function(a,b){$(".selected-template .helper").panzoom("zoom",b.value)}}),$("button.zooms").on("mousedown touchstart",function(a){a.preventDefault()}),$(".zooms").on("mousedown touchstart",function(a){holdbutton=!0,timeout($(this))}).on("mouseup mouseleave touchend",function(){holdbutton=!1}),$(document).on("touchend",function(){holdbutton=!1}),$("#nextindex").on("click",function(){var a=$(".selected-pageselect").attr("index");return a++,$("a[index='"+a+"']").click(),!1}),$("#previndex").on("click",function(){var a=$(".selected-pageselect").attr("index");return a--,$("a[index='"+a+"']").click(),!1}),$(".select-page").on("click",function(){$(".selected-template").find(".currentclipartholder").each(function(){var a=$(this).find(".currentclipart"),b=a.height();a.css("height",b)}),$(".selected-template").find(".textholder").each(function(){var a=$(this).find(".currenttext ");a.css("height",a.height())}),$(".select-page").each(function(){$(this).removeClass("selected-pageselect")}),$(this).addClass("selected-pageselect");var a=$(this).attr("id").split("-");return $("."+a[2]+"-zoom-in").parent().removeClass("hide"),$(".template").each(function(){$(this).hide().removeClass("selected-template")}),$(".template-wrapper-"+a[2]).show().addClass("selected-template"),$(".selected-template").hasClass("stretchToFit")||stretchToFit(),!1}),$("#accordion").accordion({navigation:!0,heightStyle:"content"}),location.hash.toLowerCase().substring(1)=="choose-template"&&$("#accordion").accordion("activate",1),$.post("/api/1.0/prices/get",{productoptionid:1417,quantity:1},function(a){$("#redeye-price").text(a.price)},"json"),$(".quantity").bind("change",function(){var a=$(this).val();$.post("/api/1.0/prices/get",{productoptionid:productoptionid,quantity:a},function(a){$("#gift-price").text(a.price)},"json")});var a=1,b=210;$("#add-gift-to-cart").click(function(){var a=new Array,b=0;$(".template").each(function(){var c=$(this).find("#selected-image").val();b++,$(this).find("#image").hasClass("noimage")&&c==0&&a.push(b)});if(a.length>0){var c=a.join();$("#missing").text(c),$("#dialog-confirm").dialog({resizable:!1,height:200,modal:!0,buttons:{OK:function(){$(this).dialog("close")}}})}else save();return!1}),ie6&&$("#template-wrapper").ready(function(){$("#template-wrapper").pngFix()}),$("#template-wrapper").load(function(){ie6&&$("#template-wrapper").pngFix()}),$("#template").data("malid",$("#initMalid").val()),$("#template").data("malpageid",$("#initMalpageid").val()),$("#select-album").bind("change",function(){$("#album-images").empty(),$("#album-images").append('<div class="loader center prepend-top"><img src="'+bigajaxLoader+'" title="loading" /></div>'),$.getJSON("/api/1.0/album/images/forpurchase/"+$(this).val(),function(a){a.result?($.each(a.images,function(a,b){$("#album-images").append('<img src="'+b.thumbnail+'" title="'+b.title+'" id="'+b.id+'"height="50" />')}),$(".loader","#album-images").remove()):($("#album-images").empty(),$("#album-images").append('<h3 class="prepend-top center">'+noImagesText+"</h3>"))})}),$(".text-align","#text-align").click(function(){$(this).hasClass("left")?$("#new-text").css("text-align","left"):$(this).hasClass("center")?$("#new-text").css("text-align","center"):$("#new-text").css("text-align","right")}),$(document).on("click","#album-images img",function(){$(".selected-template").prepend('<div id="template-ajax-loader"><img src="'+bigajaxLoaderGray+'"/></div>'),$("#template-ajax-loader").css("opacity","0.8").css("margin","0").css("background-color","#666").css("padding-left",$("#template-wrapper").width()/2).css("padding-top",$("#template-wrapper").height()/2).css("z-index","34000").width("100%").height("100%"),$(".selected-template").find("#image").remove(),$(".selected-template").find("#image-wrapper").append('<img id="image" />');var a=new Image;$(a).load(function(){$("#template-ajax-loader").remove(),stretchToFit()}).attr("src",getImage($(this).attr("id"))),$(".selected-template").find("#image").attr("src",$(this).attr("src")),$(".selected-template").find("#selected-image").attr("value",$(this).attr("id")),$(".selected-template").find("#image").attr("src",getImage($(this).attr("id")));var b=this;$("#choose-template .template-thumb").css("background-image","url("+$(this).attr("src")+")"),$(".selected-template").find("#image").load(function(){}),$('.selected-template input[type="range"].zooms').val(1)}),$("button#velgbilde").on("click",function(){return $("#choosefile").click(),!1}),$("input#choosefile").on("change",function(){return $("#lastoppbilde").click(),!1}),$("#fileupload").fileupload({replaceFileInput:!1,dataType:"json",datatype:"json",xhrFields:{withCredentials:!0},acceptFileTypes:/(\.|\/)(jpe?g|tif)$/i,add:function(a,b){b.context=$('<p id="uploading" style="position: absolute; left: 20px;"/>').text("Uploading...").appendTo($(".progress-bar")),b.submit(),$(".progress").show(),$(".progress .progress-bar-success").css("width","0%")},done:function(a,b){$("#uploading").remove(),$.each(b.result.files,function(a,b){var c='<img class="imagethumb" id="'+b.id+'"src="'+b.thumbnailUrl+'" style="height: 75px"  />';$("#upload-queue").append(c),selectedImageId=$(this).attr("id");var d=this;$("#choose-template .template-thumb").css("background-image","url("+b.thumbnailUrl+")"),$("img#"+b.id).css("border-color","#0199d8"),$(".progress").hide()})},progressall:function(a,b){var c=parseInt(b.loaded/b.total*100,10);$(".progress .progress-bar-success").css("width",c+"%")}}),$(document).on("click","#upload-queue img",function(){var a=$(this).attr("id");$(".selected-template").find("#image").remove(),$(".selected-template").find("#image").remove(),$(".selected-template").find("#image-wrapper").append('<img id="image" />');var b=new Image;$(b).load(function(){$("#template-ajax-loader").remove(),stretchToFit()}).attr("src",getImage($(this).attr("id"))),$(b).load(function(){$(".selected-template").find("#image-wrapper").append('<img id="image" />'),$(".selected-template").find("#selected-image").attr("value",a),$(".selected-template").find("#image").attr("src",getImage(a)),$(".selected-template .helper").width(b.width),$(".selected-template .helper").height(b.height),stretchToFit()}).attr("src",getImage(a))}),$("#update-text").click(function(){var a=$(".activeText").find("img"),c=$("#new-text").val();if(c!=""){c=c.replace(/\n/g,"XXNYLINJEXX"),c=c.replace("&","XXOGXX"),c=c.replace(/\\/g,"\\\\"),c=c.replace(/\'/g,"\\'"),c=c.replace(/\"/g,'\\"'),c=c.replace(/\0/g,"\\0");var d=$("#new-text-color").val().replace("#",""),e=$("#fontselect").val(),f=convertAlignToTaule($("#new-text").css("text-align")),g=$(".activeText");png=1,a.attr("src","/api/1.0/gift/text/?id=0&quality=1&png="+png+"&font="+e+"&gravity="+f+"&color="+d+"&text="+c+"&encoding=UTF8"),$(".activeText").data("text",c),$(g).data("width",$(g).width()),$(g).data("height",$(g).height()),$(g).data("font",e),$(g).data("gravity",f),$(g).data("color",d),$(g).data("text",c),$(g).data("zindex",b)}}),$("body").on("click",function(a){$(a.target).closest("#template-wrapper").length==1&&!$(a.target).hasClass("gifteditor_text")&&$(".textholder").hasClass("activeText")&&($(".textholder").removeClass("activeText"),$(".update-text-func").hide(),$(".add-text-func").show())}),$("#delete-text").on("click",function(){$(".activeText").remove(),$(".update-text-func").hide(),$(".add-text-func").show()});var c=!1;$('input[name="text-size"]').on("mousedown touchstart",function(){c=!0}),$('input[name="text-size"]').on("mouseup touchend",function(){c=!1}),$('input[name="text-size"]').on("change mousemove",function(){var a=$(this).val(),b=$(".activeText").panzoom("getMatrix");$(".activeText").panzoom("setMatrix",[a,0,0,a,b[4],b[5]])}),$("#add-text").click(function(){var c="currentResizable"+a+"-"+b,d=$("#new-text").val();if(d!=""){d=d.replace(/\n/g,"XXNYLINJEXX"),d=d.replace("&","XXOGXX"),d=d.replace(/\\/g,"\\\\"),d=d.replace(/\'/g,"\\'"),d=d.replace(/\"/g,'\\"'),d=d.replace(/\0/g,"\\0");var e=$("#new-text-color").val().replace("#",""),f=$("#fontselect").val(),g=convertAlignToTaule($("#new-text").css("text-align"));$(".selected-template").append('<div id="textholder'+a+'" class="textholder draggable activeText" data-text="'+d+'">\t\t\t\t\t\t\t<div id="'+c+'" class="resizable">\t\t\t\t\t\t\t\t<img id="text'+a+'" class="currenttext img"/>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>'),$("#text"+a).addClass("gifteditor_text"),$(".update-text-func").show(),$(".add-text-func").hide(),resizeText(c,"textholder"+a),png=1;var h=$("#textholder"+a);$("#text"+a).load(function(){$(h).data("width",$(h).width()),$(h).data("height",$(h).height()),setelementdata(h,[.7,0,0,.7,50,50])}).attr("src","/api/1.0/gift/text/?id=0&quality=1&png="+png+"&font="+f+"&gravity="+g+"&color="+e+"&text="+d+"&encoding=UTF8"),$(h).css({"z-index":"20"+a,position:"absolute",top:0,left:0}),$(h).data("font",f),$(h).data("gravity",g),$(h).data("color",e),$(h).data("text",d),$(h).data("zindex",b),$(h).panzoom({minScale:.1,maxScale:3}),$(h).panzoom("setMatrix",[.7,0,0,.7,50,50]),$('input[name="text-size"').val(.7),a++,b++}$(".row-offcanvas").hasClass("active")&&$(".row-offcanvas").toggleClass("active")}),$(".selected-template").find(".helper").width($("#image").width()),$(".selected-template").find(".helper").height($("#image").height()),$(".helper").on("panzoomchange",function(a,b,c,d){helpertwidth=$(this).width(),helperheight=$(this).height();var e=new Array(c),f=parseInt($(this).width())*e[0][0],g=parseInt($(this).height())*e[0][0],h=parseInt($(this).css("top"))+parseInt(parseInt(e[0][5])+(helperheight-g)/2),i=parseInt($(this).css("left"))+parseInt(parseInt(e[0][4])+(helpertwidth-f)/2);$(".selected-template").find("#image").css({top:h,left:i,"margin-left":0,"margin-top":0,width:f,height:g})}),$("#see-throug-template").click(function(){$(this).hasClass("clicked")?($("#template").fadeTo("slow",1),$(this).removeClass("clicked")):($("#template").fadeTo("slow",.7),$(this).addClass("clicked"))}),$("#clipartgroup-selector").bind("change",function(){var a=$(":selected",this).val();$("#clipart-selector .clipartcollection").hide(),$("#clipartcollection_id_"+a).css("display","block"),$("img","#clipartcollection_id_"+a).css("display","block"),$("#clipartcollection_id_"+a).show(),$("#clipart-selector .clipartcollection img").each(function(a,b){$(b).attr("src",$(b).attr("title"))})}),$(document).on("click","#clipart-selector .clipartitem-container",function(){var a=$(this).attr("id").replace("clipartitem-container_",""),c="currentclipart"+a+"-"+b,d="currentResizable"+a+"-"+b,e="currentDraggable"+a+"-"+b;$(".selected-template").append('<div id="'+e+'" class="currentclipartholder draggable" data-id="'+a+'">\t\t\t\t\t\t\t\t\t\t\t<div id="'+d+'" class="resizable">\t\t\t\t\t\t\t\t\t\t\t\t<img id="'+c+'" class="currentclipart img"/>\t\t\t\t\t\t\t\t\t\t\t\t<div class="ui-resizable-handle ui-resizable-ne" style="z-index: 1000;"></div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="ui-resizable-handle ui-resizable-nw delteclipart" style="z-index: 1000;">\t\t\t\t\t\t\t\t\t\t\t\t\t<img src="'+staticsite+'gfx/icons/delete.png" />\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t</div>');var f=staticurl+"images/clipart/thumbs/width/300/"+a.toString()+".png",g=$("#currentclipart"+a+"-"+b);g.attr("src",f),$("#"+e).panzoom({minScale:.1,maxScale:3}),$("#"+e).css({position:"absolute","z-index":b,top:0,left:0}).addClass("selectedclip"),$("#"+e).panzoom("setMatrix",[.4,0,0,.4,50,50]),$(g).on("load",function(){resizeElement(d,e),b++})}),$("#select-album").trigger("change")}),$(window).load(function(){stretchToFit()})