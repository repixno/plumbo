function require(a){document.write('<script type="text/javascript" src="'+a+'"></script>')}function updateCrop(a,b){$.ef("order.crop.get",{prodno:a,imageid:b},function(c){if(c.result)c.message!=null?c.message.fitin=="1"?($("#fit-in").attr("checked",!0),$("#portrait").hide(),$("#landscape").hide()):getCrop(c.message,b,a):newCrop(a,b);else return!1})}function newCrop(a,b,c){var d=printsize(a);printwidth=d[0],printheight=d[1],currentPrintWidth=printwidth,$("#portrait").removeClass("disabled").show(),$("#landscape").addClass("disabled").show();var e=$("img#cropbox").height(),f=$("img#cropbox").width();if(c=="portrait")$("#portrait").addClass("disabled"),$("#landscape").removeClass("disabled"),printwidth=Math.min(d[0],d[1]),printheight=Math.max(d[0],d[1]);else if(c=="landscape")$("#portrait").removeClass("disabled"),$("#landscape").addClass("disabled"),printwidth=Math.max(d[0],d[1]),printheight=Math.min(d[0],d[1]);else if(e>f){$("#portrait").addClass("disabled"),$("#landscape").removeClass("disabled");var g=printwidth;printwidth=printheight,printheight=g}var h=e/f,i=printheight/printwidth;if(printwidth>printheight)if(h>i)var j=f,k=f*(printheight/printwidth);else var k=e,j=e/(printheight/printwidth);else if(h<i)var k=e,j=e/(printheight/printwidth);else var j=f,k=f*(printheight/printwidth);var l=(f-j)/2;j=parseInt(l)+parseInt(j);var m=(e-k)/2;k=parseInt(m)+parseInt(k),$("img#cropbox").imgAreaSelect({x1:l,y1:m,x2:j,y2:k,persistent:!0,instance:!0,aspectRatio:printwidth+":"+printheight,handles:!0,keys:!0,onInit:function(a,b){quality(a,b),c&&saveCrop(a,b)},onSelectEnd:function(a,b){saveCrop(a,b)},onSelectChange:function(a,b){quality(a,b)}})}function saveCrop(a,b){$("#"+a.alt).removeClass("todo").addClass("done");var c=a.alt.split("-");$.ef("order.crop.save",{width:a.width,height:a.height,x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2,dx:b.width,dy:b.height,imageid:c[0],prodno:c[1]},function(a){if(a.result)return!0;console.log(a.message)})}function getCrop(a,b,c){var d=printsize(c);currentPrintWidth=d[0],$("img#cropbox").imgAreaSelect({x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,persistent:!0,instance:!0,aspectRatio:d[0]+":"+d[1],handles:!0,keys:!0,onInit:function(a,b){quality(a,b)},onSelectEnd:function(a,b){saveCrop(a,b)},onSelectChange:function(a,b){quality(a,b)}})}function printsize(a){var b=new Array;return a=="0001"?(b[0]=15.2,b[1]=10.2):a=="0014"?(b[0]=10.2,b[1]=10.2):a=="7345"?(b[0]=15.2,b[1]=15.2):a=="0419"?(b[0]=13.6,b[1]=10.2):a=="0002"?(b[0]=20.3,b[1]=15.2):a=="0005"?(b[0]=40.6,b[1]=30.5):a=="0439"?(b[0]=30,b[1]=20.3):a=="0003"?(b[0]=25.4,b[1]=20.3):a=="0004"?(b[0]=30,b[1]=25.4):a=="0534"?(b[0]=60,b[1]=40):a=="7347"?(b[0]=13,b[1]=18):a=="0006"&&(b[0]=17.8,b[1]=10.2),b}function printtitle(a){var b=new Array;return a=="0001"?b="10x15":a=="0014"?b="10x10":a=="7345"?b="15x15":a=="0419"?b="10x13":a=="0002"?b="15x20":a=="0005"?b="30x40":a=="0439"?b="20x30":a=="0003"?b="20x25":a=="0004"?b="25x30":a=="0534"?b="40x50":a=="7347"?b="13x18":a=="0006"&&(b="10x18"),b}function quality(a,b){var c=currenImageWidth/currentPrintWidth/(a.width/b.width);c>0&&(c>100?$(".quality").html("<span>Meget bra</span>"):c>50?$(".quality").html("<span>Bra</span>"):c>20?$(".quality").html('<span class="bad" style="color: red;">D&#229;rlig</span>'):$(".quality").html('<span class="verybad" style="color: red; font-weight: bold">Meget d&#229;rlig</span>'))}function changeImage(a,b,c){var d=$("img#cropbox");$("#fit-in").removeAttr("checked"),$("#crop-size-info").text(printtitle(c)+"cm"),d.imgAreaSelect({remove:!0}),d.attr("alt",b+"-"+c),d.hide(),loadImage("img#cropbox",a,function(){d.show(),updateCrop(c,b)})}function loadImage(a,b,c){var d=new Image;d.onload=function(){$(a).attr("src",b),c()},d.src=b}var isiPad=navigator.userAgent.match(/iPad/i)!=null||navigator.userAgent.match(/iPhone/i)!=null;isiPad?require("http://c.static.repix.no/js/jquery.imgareaselect.touch.js"):require("http://d.static.repix.no/js/jquery.imgareaselect.min.js");var currenImageWidth=0,currentPrintWidth=0;$.event.props=$.event.props.join("|").replace("layerX|layerY|","").split("|"),$(document).ready(function(){$(".qualityinfo").click(function(){return $("#qualityinfoDialogWindow").dialog({height:200,width:400,modal:!0,position:"center",autoOpen:!1,title:"Kvalitetsberegning.",draggable:!1,resizable:!1,overlay:{opacity:.5,background:"black"}}),$("#qualityinfoDialogWindow").dialog("open"),!1}),$("#next-step").click(function(){var a=0;return $(".thumbnail").each(function(){$(this).hasClass("todo")&&a++}),a>0?($("#docrop").dialog({height:450,width:400,modal:!0,position:"center",autoOpen:!1,title:"Advarsel!",draggable:!1,resizable:!1,buttons:{"Gå videre":function(){window.location="/order-prints/accessories/"},"Fullfør beskjæring":function(){$(this).dialog("close")}}}),$("#docrop").dialog("open"),a==1?$("#notcroppedcount").text(a+" bilde"):$("#notcroppedcount").text(a+" bilder"),!1):!0}),$("#portrait").click(function(){$("img#cropbox").imgAreaSelect({remove:!0});var a=$("img#cropbox").attr("alt").split("-");return newCrop(a[1],a[0],"portrait"),!1}),$("#landscape").click(function(){$("img#cropbox").imgAreaSelect({remove:!0});var a=$("img#cropbox").attr("alt").split("-");return newCrop(a[1],a[0],"landscape"),!1}),$("#fit-in").change(function(){var a=$("img#cropbox").attr("alt").split("-");$("#fit-in:checked").val()!==undefined?($("#landscape").hide(),$("#portrait").hide(),$("#"+$("img#cropbox").attr("alt")).removeClass("todo").addClass("done"),$("img#cropbox").imgAreaSelect({remove:!0}),$.ef("order.crop.save",{fitin:"set",imageid:a[0],prodno:a[1]},function(a){return a.result?!0:!1})):($("#landscape").show(),$("#portrait").show(),$.ef("order.crop.save",{fitin:"remove",imageid:a[0],prodno:a[1]},function(a){return a.result?!0:!1}),newCrop(a[1],a[0]))}),$("a.imagethumbnail").click(function(){return currenImageWidth=$(this).parent().find("#orginalwidth").text(),src=$(this).attr("href"),prodno=$(this).attr("alt"),imageid=$(this).attr("id"),$("#imagecount-cropbox").text(" "+$(this).parent().find("#imagecount").text()),changeImage(src,imageid,prodno),!1}),$(".imagethumbnail").mouseover(function(){$(this).attr("title",printtitle($(this).attr("alt"))+"cm")})}),$(window).load(function(){var a=0;currenImageWidth=$(".imagethumbnail:first").parent().find("#orginalwidth").text();var b=$(".imagethumbnail:first").attr("href"),c=$(".imagethumbnail:first").attr("id"),d=$(".imagethumbnail:first").attr("alt");changeImage(b,c,d),$(".imagethumbnail").each(function(){a++,$(this).parent().find("#imagecount").text(a)}),$("#totalimages").text(a)})