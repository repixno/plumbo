<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		  
			ga('create', 'UA-128574459-2', 'auto');
		   ga('require', 'displayfeatures');
			ga('send', 'pageview');
	</script>

        <div metal:use-macro="../common.html/head" />
        <div metal:use-macro="../common.html/stylesheet" />
        <div metal:use-macro="../common.html/javascript" />
			<script src="/web/js/checkout.js"></script>
	<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
    <style type="text/css">
		
		body{
			background: #ffffff;
		}
		
        .left{
            text-align: left;
        }
        .kjopforsiden{
            position: absolute;
            top: -5px;
            left: 20px;
        }
        .span2{
            width: 85px;
        }
        ul#products {
            margin: 1em 0; padding: 0;
        }		
        ul.sizes { margin: 0; padding: 0}	
        ul#products li, ul.sizes li {
			color:#1077a5;
            list-style-type: none;
            width: 50%;
            padding: 0px 0 5px 0;
            margin: 0;
            float: left;
        }
        ul#products input, input.quantity {
            width: 1.5em;
			}
        div.size{
            background-color: #fff;
            width: 303px;
            height: 91px;
            margin: 5px;
            border: solid 3px #89d7fa;
            cursor: pointer;
		}
        div.size div{
            float: left;
        }
        div.size img{
            padding: 10px 0;  
        }
		div.selected{
			border-color:#1077a5!important;
		}
		.sizetext{
            text-align: left;
			position: relative;
            width: 115px;
            color:#1077a5;
            font-family: 'Populaire';
            font-size: 1.4em;
            line-height: normal;
            margin:auto auto;
		}
		.hidden{
            display: none;
		}
        
        
        h4{
            color: #1077a5;
            font-family: helvetica;
            font-size: 1.2em;
			line-height: 1.2em;
        }
        input.quantity, input.valg {
            font-size: 1.2em;
            height: 1.3em;
            margin-bottom: 0px;
        }
        
        .container button, .sizes button{
            padding: 5px 8px 7px 10px !important;
    border-radius: 19%;
        }
		.sizes{
			width: 400px;
		}
		
		large {
    font-size: 20px;
			
		}
		
		
		button.changequantity.large {
		color: #ffffff;
    background-color: #226fd7;
    line-height: 14px;
    margin: 23px 0px 6px 0px;
			
		}
		
			
		ul#products input, input.quantity{
			
    margin: 22px 4px 4px 5px;
			
		}
		
		
		
		
		/*av på knapp nyhetsbrev Repix*/
			/*av på knapp nyhetsbrev Repix*/



.switch {
  position: relative;
  /*display: inline-block;*/
  width: 60px;
  height: 34px;
}

.switch input {display:none;}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #dc3545;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #28a745;
}

input:focus + .slider {
  box-shadow: 0 0 1px #28a745;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 15px;
}

.slider.round:before {
  border-radius: 50%;
}
	
	.ui-dialog .ui-widget .ui-widget-content .ui-corner-all .ui-front .ui-dialog-buttons .ui-draggable .ui-resizable{
		width:50%;
	}
	
	
/**/
/* Customize the label (the container) */
.containers {
  display: block;
  position: relative;
  padding-left: 35px;
  margin-bottom: 12px;
  cursor: pointer;
  font-size: 22px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default checkbox */
.containers input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

/* Create a custom checkbox */
.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 25px;
  width: 25px;
  border: 1px solid #0094d3;
    background color: #FFFFFF;
    box-shadow: inset 0 1px 3px rgba(0,0,0,.3);
}

/* On mouse-over, add a grey background color */
.containers:hover input ~ .checkmark {
  background-color: #ccc;
}

/* When the checkbox is checked, add a blue background */
.containers input:checked ~ .checkmark {
  background-color: #2196F3;
}

/* Create the checkmark/indicator (hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the checkmark when checked */
.containers input:checked ~ .checkmark:after {
  display: block;
}

/* Style the checkmark/indicator */
.containers .checkmark:after {
  left: 9px;
  top: 5px;
  width: 5px;
  height: 10px;
  border: solid white;
  border-width: 0 3px 3px 0;
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  transform: rotate(45deg);
}	
		
    </style>
    
    
    </head>
    
    
    
    <body>
        <tal:block metal:define-macro="show-image">
            <tal:block tal:condition="exists:product/images" tal:repeat="image product/images">
                <a href="http://static.repix.no/images/products/thumbs/height/500/${image/url}" class="fancybox" title="${product/ingress}">
                    <img src="http://static.repix.no/images/products/thumbs/height/100/${image/url}" title="${product/title}" height="100" tal:condition="equal:repeat/image/number,1" />
                </a>
            </tal:block>
        </tal:block>
        <div class="header">
			<div class="span text-left">
				<button id="start-over" class="yellow">Forrige</button>
			</div>
			
			<div class="span text-right">
				<button id="add-to-cart" class="yellow">Neste</button>
			</div>
			
			<!--<div class="span" >
				<h2>Velg Størrelse</h2>
			</div>-->
        </div>
        <div class="container center">

		
        
      
		<div class="span row" style="text-align: center">
			<p style="color: #000000; font-family: populaire; font-size: 20px;">Lokket er gratis. <br/>Ønsker du i tillegg å kjøpe produkter med bildet ditt på, <br/>kan du bestille det her. Gratis frakt!</p>
			<div class="row span" style="padding: 10px 0 10px 0">
			<img src="/web/images/blueline.png" />
		</div>
			<div><h5 style="color: #ef321b; font-family: populaire; font-size: 20px;     letter-spacing: 1px; ">Kryss av for å motta Repix nyhetsbrev  og få <br/> 50% medlemsrabatt på ekstra produkter.</h5></div>
		</div>
		<!--NY 2019 checkbox rabatt kode repix -->
		<br/>
		<!--<form method="post" action="/lag-lokk/checkout/confirm/" id="contact-and-delivery-info">
		</form>
		-->
		
		<div class="span text-center">
				
	 
		<!--
		
		<div class="repix" style="margin-bottom: 10px; text-align: left; margin-left: 17px;">
					 <strong class="notice" style="font-family: 'KidprintMTStd-Bold'; font-size: 1.5em;">JA, TAKK </strong>
				 <a href="#" id="informasjon3button" style="font-weight: bold; text-decoration: underline; font-family: 'KidprintMTStd-Bold'; font-size: 1.3em; ">Mer informasjon</a>
			</div>
		
		<label class="switch text-center" style="margin-left: 15px;">
					  <input type="checkbox"  id="newsletter" name="newsletter" style="margin-left: 25px;" />
				  <span class="slider round"></span>
			</label>-->
		
				<label class="containers" style="font-family: 'KidprintMTStd-Bold'; font-size: 1.5em; font-weight: bold; " >JA, JEG VIL BLI MEDLEM
  <input type="checkbox" id="newsletter" name="newsletter" />
  <span class="checkmark"></span>
   <a href="#" id="informasjon3button" style=" text-decoration: underline; font-family: 'KidprintMTStd-Bold'; font-size: 1em; ">mer informasjon</a>
</label>
			
			
			
		</div>				
        <div class="span row">
        <ul tal:condition="exists:sections/products_mobile" id="products">
				<tal:block tal:repeat="product sections/products_mobile">
				    <li tal:condition="equal:product/option/type,gift" class="gift ${conditionalmatch:product/options/length,1,one-option,more-options}" id="id${product/id}">
					<div class="center span" style="height: 7em">
					    <tal:block metal:use-macro="show-image" />
					</div>
					<div class="span">
						<div class="left" style="height: 1.5em; margin-left: 5px;">
							<h5 style="margin: 2px 0;">${product/title}</h5> 
						</div>
						<div class="left" style="height: 1.5em; margin-left: 5px;">
						<strong><span class=" price">Kr ${product/option/price}</span></strong>
						<span class="price" style="color: red;">( Kr ${product/option/historical/price} )</span>
						</div>
						<tal:block tal:condition="equal:product/options/length,1">
							<div class="left">
								<tal:block tal:condition="exists:cart/items/gifts/${product/option/prodno}">
									<tal:block tal:repeat="item cart/items/gifts/${product/option/prodno}">
									<input type="text" class="quantity"  value="${item/quantity}" name="${product/option/prodno}" />
									</tal:block>
								</tal:block>
								<tal:block tal:condition="not:exists:cart/items/gifts/${product/option/prodno}">
								<input type="text" class="quantity"  value="0" name="${product/option/prodno}" />
								</tal:block><br/>
							</div>
						</tal:block>
						<tal:block tal:condition="gt:product/options/length,1">
							<div class="span6 text-left">
								<div>
								Antall:<span class="product-quantity">0</span><br/>
								<a href="#open_options_${product/id}" class="open-options" i18n:translate="">Choose sizes</a><br/> 
								<!--<span class="large price">Kr ${product/option/price}</span>-->
								</div>
								<div class="hide product-options" id="open_options_${product/id}" title="Choose size" i18n:attributes="title">
									<table class="sizes">
										<tal:block tal:repeat="option product/options">
											<tr id="optionid${option/id}">
												<td style="text-align: right; padding: 2px 8px 2px 0;">
												<label>${option/title}</label>
												</td>
												<td style="text-align: left; padding: 2px 0 2px 0;">
												<input type="text" class="quantity"  id="option${option/id}" value="0" name="${product/option/prodno}" rel="#id${product/id}"/>
												<script type="text/javascript">
													$('#optionid${option/id}').data({
														'id'		:'${product/id}',
														'optionid'	:	'${option/id}',
														'prodno'	:	'${option/prodno}',
														'lokkid'		:'${lokk/id}',
														'imageid'		:'${lokk/imageid}'
													});
												</script>
												</td>
											</tr>
										</tal:block>
									</table>
								</div>
							</div>
						</tal:block>
						<script type="text/javascript">
							$('#id${product/id}').data({
							'id'			:	'${product/id}',
							'optionid'		:	'${product/option/id}',
							'prodno'		:	'${product/option/prodno}',
							'lokkid'		: 	'${lokk/id}',
							'imageid'		:	'${lokk/imageid}'
							});
						</script>
					</div>
				    </li>	
				</tal:block>
			</ul>
        </div>

        </div>
        
		<div id="startpanytt" title="Advarsel?" style=" display: none">
			<h4>
				Ved å gå tilbake til forrige steg vil lokket du har laget bli nullstilt.<br/>
				Ønsker du å starte på nytt?
			</h4>
			<button class="yellow button" id="startover" style="font-family: 'Populaire'; font-size: 39px;">Start på nytt</button>
			<button class="yellow button"  id="cancelstartover" style="font-family: 'Populaire'; font-size: 39px;">Avbryt</button>
		</div>
		
        <div metal:use-macro="../common.html/footer" />
        
        
        
        <script type="text/javascript">
            /*<![CDATA[*/
			var totalskirts = 0;
            var lokkid = ${lokk/id};
            
            $( function(){
                
				
				$('#cancelstartover').on('click', function(){
					
					$('#startpanytt').dialog( "close" );
					
					})
					
					
					
				$('#startover').on('click', function(){
						
						window.location = '/lag-lokk';
					
					})
				
				$('#start-over').on( 'click', function(){
					$('#startpanytt').dialog({'width': "450px"});
				})
				
                $('.fancybox').click( function(){
                    var src = $(this).attr( 'href' );
                    $('#image').attr( 'src', src );		
                    $('#dialog').dialog({
                        modal: true,
                        resizable: false,
                        draggable: false
                    });
                    return false;
                });
                
                showloader();
                $(window).load( hideloader );
                
                $('input.quantity').before('<button class="button changequantity large">-</button>').prev().click( function() {
                    if ( parseInt( $(this).next().attr('value') ) <= 0) { return false };
                    $(this).next().attr('value', parseInt( $(this).next().attr('value') ) - 1);
                    $(this).next().trigger('change');
                    return false;
                });
                $('input.quantity').after('<button class="button changequantity large">+</button>').next().click( function() {
                    
                    $(this).prev().attr('value', parseInt( $(this).prev().attr('value') ) + 1);
                    $(this).prev().trigger('change');
                    return false;
                });
                
                
                $('.size').on( 'click' , function(){
			
                    var lokksize = $(this).attr('id');
                    //console.log( lokksize );
                    
                    $.post('/api/1.0/stabburet/changesize', {
                        lokkid: lokkid,
                        lokksize: lokksize
                        }, function (response) {
                            
                            
                    }, 'json');
                    
                    $('.check').hide();
                    $( '.size' ).css( { 'border-color': '#89d7fa' } ).removeClass( 'selected' );
                    $(this).css({ 'border-color' : '#1077a5' }).addClass( 'selected' );
                    $(this).find('.check').show();
                });
                
                
                 $('.skirts span').each( function(){
					totalskirts += parseInt( $(this).attr('val' ));
					$( '#option'  + $(this).attr('id')  ).attr( 'value',  $(this).attr('val') );
					$('.product-quantity').text( totalskirts );
				});
			$('.quantity').on( 'change', function(){
				
				
					$(this).parent().parent().parent().addClass("ischanged");
				
				});
				
			
            $('#add-to-cart').on('click', function() {
								showloader();              
                    var actions = [];
					
                    $('#products li').each( function(i, item) {
						
                        if ( $(item).hasClass('gift') && $(item).hasClass('one-option')  && $(item).hasClass('ischanged') ) {
						    
								actions.push( orderGift( $(item).data('id'), $(item).data('optionid'),  $(item).data('prodno'), $('input.quantity', item).val(), $(item).data('lokkid') ) );
										
							} else if ( $(item).hasClass('gift') && $(item).hasClass('more-options') ) {
					
									var optionsContainer = $('a.open-options', item).attr('href');
									$('tr', optionsContainer).each( function(i, option) {
										
										if( $('input', option).val() > -1) {
											
											if( orderGift( $(option).data('id'), $(option).data('optionid'), $(option).data('prodno'), $('input.quantity', option).val() ,$(item).data('lokkid') ) ) {
												addedToCart = true;
											}
										}    
									});	    
								}
						});
					
					
                    $.when.apply($,actions).done(function(){
                        //check results if you want on "arguments
												var url = "/lag-lokk/checkout";
												if( $('#newsletter').prop( 'checked' ) ){
													url = "/lag-lokk/checkout?newsletter=true";
												}
                        window.location=url;
                    });
                return false;
            });
			
			$('.open-options').click( function() {
			
				var id = $(this).attr('href');
				var item = $(this).parent();
				var quantity = 0;
				
				//$(id).dialog('open');
				$(id).dialog({
					'resizable'	:	'false',
					'width': '450',
					'modal': true,
					'buttons' : {
						'OK': function(){ $(this).dialog('close') }
					},
					'open' : function(event, ui){ $(this).parent().children().children('.ui-dialog-titlebar-close').show() }
				});
				
				
				$(id).find('ui-dialog-titlebar-close').hide();
				return false;
			});
            
			
			$('input', '.product-options').bind('change', function() {
				var container = $(this).attr('rel');
				var totalQuantity = 0;
				$(this).parent().parent().parent().find('input').each( function(i, item) {
					totalQuantity = totalQuantity + parseInt( $(item).val() );
				});
				$('.product-quantity', container).text( totalQuantity );
			});	
            
            
            
        });
    
		
	
        function orderGift( id, optionid, prodno, quantity, lokkid ) {

            var finished = false;
            var malid;
            var malpageid;
            var ratio;
            var x = 0;
            var y = 0;
            var malarray = new Array();
            
            switch( optionid ){
				case '4004': //smekke
					malid 	= '2900';
					malpageid 	= '6749';
					tmplx	= '0';
					tmply	= '0';
					dx		= '591';
					dy		= '591';
				break;
				case '3327': //magnet
					malid 	= '2695';
					malpageid 	= '6171';
					tmplx	= '0';
					tmply	= '0';
					dx		= '385';
					dy		= '385';
				break;
				case '3329': //klistremerke
					malid 	= '2693';
					malpageid 	= '6169';
					tmplx	= '0';
					tmply	= '0';
					dx		= '439';
					dy		= '439';
				break;
				case '3325': //nøkkelring
					malid 	= '2697';
					malpageid 	= '6173';
					tmplx	= '0';
					tmply	= '0';
					dx		= '384';
					dy		= '384';
				break;
				case '3323': //matboks 3323 er andre verdien i admin porduktid 
					malid 	= '2694';
					malpageid 	= '6170';
					tmplx	= '0';
					tmply	= '0';
					dx		= '443';
					dy		= '443';
				break;
			case '5500': //Popsocket
		    malid 	= '3141';
		    malpageid 	= '7184';
		    tmplx	= '0';
		    tmply	= '0';
		    dx		= '224';
		    dy		= '224';
		break;
	
				case '3321': //drikkeflaske
		   // malid 	= '2699
		   malid 	= '3166';
		    malpageid 	= '7200';
		    tmplx	= '0';
		    tmply	= '0';
		    dx		= '472';
		    dy		= '472';
		break;
				case '3319': //kopp
					malid 	= '2698';
					malpageid 	= '6174';
					tmplx	= '0';
					tmply	= '0';
					dx		= '472';
					dy		= '472';
				break;
			
			
				case '6010': //Stabburet Lue Ny 2019
					malid 	= '3164'; // i produkt admin
					malpageid 	= '7197'; // bilde i admin 
					tmplx	= '0';
					tmply	= '0';
					dx		= '439';
					dy		= '439';
				break;
			
			
				
				case '6011': //Stabburet Gympose Ny 2019
					malid 	= '3165';
					malpageid 	= '7198';
					tmplx	= '0';
					tmply	= '0';
					dx		= '945';
					dy		= '945';
				break;
			
				case '3339':  //2-3
				case '3340':  //4-6
				case '3341':  //8-10
				case '3342':  //12-14
				case '3335':  //tskjorte S
				case '3336':  //tskjorte M
				case '3337':  //tskjorte L
				case '3338':  //tskjorte XL
					malid 	= '2702';
					malpageid 	= '6178';
					tmplx	= '0';
					tmply	= '0';
					dx		= '1300';
					dy		= '1300';
				break;
				case '3348': //musematte
					malid 	= '2707';
					malpageid 	= '6183';
					tmplx	= '0';
					tmply	= '0';
					dx		= '1004';
					dy		= '1004';
				break;
            }
            
            x = x / ratio;
            y = y / ratio;
            
            var pages = new Array();
            pages.push();
            pages[0] = new Object();
            pages[0].malid = malid;
            pages[0].malpageid = malpageid;
            pages[0].giftQuantity = quantity;
            pages[0].productoptionid = optionid;
            pages[0].productid = id;
            pages[0].size = "small";
            pages[0].lokkid = lokkid;
            pages[0].prodno = prodno;
            /*pages[0].editor_x = tmplx / ratio;
            pages[0].editor_y = tmply / ratio;
            pages[0].image = new Object()
            pages[0].image.x = (-crop.x1 + x ) * ratio;
            pages[0].image.y = (-crop.y1 + y ) * ratio;
            pages[0].image.dx = crop.imagewidth * ratio;
            pages[0].image.dy = crop.imageheight * ratio;
            //pages[0].image.dx = 1068.0619047619048;//$('#image').width() * ratioWidth;
            //pages[0].image.dy = 728.4705882352941; //$('#image').height() * ratioHeight;
            pages[0].image.bid = imageid;
            pages[0].texts = new Array();
            pages[0].cliparts = new Array();*/
            /*if( quantity > 0 ){
            console.log( pages );
            }*/
            
            
            $.ajax({
                type: 'POST',
                url: '/bestill/save',
                async: false,
                data: { 
                    'pages'	: JSON.stringify( pages )
                },
                complete: function(msg) {
                    addedToCart = true;
                    finished = true;
                },
                success: function(msg) {
                    addedToCart = true;
                    finished = true;
                },
                error: function(msg) {
                    alert('error' + msg);
                }
            });
            
            return finished;
        }
		
		
        function showloader(){
			$('body').prepend( '<div id="loader-overlay"><div class="loadingInfo"><img src="https://static.repix.no/gfx/gui/ajax-loader-gray.gif" />\
									<br/><br/><h3>Loading.......<span id="status"></span></h3></div></div>');
									
			$('#loader-overlay')
				.css('opacity', '0.8')
				.css('margin','0')
				.width( $(window).width() )
							.height( $(document).height() );
											
			return false;
        }
                                    
        function hideloader(){
            $('#loader-overlay').fadeOut('slow', function() {
                $(this).remove();
            });
        }
            
            /*]]>*/
        </script>
        
</body>
</html>