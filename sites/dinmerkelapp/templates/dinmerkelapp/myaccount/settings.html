<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<tal:block metal:use-macro="../../${templates}/common.html/head" tal:define="global pagetitle" i18n:translate="">Profile and settings</tal:block>
   <script type="text/javascript" src="${static:js/dialog.js}"></script>
   
	<style  type="text/css">

		#tabs{
			border: solid 1px #eee;
			margin: 15px;
			padding:15px;
			
		}
	</style>

</head>


<body>
<div metal:use-macro="../../${templates}/common.html/top" />
	<div class="container">

	<!-- if no menu is used use id="widecontent" -->
	<div class="content">
		<br class="clear clearfix" />
		<!-- put the content here -->
		<h2 i18n:translate="">Profile and settings</h2>
		<div id="tabs">
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active"><a href="#login-information-tab" aria-controls="login-information-tab" role="tab" data-toggle="tab" i18n:translate="">Login information</a></li>
				<li role="presentation"><a href="#contact-information-tab" aria-controls="contact-information-tab" role="tab" data-toggle="tab" i18n:translate="">Contact information</a></li>
				<li role="presentation"><a href="#smsnewsletter-tab" aria-controls="smsnewsletter-tab" role="tab" data-toggle="tab" i18n:translate="">SMS / Newsletter</a></li>
				<li role="presentation"><a class="storage" href="/myaccount/orders" i18n:translate="">Mine Ordrer</a></li>
					<li role="presentation"><a class="storage" href="/myaccount/projects" i18n:translate="">Mine Foto Prosjekt</a></li>
			</ul>
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="login-information-tab">
					<h3 i18n:translate="" class="hide">Login information</h3>
					<form method="post" action="/myaccount/settings/save/" id="login-information" class="form-inline">
						<input type="hidden" name="actiontype" value="login" />

						<h4 class="quiet" i18n:translate="">Email</h4>
						<div class="span-18">
							<div class="span-3 right">
								<label for="emailchange" i18n:translate="">E-mail</label>
							</div>
							<div class="span-9">
								<input type="text" class="text form-control" name="emailchange" tal:attributes="value user/email" />
								<input type="hidden" class="text" name="oldemail" tal:attributes="value user/email" />
							</div>
							<div class="span-6 last"></div>
						</div>

						<div class="span-18 prepend-top">
							<h4 class="quiet" i18n:translate="">Change password</h4>
							<div class="span-3 right">
								<label for="password" i18n:translate="">Old Password</label>
							</div>
							<div class="span-9">
								<input type="password" name="password" class="text form-control" id="password"/>
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="passwordnew" i18n:translate="">New password</label>
							</div>
							<div class="span-9">
								<input type="password" name="passwordnew" class="text form-control" id="passwordnew" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="passwordnewrepeat" i18n:translate="">Repeat new password</label>
							</div>
							<div class="span-9">
								<input type="password" name="passwordnewrepeat" class="text form-control" id="passwordnewrepeat" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="right top15">
							<button type="submit" class="btn btn-primary" id="logindata" i18n:translate="">Save changes</button>
						</div>
					</form>
					<hr class="space" />
				</div>
				<div role="tabpanel" class="tab-pane" id="contact-information-tab">
					<h3 i18n:translate="" class="hide">Contact information</h3>
					<form method="post" action="/myaccount/settings/save/" id="login-information">

						<input type="hidden" name="actiontype" value="user" />

						<h3 class="quiet" i18n:translate="">Name</h3>

						<div class="span-18">
							<div class="span-3 right">
								<label for="firstname" i18n:translate="">First name</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="firstname" value="" tal:attributes="value user/firstname|default" />
							</div>
							<div class="span-6 last"></div>
						</div>

						<div class="span-18">
							<div class="span-3 right">
								<label for="middlename" i18n:translate="">Middle name</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="middlename" value="" tal:attributes="value user/middlename|default" />
							</div>
							<div class="span-6 last"></div>
						</div>

						<div class="span-18">
							<div class="span-3 right">
								<label for="lastname" i18n:translate="">Surname</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="lastname" value="" tal:attributes="value user/lastname|default" />
							</div>
							<div class="span-6 last"></div>
						</div>

						<hr class="space"/>

						<h3 class="quiet" i18n:translate="">Address</h3>
						<div class="span-18">
							<div class="span-3 right">
								<label for="address" i18n:translate="">Address</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="address" value="" tal:attributes="value user/contactinfo/address|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								&nbsp;
							</div>
							<div class="span-9">
								<input type="text" class="text" name="address2" value="" tal:attributes="value user/contactinfo/address2|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="zipcode" i18n:translate="">Zip code</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="zipcode" value="" tal:attributes="value user/contactinfo/zipcode|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="city" i18n:translate="">City</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="city" value="" tal:attributes="value user/contactinfo/city|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="country" i18n:translate="">Country</label>
							</div>
							<div class="span-9">

								<select name="country" id="country">
									<!--
									<tal:block tal:condition="user/contactinfo/country">
										<option value="${user/contactinfo/country/iso}" tal:content="user/contactinfo/country/name" i18n:translate="" />
									</tal:block>
									<tal:block  tal:condition="not:user/contactinfo/country">
										<option value="NO" i18n:translate="" selected="selected">Norway</option>
									</tal:block>
									-->
									<tal:block tal:repeat="country countries">
										<option tal:condition="equal:user/contactinfo/country,country/iso,true" value="${country/iso}" i18n:translate="" tal:content="country/name" selected="1"></option>
										<option tal:condition="not:equal:user/contactinfo/country,country/iso,true" value="${country/iso}" i18n:translate="" tal:content="country/name"></option>
									</tal:block>
								</select>

							</div>
							<div class="span-6 last"></div>
						</div>

						<hr class="space"/>

						<h3 class="quiet" i18n:translate="">Contact information</h3>
						<div class="span-18">
							<div class="span-3 right">
								<label for="mobile" i18n:translate="">Mobile phone</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="mobile" value="" tal:attributes="value user/contactinfo/mobile|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="phone" i18n:translate="">Phone</label>
							</div>
							<div class="span-9">
								<input type="text" class="text" name="phone" value="" tal:attributes="value user/contactinfo/phone|default" />
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="phone_night" i18n:translate="">Additional phone</label>
							</div>
							<div class="span-9">
								<input type="text" name="phone_night" class="text" value="" tal:attributes="value user/contactinfo/phone_night|default" />
							</div>
							<div class="span-6 last"></div>
						</div>

						<hr class="space"/>
						<h3 class="quiet" i18n:translate="">Optional information</h3>
						<div class="span-18">
							<div class="span-3 right">
								<label for="birthday" i18n:translate="">Born</label>
							</div>
							<div class="span-9">
								<input type="text" id="birthday" name="birthday" value="" tal:attributes="value user/birthdate | default"/>
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="span-18">
							<div class="span-3 right">
								<label for="gender" i18n:translate="">Gender</label>
							</div>
							<div class="span-9">
								<select id="gender" name="gender">
									<option value="" i18n:translate=""></option>
									<option value="f" i18n:translate="" tal:condition="equal:user/gender,f,0" selected="selected">Female</option>
									<option value="f" i18n:translate="" tal:condition="not:equal:user/gender,f,0">Female</option>
									<option value="m" i18n:translate="" tal:condition="equal:user/gender,m,0" selected="selected">Male</option>
									<option value="m" i18n:translate="" tal:condition="not:equal:user/gender,m,0">Male</option>
								</select>
							</div>
							<div class="span-6 last"></div>
						</div>
						<div class="right">
							<button type="submit" class="btn btn-primary" id="userdata" i18n:translate="">Save changes</button>
						</div>
					</form>
					<hr class="space" />
				</div>
				<div role="tabpanel" class="tab-pane"  id="smsnewsletter-tab">
					<form method="post" action="/myaccount/settings/save/" id="smsnewsletter-information">
					<input type="hidden" name="actiontype" value="smsnewsletter" />

               <h3 i18n:translate="">SMS / Newsletter</h3>
					<p></p>
					<!-- fieldset>
						<legend i18n:translate="">SMS</legend>
						<div>
							<input disabled="1" type="checkbox" name="sms-sharing-photo" id="sms-sharing-photo" tal:attributes=""/>
							<label for="sms-sharing-photo" i18n:translate="">Alert me by SMS when someone is sharing photos with me.</label>
						</div>
						<div>
							<input disabled="1" type="checkbox" name="sms-order-ship" id="sms-order-ship"/>
							<label for="sms-order-ship" i18n:translate="">Alert me by SMS when a order is shipped</label>
						</div>
					</fieldset -->
					<fieldset>
						<legend i18n:translate="">Newsletter</legend>
						<input type="checkbox" name="newsletter" id="newsletter" value="1" tal:condition="not:user/contact/newsletter"/>
						<input type="checkbox" name="newsletter" id="newsletter" value="1" checked="checked" tal:condition="user/contact/newsletter"/>
						<label for="newsletter" i18n:translate="">I want to receive news and special offers</label>
						<br />
						<input type="checkbox" name="newsletter_others" id="newsletter_others" value="1" tal:condition="not:user/contact/spam"/>
						<input type="checkbox" name="newsletter_others" id="newsletter_others" value="1"  checked="checked" tal:condition="user/contact/spam"/>
						<label for="newsletter_others" i18n:translate="">I want to receive information from third parties</label>
					</fieldset>
					<div class="right">
						<button type="submit" class="btn btn-primary" id="newsletter-save" i18n:translate="">Save changes</button>
					</div>
					</form>
				</div>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<div role="tabpanel" class="tab-pane" id="storage-tab">

					<h3 i18n:translate="">Mine merkelapper</h3>
					
					
					<TABLE class="orders">
					<THEAD>
					 <tr>
					    <th i18n:translate="">
					       Thumbnail
					    </th>
					    <th>
					       Produkt
					    </th>
					    <th i18n:translate="">
					       Orderid
					    </th>
					    <th>
					       &nbsp;
					    </th>
					 </tr>
					</THEAD>
					
					</TABLE>



				</div>
				<div role="tabpanel" class="tab-pane"  id="avatar-tab">
					<div></div>
				</div>
				<div role="tabpanel" class="tab-pane"  id="values" tal:condition="credits">
				
				<div>Tipse en venn.</div>
				Epost: <input type="text" name="friendsemail" id="friendsemail" /><BUTTON id="addfriend">ADD</BUTTON>
				
				
				<div class="hide box">
				  2 av dine venner du har tipset har nyttet seg av tilbudet, du kan derfor få en verdikode som gir deg 10% på ditt neste kjøp.
				  <BUTTON>Få kode</BUTTON>
			
				
				</div>
				<div>Venner som er tipset.</div>
               
				<table>
				<THEAD>
				  <tr>
				  <td>
				     Friend
				  </td>
				  <td>
				     Tipset dato
				  </td>
				  <td>
				     Har kjøpt?
				  </td>
				  <td>
				     Rabatt
				  </td>
				  <td>
				     Tips på nytt.
				  </td>
				  
				  </tr>
				</THEAD>
				<TBODY>
				<tr>
				  <td>
				     til@gloppen.net
				  </td>
				  <td>
				     2012-01-01
				  </td>
				  <td>
				     OK
				  </td>
				  <td>
				     Tilgjengelig
				  </td>
				  <td>
				     <BUTTON>SEND</BUTTON>
				  </td>
				     
				</tr>
				
				</TBODY>
				</table>
				
					<hr class="space clear clearfix" />
				</div>
			</div>
		</div><!-- end tabs -->
		
      <div class="hide" id="message" title="" i18n:attributes="title">
         <p i18n:translate=""></p>
      </div>

		<script type="text/javascript">
			$(document).ready(function() {

				$('form#login-information').validate({
					errorClass: "inputError",
					errorPlacement: function(error, element) {
						error.appendTo( element.parent("div").next("div") );
					},
					rules: {
						emailchange:{
							required: true,
							email: true
						},
						password: {
							required: true,
							remote: '/api/1.0/user/checkpass/'
						},
						passwordnew: {
							maxlength: '15',
							minlength: '5'
						},
						passwordnewrepeat: {
							equalTo: '#passwordnew'
						}
					},
					messages: {
						password: {
							required: '<tal:block i18n:translate="">Enter your password to change these settings</tal:block>',
							remote: '<tal:block i18n:translate="">Password is incorrect</tal:block>'
						},
						passwordnew: {
							required: "<tal:block i18n:translate="">Please enter password</tal:block>",
							maxlength: jQuery.format('<tal:block i18n:translate="">Your password cannot be longer than {0} characters.</tal:block>'),
							minlength: jQuery.format('<tal:block i18n:translate="">Your password should be longer than {0} characters.</tal:block>')
						},
						passwordnewrepeat: {
							required: "<tal:block i18n:translate="">Please enter password</tal:block>",
							equalTo: "<tal:block i18n:translate="">Oops, your passwords don't match. </tal:block>"
						}
					}
				});

				$('#logindata').click( function() {
				      $(this).parents('form').get(0).submit();
				});
				$('#userdata').click( function() {
				      $(this).parents('form').get(0).submit();
				});
				$('#coupon-code').click( function() {
				   $(this).parent().submit();
				});

				$('#sms-sharing-photo').click( function() {
				   $.ajax({
                  url: "/api/1.0/user/toggle/sms/sharephoto",
                  type: 'get',
                  cache: 'false',
                  data: {
                     value: $('#sms-sharing-photo').is(':checked')
                  },
                  dataType: 'json',
                  success: function( data, status ) {
                  }
               });
            });
            $('#sms-order-ship').click( function() {
				   $.ajax({
                  url: "/api/1.0/user/toggle/sms/ordershipping",
                  type: 'get',
                  cache: 'false',
                  data: {
                     value: $('#sms-order-ship').is(':checked')
                  },
                  dataType: 'json',
                  success: function( data, status ) {
                  }
               });
            });
            /*
            $('#newsletter').click( function() {
				   $.ajax({
                  url: "/api/1.0/user/toggle/newsletter",
                  type: 'get',
                  cache: 'false',
                  data: {
                     value: $('#newsletter').is(':checked')
                  },
                  dataType: 'json',
                  success: function( data, status ) {
                  }
               });
            });
            */
            
            


            $('.storage').click( function(){
               
               
               var productsMerkelapp = new Object();
				productsMerkelapp = {
                  2730 : "150 Strykemerker",
                  2732 : "210 Klistremerker",
                  2734 : "90 Strykemerker + 90 Klistremerker"
				}
				var productsFargelapp = new Object();
					productsFargelapp = {
					3084: "150 Fargelapper",
					3087: "300 Fargelapper"
				}
				var productsStempel = new Object();
				productsStempel = {
					3783: "Navnestempel",
				}

               var options = '';
               if( $(this).hasClass( 'storage' ) ){
                  $.getJSON('/api/1.0/merkelapp/projects', function(data) {
                   var items = [];
                    
                    $.each(data.projects, function(key, val) {
                      options = '';
		      
		      if( val.productoptionid == 3084 || val.productoptionid == 3087){
					products = productsFargelapp;
		      }
			  else if( val.productoptionid == 3783 ){
				products = productsStempel;
			  }
			  else{
					products = productsMerkelapp;
		      }
		      
                      $.each( products, function( key_opt, val_opt ){
                         
                         if( val.title == val_opt ){
                            options += '<option value="' + key_opt + '" selected="true">' + val_opt + '</option>';
                         }else{
                            options += '<option value="' + key_opt + '" >' + val_opt + '</option>';
                         }
                      });
                      
                       
                      items.push('<tr>\
                          <td>\
                             <img style="border:1px solid black;" src="/bestilling/thumb/' + val.id + '" />\
                          </td>\
                          <td>\
                              <select>' + options + '</select>\
                          </td>\
                          <td>\
                             ' + val.orderid +'\
                          </td>\
                          <td>\
                             <a class="rebuy" id="' +  val.id + '" href="#">Kjøp</a>\
                          </td>\
                       </tr>');
                    });
                  
                    $('<tbody/>', {
                      'class': 'my-new-list',
                      html: items.join('')
                    }).appendTo('.orders');
                  }); 
                  
                  
                  $(this).removeClass('storage');
               }
            });
            
            $('a.rebuy').live( 'click', function(){
               
               var id = $(this).attr('id');
               var productid = $(this).parent().parent().find( 'select' ).val();
               window.location = '/bestilling/rebuy/' + productid + '/' + id;
               return false;
            });
            
            $('#addfriend').click( function(){
               
               console.log( $('#friendsemail').val() )
               
               
               
               
            })

            
			});
			
		</script>
	</div>
</div>


	<div metal:use-macro="../../${templates}/common.html/footer" />
</body>
</html>
