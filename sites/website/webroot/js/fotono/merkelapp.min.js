function update(){$("img#preview").parent().append('<div id="imageloader" style="width:202px; height:83px"><img src="http://a.static.eurofoto.no/gfx/gui/ajax-loader-gray.gif"/></div>'),$("#addtocart").removeAttr("disabled"),disabled=!1,alertmessage="true";var a=encodeURIComponent($('input[name="font-color"]').val());$('input[name$="imagemode"]').val()=="color"?imagemode="color":imagemode="bw";if(imageselection.selection)var b=imageselection.selection.x1+"-"+imageselection.selection.y1+"-"+imageselection.selection.width+"-"+imageselection.selection.height+"-"+imagemode;var c=encodeURIComponent($('input[name$="line1"]').val()),d=encodeURIComponent($('input[name$="line2"]').val()),e=encodeURIComponent($('input[name$="line3"]').val()),f="/api/1.0/merkelapp/preview?projectid="+projectid+"&line1="+c+"&line2="+d+"&line3="+e+"&font="+$('select[name$="font-type"]').val()+"&gravity="+gravity+"&image="+ownimage+"&clipart="+clipart+"&backgroundfile="+backgroundfile+"&color="+a+"&treshold="+treshhold+"&crop="+b+"&colormode="+colormode;$("img#preview").each(function(){$(this).attr("src",f)}),$("img#preview").load(function(){$("#imageloader").remove()})}function setcrop(a){$("#ownimage").imgAreaSelect({handles:!0,aspectRatio:"1:1",x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,onInit:function(){ownimage=$('input[name$="image"]').val(),update()},onSelectEnd:function(a,b){imageselection={selection:b,imgx:a.width,imgy:a.height},update()}})}function getClipart(){if(type=="fargelapp")var a="colorclipart";else var a="clipart";$.post("/api/1.0/merkelapp/clipart",{clipart:category,type:type},function(b){$(b.images).each(function(b,c){$("#clipart").append('<img id="clip" title="'+c+'"src="'+staticroot+"gfx/merkelapp/"+a+"/"+category+"/"+c+'" width="50" style="margin-right: 5px;"/>')})},"json")}function getBackgrounds(){$.post("/api/1.0/merkelapp/backgrounds",{backgroundcat:backgroundcat},function(a){$(a.images).each(function(a,b){$("#background").append('<img id="backgroundfile" title="'+b+'"src="'+staticroot+"gfx/merkelapp/backgroundfiles/"+backgroundcat+"/thumbs/"+b+'" style="width: 50px; margin-right: 5px;"/>')})},"json")}$(document).ready(function(){getClipart(),getBackgrounds(),$("#select_clipart").change(function(){return $("#clipart").html(""),category=$(this).val(),getClipart(),!1}),$("#select_background").change(function(){return $("#background").html(""),backgroundcat=$(this).val(),getBackgrounds(),!1}),$("#cart-price").text(formatPrice(totalprice)),$(".alignment").on("click",function(){gravity=$(this).attr("id"),$(".alignment").removeClass("active"),$(this).addClass("active"),update()}),$("#font-color").change(function(){return $("select#font-color option:selected").each(function(){$("#font-color").css("background-color",$(this).css("background-color")),$("#font-color").css("color",$(this).css("color"))}),!1}),$("#addtocart").click(function(){return disabled==1?!1:($(".productline").each(function(){var a=parseFloat($(this).find(".choose_product").val()),b=parseFloat($(this).find(".productquantity").val());b>0&&$.post("/bestilling/addItemByProductOptionIdAPI/",{productoptionid:a,quantity:b,projectid:projectid},function(a){},"json")}),$("#myModal").modal(),!1)}),$("#removeimg, #removeclipart").click(function(){return clipart="",ownimage="",update(),!1}),$("#removebackground").click(function(){backgroundfile=null,update()}),$("#removetext").mouseup(function(){return $('input[name$="line1"]').val(""),$('input[name$="line2"]').val(""),$('input[name$="line3"]').val(""),update(),!1}),$("#removetext").click(function(){return!1}),$("#removeall").click(function(){return clipart="",ownimage="",backgroundfile=null,$('input[name$="line1"]').val(""),$('input[name$="line2"]').val(""),$('input[name$="line3"]').val(""),update(),!1}),$("#update").click(function(){return update(),!1}),$("#edit").on("change",function(){return update(),!1}),$("#edit").on("submit",function(a){a.preventDefault(),update()}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){$(a.target).attr("aria-controls")=="ownimagecontainer"&&imageselection.selection?setTimeout(function(){setcrop(imageselection.selection)},200):$("#ownimage").imgAreaSelect({remove:!0})});var a=$("#photo").val();$(document).on("click","#clip",function(){ownimage="",$(".selectedclip").removeClass("selectedclip"),$(this).addClass("selectedclip"),clipart=category+"-"+$(this).attr("title"),update()}),$(document).on("click","#backgroundfile",function(){$(".selectedbackground").removeClass("selectedbackground"),$(this).addClass("selectedbackground"),backgroundfile=backgroundcat+"-"+$(this).attr("title"),update()}),$("#font-color").change(function(){update()}),$(document).on("mouseover mouseout mousedown","#clip, #backgroundfile",function(a){a.type=="mouseover"?$(this).css({"background-color":"#ff9999",border:"1px solid #ca0000"}):a.type=="mousedown"?$(this).css({"background-color":"#ff9999",border:"1px solid #ca0000"}):$(this).css({"background-color":"",border:""})}),$("#jquery-colour-picker-text select").colourPicker({ico:"//static.eurofoto.no/gfx/icons/colorpicker.png",title:!1})})